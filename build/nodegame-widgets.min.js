
(function(e){function t(e){this.id=e.id,this.text="Waiting for other players to be done...",this.waitingDiv=null}e.WaitScreen=t,t.id="waiting",t.name="WaitingScreen",t.version="0.3.2",t.description="Show a standard waiting screen",t.prototype.init=function(e){},t.prototype.append=function(e){return e},t.prototype.getRoot=function(){return this.waitingDiv},t.prototype.listeners=function(){var e=this;node.on("WAITING...",function(t){e.waitingDiv||(e.waitingDiv=node.window.addDiv(document.body,e.id)),e.waitingDiv.style.display==="none"&&(e.waitingDiv.style.display=""),e.waitingDiv.innerHTML=t||e.text,node.game.pause()}),node.on("LOADED",function(t){e.waitingDiv&&e.waitingDiv.style.display===""&&(e.waitingDiv.style.display="none")})}})(node.window.widgets),function(e){function t(e){this.options=e,this.nddb=null,this.commandsDiv=document.createElement("div"),this.id=e.id,"undefined"!=typeof this.id&&(this.commandsDiv.id=this.id),this.info=null,this.init(this.options)}e.NDDBBrowser=t,JSUS=node.JSUS,NDDB=node.NDDB,TriggerManager=node.TriggerManager,t.id="nddbbrowser",t.name="NDDBBrowser",t.version="0.1.2",t.description="Provides a very simple interface to control a NDDB istance.",t.dependencies={JSUS:{},NDDB:{},TriggerManager:{}},t.prototype.init=function(e){function t(){var e=this.id;node.window.addEventButton(e+"_GO_TO_FIRST","<<",this.commandsDiv,"go_to_first"),node.window.addEventButton(e+"_GO_TO_PREVIOUS","<",this.commandsDiv,"go_to_previous"),node.window.addEventButton(e+"_GO_TO_NEXT",">",this.commandsDiv,"go_to_next"),node.window.addEventButton(e+"_GO_TO_LAST",">>",this.commandsDiv,"go_to_last"),node.window.addBreak(this.commandsDiv)}function n(){var e=this.commandsDiv.appendChild(document.createElement("span"));return e}t.call(this),this.info=n.call(this),this.tm=new TriggerManager,this.tm.init(e.triggers),this.nddb=e.nddb||new NDDB({auto_update_pointer:!0})},t.prototype.append=function(e){return this.root=e,e.appendChild(this.commandsDiv),e},t.prototype.getRoot=function(e){return this.commandsDiv},t.prototype.add=function(e){return this.nddb.insert(e)},t.prototype.sort=function(e){return this.nddb.sort(e)},t.prototype.addTrigger=function(e){return this.tm.addTrigger(e)},t.prototype.removeTrigger=function(e){return this.tm.removeTrigger(e)},t.prototype.resetTriggers=function(){return this.tm.resetTriggers()},t.prototype.listeners=function(){function n(e,n){e?(node.emit(t+"_GOT",e),this.writeInfo(this.nddb.nddb_pointer+1+"/"+this.nddb.length)):this.writeInfo("No element found")}var e=this,t=this.id;node.on(t+"_GO_TO_FIRST",function(){var t=e.tm.pullTriggers(e.nddb.first());n.call(e,t)}),node.on(t+"_GO_TO_PREVIOUS",function(){var t=e.tm.pullTriggers(e.nddb.previous());n.call(e,t)}),node.on(t+"_GO_TO_NEXT",function(){var t=e.tm.pullTriggers(e.nddb.next());n.call(e,t)}),node.on(t+"_GO_TO_LAST",function(){var t=e.tm.pullTriggers(e.nddb.last());n.call(e,t)})},t.prototype.writeInfo=function(e){this.infoTimeout&&clearTimeout(this.infoTimeout),this.info.innerHTML=e;var t=this;this.infoTimeout=setTimeout(function(){t.info.innerHTML=""},2e3)}}(node.window.widgets),function(e){function t(e){this.game=node.game,this.id=e.id||t.id,this.bar=null,this.root=null,this.fieldset={legend:"Send DATA to players"},this.recipient=null}e.DataBar=t,t.id="databar",t.name="Data Bar",t.version="0.3",t.description="Adds a input field to send DATA messages to the players",t.prototype.init=function(e){},t.prototype.append=function(e){var t=node.window.addButton(e),n=node.window.addTextInput(e);this.recipient=node.window.addRecipientSelector(e);var r=this;return t.onclick=function(){var e=r.recipient.value;data=n.value,console.log("Parsed Data: "+JSON.stringify(data)),node.fire(node.OUT+node.actions.SAY+".DATA",data,e)},e},t.prototype.listeners=function(){var e=this,t="in.";node.onPLIST(function(t){node.window.populateRecipientSelector(e.recipient,t.data)})}}(node.window.widgets),function(e){function t(e){this.game=node.game,this.id=e.id,this.fieldset={legend:"Server Info",id:this.id+"_fieldset"},this.root=null,this.div=document.createElement("div"),this.table=null,this.button=null}e.ServerInfoDisplay=t,t.id="serverinfodisplay",t.name="Server Info Display",t.version="0.2",t.prototype.init=function(e){var t=this;this.div||(this.div=document.createElement("div")),this.div.innerHTML="Waiting for the reply from Server...",this.table||(this.table=new node.window.Table(e)),this.table.clear(!0),this.button=document.createElement("button"),this.button.value="Refresh",this.button.appendChild(document.createTextNode("Refresh")),this.button.onclick=function(){t.getInfo()},this.root.appendChild(this.button),this.getInfo()},t.prototype.append=function(e){return this.root=e,e.appendChild(this.div),e},t.prototype.getInfo=function(){var e=this;node.get("INFO",function(t){node.window.removeChildrenFromNode(e.div),e.div.appendChild(e.processInfo(t))})},t.prototype.processInfo=function(e){this.table.clear(!0);for(var t in e)e.hasOwnProperty(t)&&this.table.addRow([t,e[t]]);return this.table.parse()},t.prototype.listeners=function(){var e=this;node.on("NODEGAME_READY",function(){e.init()})}}(node.window.widgets),function(e){function t(e){this.options=e,this.id=e.id,this.root=null,this.listRoot=null,this.fieldset=null,this.submit=null,this.changeEvent=this.id+"_change",this.init(e)}function n(e){t.call(this,e)}function r(e){t.call(this,e)}function i(e){t.call(this,e),this.groupName="undefined"!=typeof e.name?e.name:node.window.generateUniqueId()}e.Controls=t,e.Controls.Slider=n,e.Controls.jQuerySlider=r,e.Controls.Radio=i,t.id="controls",t.name="Controls",t.version="0.2",t.description="Wraps a collection of user-inputs controls.",t.prototype.add=function(e,t,n){},t.prototype.getItem=function(e,t){},t.prototype.init=function(e){this.hasChanged=!1,"undefined"!=typeof e.change&&(e.change?this.changeEvent=e.change:this.changeEvent=!1),this.list=new node.window.List(e),this.listRoot=this.list.getRoot();if(!e.features)return;this.root||(this.root=this.listRoot),this.features=e.features,this.populate()},t.prototype.append=function(e){this.root=e;var t=this.listRoot;this.list.parse(),e.appendChild(this.listRoot);if(this.options.submit){var n="submit_"+this.id;this.options.submit.id&&(n=this.options.submit.id,delete this.options.submit.id),this.submit=node.window.addButton(e,n,this.options.submit,this.options.attributes);var r=this;this.submit.onclick=function(){r.options.change&&node.emit(r.options.change)}}return t},t.prototype.parse=function(){return this.list.parse()},t.prototype.populate=function(){var e=this;for(var t in this.features)if(this.features.hasOwnProperty(t)){var n=this.features[t],r=t;n.id&&(r=n.id,delete n.id);var i=document.createElement("div"),s=this.add(i,r,n);this.changeEvent&&(s.onchange=function(){node.emit(e.changeEvent)}),n.label&&node.window.addLabel(i,s,null,n.label),this.list.addDT(i)}},t.prototype.listeners=function(){var e=this;node.on(this.changeEvent,function(){e.hasChanged=!0})},t.prototype.refresh=function(){for(var e in this.features)if(this.features.hasOwnProperty(e)){var t=node.window.getElementById(e);t&&(t.value=this.features[e].value)}return!0},t.prototype.getAllValues=function(){var e={};for(var t in this.features)if(this.features.hasOwnProperty(t)){var n=node.window.getElementById(t);n&&(e[t]=Number(n.value))}return e},t.prototype.highlight=function(e){return node.window.highlight(this.listRoot,e)},n.prototype.__proto__=t.prototype,n.prototype.constructor=n,n.id="slidercontrols",n.name="Slider Controls",n.version="0.2",n.dependencies={Controls:{}},n.prototype.add=function(e,t,n){return node.window.addSlider(e,t,n)},n.prototype.getItem=function(e,t){return node.window.getSlider(e,t)},r.prototype.__proto__=t.prototype,r.prototype.constructor=r,r.id="jqueryslidercontrols",r.name="Experimental: jQuery Slider Controls",r.version="0.13",r.dependencies={jQuery:{},Controls:{}},r.prototype.add=function(e,t,n){var r=jQuery("<div/>",{id:t}).slider(),i=r.appendTo(e);return i[0]},r.prototype.getItem=function(e,t){var n=jQuery("<div/>",{id:e}).slider();return n},i.prototype.__proto__=t.prototype,i.prototype.constructor=i,i.id="radiocontrols",i.name="Radio Controls",i.version="0.1.1",i.dependencies={Controls:{}},i.prototype.add=function(e,t,n){return"undefined"==typeof n.name&&(n.name=this.groupName),node.window.addRadioButton(e,t,n)},i.prototype.getItem=function(e,t){return"undefined"==typeof t.name&&(t.name=this.groupName),node.window.getRadioButton(e,t)},i.prototype.getAllValues=function(){for(var e in this.features)if(this.features.hasOwnProperty(e)){var t=node.window.getElementById(e);if(t.checked)return t.value}return!1}}(node.window.widgets),function(e){function t(e){this.id=e.id,this.gameLoop=node.game.gameLoop,this.fieldset={legend:"State"},this.root=null,this.table=new Table}e.VisualState=t,GameState=node.GameState,JSUS=node.JSUS,Table=node.window.Table,t.id="visualstate",t.name="Visual State",t.version="0.2.1",t.description="Visually display current, previous and next state of the game.",t.dependencies={JSUS:{},Table:{}},t.prototype.init=function(){},t.prototype.getRoot=function(){return this.root},t.prototype.append=function(e,t){var n=this,r=this.id+"_";return e.appendChild(this.table.table),this.writeState(),e},t.prototype.listeners=function(){var e=this;node.on("STATECHANGE",function(){e.writeState()})},t.prototype.writeState=function(){var e=!1,t=!1,n=!1,r="-";node.game&&node.game.state?(e=this.gameLoop.getName(node.game.state)||r,t=this.gameLoop.getName(node.game.previous())||r,n=this.gameLoop.getName(node.game.next())||r):(e="Uninitialized",t=r,n=r),this.table.clear(!0),this.table.addRow(["Previous: ",t]),this.table.addRow(["Current: ",e]),this.table.addRow(["Next: ",n]);var i=this.table.select("y","=",2);i.addClass("strong"),i.select("x","=",0).addClass("underline"),this.table.parse()}}(node.window.widgets),function(e){function t(e){this.id=e.id,this.fieldset={legend:"Player Status"},this.root=null,this.table=new Table}JSUS=node.JSUS,Table=node.window.Table,e.StateDisplay=t,t.id="statedisplay",t.name="State Display",t.version="0.4.1",t.description="Display basic information about player's status.",t.prototype.init=function(){},t.prototype.getRoot=function(){return this.root},t.prototype.append=function(e){var t=this,n=this.id+"_",r=n+"fieldset",i=n+"player",s=n+"state",o=setInterval(function(e,n){node.player!==null&&(clearInterval(o),t.updateAll())},100);return e.appendChild(this.table.table),this.root=e,e},t.prototype.updateAll=function(){this.table.clear(!0),this.table.addRow(["Name: ",node.player.name]),this.table.addRow(["State: ",(new GameState(node.state)).toString()]),this.table.addRow(["Id: ",node.player.id]),this.table.parse()},t.prototype.listeners=function(){var e=this,t=node.actions.SAY+".",n=node.actions.SET+".",r=node.actions.GET+".",i=node.IN,s=node.OUT;node.on("STATECHANGE",function(){e.updateAll(node.state)})}}(node.window.widgets),function(e){function s(e,t){r.call(this,e,t),this.options=e,this.id=e.id,this.name=e.name||"Dynamic Table",this.fieldset={legend:this.name,id:this.id+"_fieldset"},this.root=null,this.bindings={},this.init(this.options)}var t=node.GameState,n=node.PlayerList,r=node.window.Table,i=node.window.HTMLRenderer;s.prototype=new r,s.prototype.constructor=r,e.DynamicTable=s,s.id="dynamictable",s.name="Dynamic Table",s.version="0.3.1",s.dependencies={Table:{},JSUS:{},HTMLRenderer:{}},s.prototype.init=function(e){this.options=e,this.name=e.name||this.name,this.auto_update="undefined"!=typeof e.auto_update?e.auto_update:!0,this.replace=e.replace||!1,this.htmlRenderer=new i({renderers:e.renderers}),this.c("state",t.compare),this.setLeft([]),this.parse(!0)},s.prototype.bind=function(e,t){if(!e||!t)return;var n=this;node.on(e,function(e){if(t.x||t.y){var i;n.replace?i=function(i,s){var o=n.get(i,s);if(o.length!==0)for(var u=0;u<o.length;u++)t.cell.call(n,e,o[u]);else{var a=t.cell.call(n,e,new r.Cell({x:i,y:s}));n.add(a)}}:i=function(i,s){var o=t.cell.call(n,e,new r.Cell({x:i,y:s}));n.add(o,i,s)};var s=t.x.call(n,e),o=t.y.call(n,e);if(s&&o){s=s instanceof Array?s:[s],o=o instanceof Array?o:[o];for(var u=0;u<s.length;u++)for(var a=0;a<o.length;a++)i.call(n,s[u],o[a])}}if(t.header){var f=t.header.call(n,e);f=f instanceof Array?f:[f],n.setHeader(f)}if(t.left){var l=t.left.call(n,e);JSUS.in_array(l,n.left)||n.header.push(l)}n.auto_update&&n.parse()})},s.prototype.append=function(e){return this.root=e,e.appendChild(this.table),e},s.prototype.listeners=function(){}}(node.window.widgets),function(e){function t(e){this.id=e.id,this.board=null,this.root=null,this.noPlayers="No players connected...",this.fieldset={legend:"Game State"}}e.GameBoard=t,GameState=node.GameState,PlayerList=node.PlayerList,t.id="gboard",t.name="GameBoard",t.version="0.3.2",t.description="Offer a visual representation of the state of all players in the game.",t.prototype.init=function(){},t.prototype.getRoot=function(){return this.root},t.prototype.append=function(e){return this.root=e,this.board=node.window.addDiv(e,this.id),this.updateBoard(node.game.pl),e},t.prototype.listeners=function(){var e=this,t=node.actions.SAY+".",n=node.actions.SET+".",r=node.actions.GET+".";node.on("UPDATED_PLIST",function(){node.log("I Updating Board"),e.updateBoard(node.game.pl)})},t.prototype.updateBoard=function(e){var t=this;t.board.innerHTML="Updating...",e.length?(t.board.innerHTML="",e.forEach(function(e){var n="["+e.id+"|"+e.name+"]> 	",r="("+e.state.round+") "+e.state.state+"."+e.state.step;r+=" ";switch(e.state.is){case GameState.iss.UNKNOWN:r+="(unknown)";break;case GameState.iss.LOADING:r+="(loading)";break;case GameState.iss.LOADED:r+="(loaded)";break;case GameState.iss.PLAYING:r+="(playing)";break;case GameState.iss.DONE:r+="(done)";break;default:r+="("+e.state.is+")"}e.state.paused&&(r+=" (P)"),t.board.innerHTML+=n+r+'\n<hr style="color: #CCC;"/>\n'})):t.board.innerHTML=t.noPlayers}}(node.window.widgets),function(e,t){function r(e){this.options=e,this.id=e.id,this.table=new n({id:"cf_table"}),this.root=e.root||document.createElement("div"),this.root.id=this.id,this.sc=node.window.getWidget("Controls.Slider"),this.fp=null,this.canvas=null,this.dims=null,this.change="CF_CHANGE";var t=this;this.changeFunc=function(){t.draw(t.sc.getAllValues())},this.features=null,this.controls=null,this.init(this.options)}function i(e,t){this.canvas=new node.window.Canvas(e),this.scaleX=e.width/r.defaults.canvas.width,this.scaleY=e.height/r.defaults.canvas.heigth}function s(e){var e=e||{};this.scaleX=e.scaleX||1,this.scaleY=e.scaleY||1,this.color=e.color||"green",this.lineWidth=e.lineWidth||1;for(var t in s.defaults)s.defaults.hasOwnProperty(t)&&(e.hasOwnProperty(t)?this[t]=e[t]:this[t]=s.defaults[t].value)}var n=node.window.Table;e.ChernoffFaces=r,e.ChernoffFaces.FaceVector=s,e.ChernoffFaces.FacePainter=i,r.defaults={},r.defaults.canvas={},r.defaults.canvas.width=100,r.defaults.canvas.heigth=100,r.id="ChernoffFaces",r.name="Chernoff Faces",r.version="0.3",r.description="Display parametric data in the form of a Chernoff Face.",r.dependencies={JSUS:{},Table:{},Canvas:{},"Controls.Slider":{}},r.prototype.init=function(e){var n=this;this.id=e.id||this.id;var o=this.id+"_";this.features=e.features||this.features||s.random(),this.controls="undefined"!=typeof e.controls?e.controls:!0;var u=e.idCanvas?e.idCanvas:o+"canvas",a=e.idButton?e.idButton:o+"button";this.dims={width:e.width?e.width:r.defaults.canvas.width,height:e.height?e.height:r.defaults.canvas.heigth},this.canvas=node.window.getCanvas(u,this.dims),this.fp=new i(this.canvas),this.fp.draw(new s(this.features));var f={id:"cf_controls",features:t.mergeOnKey(s.defaults,this.features,"value"),change:this.change,fieldset:{id:this.id+"_controls_fieldest",legend:this.controls.legend||"Controls"},submit:"Send"};this.sc=node.window.getWidget("Controls.Slider",f),this.controls&&this.table.add(this.sc),"undefined"==typeof e.change?node.on(this.change,this.changeFunc):(e.change?node.on(e.change,this.changeFunc):node.removeListener(this.change,this.changeFunc),this.change=e.change),this.table.add(this.canvas),this.table.parse(),this.root.appendChild(this.table.table)},r.prototype.getRoot=function(){return this.root},r.prototype.getCanvas=function(){return this.canvas},r.prototype.append=function(e){return e.appendChild(this.root),this.table.parse(),this.root},r.prototype.listeners=function(){},r.prototype.draw=function(e){if(!e)return;var n=new s(e);this.fp.redraw(n),this.sc.init({features:t.mergeOnKey(s.defaults,e,"value")}),this.sc.refresh()},r.prototype.getAllValues=function(){return this.fp.face},r.prototype.randomize=function(){var e=s.random();this.fp.redraw(e);var n={features:t.mergeOnKey(s.defaults,e,"value"),change:this.change};return this.sc.init(n),this.sc.refresh(),!0},i.prototype.draw=function(e,t,n){if(!e)return;this.face=e,this.fit2Canvas(e),this.canvas.scale(e.scaleX,e.scaleY);var t=t||this.canvas.centerX,n=n||this.canvas.centerY;this.drawHead(e,t,n),this.drawEyes(e,t,n),this.drawPupils(e,t,n),this.drawEyebrow(e,t,n),this.drawNose(e,t,n),this.drawMouth(e,t,n)},i.prototype.redraw=function(e,t,n){this.canvas.clear(),this.draw(e,t,n)},i.prototype.scale=function(e,t){this.canvas.scale(this.scaleX,this.scaleY)},i.prototype.fit2Canvas=function(e){if(!this.canvas){console.log("No canvas found");return}if(this.canvas.width>this.canvas.height)var t=this.canvas.width/e.head_radius*e.head_scale_x;else var t=this.canvas.height/e.head_radius*e.head_scale_y;e.scaleX=t/2,e.scaleY=t/2},i.prototype.drawHead=function(e,t,n){var r=e.head_radius;this.canvas.drawOval({x:t,y:n,radius:r,scale_x:e.head_scale_x,scale_y:e.head_scale_y,color:e.color,lineWidth:e.lineWidth})},i.prototype.drawEyes=function(e,t,n){var r=i.computeFaceOffset(e,e.eye_height,n),s=e.eye_spacing,o=e.eye_radius;this.canvas.drawOval({x:t-s,y:r,radius:o,scale_x:e.eye_scale_x,scale_y:e.eye_scale_y,color:e.color,lineWidth:e.lineWidth}),this.canvas.drawOval({x:t+s,y:r,radius:o,scale_x:e.eye_scale_x,scale_y:e.eye_scale_y,color:e.color,lineWidth:e.lineWidth})},i.prototype.drawPupils=function(e,t,n){var r=e.pupil_radius,s=e.eye_spacing,o=i.computeFaceOffset(e,e.eye_height,n);this.canvas.drawOval({x:t-s,y:o,radius:r,scale_x:e.pupil_scale_x,scale_y:e.pupil_scale_y,color:e.color,lineWidth:e.lineWidth}),this.canvas.drawOval({x:t+s,y:o,radius:r,scale_x:e.pupil_scale_x,scale_y:e.pupil_scale_y,color:e.color,lineWidth:e.lineWidth})},i.prototype.drawEyebrow=function(e,t,n){var r=i.computeEyebrowOffset(e,n),s=e.eyebrow_spacing,o=e.eyebrow_length,u=e.eyebrow_angle;this.canvas.drawLine({x:t-s,y:r,length:o,angle:u,color:e.color,lineWidth:e.lineWidth}),this.canvas.drawLine({x:t+s,y:r,length:0-o,angle:-u,color:e.color,lineWidth:e.lineWidth})},i.prototype.drawNose=function(e,t,n){var r=i.computeFaceOffset(e,e.nose_height,n),s=t+e.nose_width/2,o=r+e.nose_length,u=s-e.nose_width,a=o;this.canvas.ctx.lineWidth=e.lineWidth,this.canvas.ctx.strokeStyle=e.color,this.canvas.ctx.save(),this.canvas.ctx.beginPath(),this.canvas.ctx.moveTo(t,r),this.canvas.ctx.lineTo(s,o),this.canvas.ctx.lineTo(u,a),this.canvas.ctx.stroke(),this.canvas.ctx.restore()},i.prototype.drawMouth=function(e,t,n){var r=i.computeFaceOffset(e,e.mouth_height,n),s=t-e.mouth_width/2,o=t+e.mouth_width/2,u=r-e.mouth_top_y,a=r+e.mouth_bottom_y;this.canvas.ctx.moveTo(s,r),this.canvas.ctx.quadraticCurveTo(t,u,o,r),this.canvas.ctx.stroke(),this.canvas.ctx.moveTo(s,r),this.canvas.ctx.quadraticCurveTo(t,a,o,r),this.canvas.ctx.stroke()},i.computeFaceOffset=function(e,t,n){var n=n||0,r=n-e.head_radius+e.head_radius*2*t;return r},i.computeEyebrowOffset=function(e,t){var t=t||0,n=2;return i.computeFaceOffset(e,e.eye_height,t)-n-e.eyebrow_eyedistance},s.defaults={head_radius:{min:10,max:100,step:.01,value:30,label:"Face radius"},head_scale_x:{min:.2,max:2,step:.01,value:.5,label:"Scale head horizontally"},head_scale_y:{min:.2,max:2,step:.01,value:1,label:"Scale head vertically"},eye_height:{min:.1,max:.9,step:.01,value:.4,label:"Eye height"},eye_radius:{min:2,max:30,step:.01,value:5,label:"Eye radius"},eye_spacing:{min:0,max:50,step:.01,value:10,label:"Eye spacing"},eye_scale_x:{min:.2,max:2,step:.01,value:1,label:"Scale eyes horizontally"},eye_scale_y:{min:.2,max:2,step:.01,value:1,label:"Scale eyes vertically"},pupil_radius:{min:1,max:9,step:.01,value:1,label:"Pupil radius"},pupil_scale_x:{min:.2,max:2,step:.01,value:1,label:"Scale pupils horizontally"},pupil_scale_y:{min:.2,max:2,step:.01,value:1,label:"Scale pupils vertically"},eyebrow_length:{min:1,max:30,step:.01,value:10,label:"Eyebrow length"},eyebrow_eyedistance:{min:.3,max:10,step:.01,value:3,label:"Eyebrow from eye"},eyebrow_angle:{min:-2,max:2,step:.01,value:-0.5,label:"Eyebrow angle"},eyebrow_spacing:{min:0,max:20,step:.01,value:5,label:"Eyebrow spacing"},nose_height:{min:.4,max:1,step:.01,value:.4,label:"Nose height"},nose_length:{min:.2,max:30,step:.01,value:15,label:"Nose length"},nose_width:{min:0,max:30,step:.01,value:10,label:"Nose width"},mouth_height:{min:.2,max:2,step:.01,value:.75,label:"Mouth height"},mouth_width:{min:2,max:100,step:.01,value:20,label:"Mouth width"},mouth_top_y:{min:-10,max:30,step:.01,value:-2,label:"Upper lip"},mouth_bottom_y:{min:-10,max:30,step:.01,value:20,label:"Lower lip"}},s.random=function(){var e={};for(var n in s.defaults)s.defaults.hasOwnProperty(n)&&(t.in_array(n,["color","lineWidth","scaleX","scaleY"])||(e[n]=s.defaults[n].min+Math.random()*s.defaults[n].max));return e.scaleX=1,e.scaleY=1,e.color="green",e.lineWidth=1,new s(e)},s.prototype.shuffle=function(){for(var e in this)this.hasOwnProperty(e)&&s.defaults.hasOwnProperty(e)&&e!=="color"&&(this[e]=s.defaults[e].min+Math.random()*s.defaults[e].max)},s.prototype.distance=function(e){return s.distance(this,e)},s.distance=function(e,t){var n=0,r;for(var i in e)e.hasOwnProperty(i)&&(r=e[i]-t[i],n+=r*r);return Math.sqrt(n)},s.prototype.toString=function(){var e="Face: ";for(var t in this)this.hasOwnProperty(t)&&(e+=t+" "+this[t]);return e}}(node.window.widgets,node.JSUS),function(e){function t(e){this.options=e,this.id=e.id,this.root=null,this.text="Send",this.button=document.createElement("button"),this.callback=null,this.init(this.options)}function n(e){e.event="DONE",e.text=e.text||"Done!",t.call(this,e)}e.EventButton=t,JSUS=node.JSUS,t.id="eventbutton",t.name="Event Button",t.version="0.2",t.dependencies={JSUS:{}},t.prototype.init=function(e){e=e||this.options,this.button.id=e.id||this.id;var t=e.text||this.text;while(this.button.hasChildNodes())this.button.removeChild(this.button.firstChild);this.button.appendChild(document.createTextNode(t)),this.event=e.event||this.event,this.callback=e.callback||this.callback;var n=this;this.event&&(this.button.onclick=function(){var t=!0;this.callback&&(t=e.callback.call(node.game)),t&&node.emit(n.event)})},t.prototype.append=function(e){return this.root=e,e.appendChild(this.button),e},t.prototype.listeners=function(){},e.DoneButton=n,n.prototype.__proto__=t.prototype,n.prototype.constructor=n,n.id="donebutton",n.version="0.1",n.name="Done Button",n.dependencies={EventButton:{}}}(node.window.widgets),function(e,t){function r(e){this.options=e,this.id=e.id,this.table=new n({id:"cf_table"}),this.root=e.root||document.createElement("div"),this.root.id=this.id,this.sc=node.window.getWidget("Controls.Slider"),this.fp=null,this.canvas=null,this.dims=null,this.change="CF_CHANGE";var t=this;this.changeFunc=function(){t.draw(t.sc.getAllValues())},this.features=null,this.controls=null,this.init(this.options)}function i(e,t){this.canvas=new node.window.Canvas(e),this.scaleX=e.width/r.defaults.canvas.width,this.scaleY=e.height/r.defaults.canvas.heigth}function s(e){e=e||{},this.scaleX=e.scaleX||1,this.scaleY=e.scaleY||1,this.color=e.color||"green",this.lineWidth=e.lineWidth||1;for(var t in s.defaults)s.defaults.hasOwnProperty(t)&&(e.hasOwnProperty(t)?this[t]=e[t]:this[t]=s.defaults[t].value)}var n=node.window.Table;e.ChernoffFaces=r,e.ChernoffFaces.FaceVector=s,e.ChernoffFaces.FacePainter=i,r.defaults={},r.defaults.canvas={},r.defaults.canvas.width=100,r.defaults.canvas.heigth=100,r.id="ChernoffFaces",r.name="Chernoff Faces",r.version="0.3",r.description="Display parametric data in the form of a Chernoff Face.",r.dependencies={JSUS:{},Table:{},Canvas:{},"Controls.Slider":{}},r.prototype.init=function(e){var n=this;this.id=e.id||this.id;var o=this.id+"_";this.features=e.features||this.features||s.random(),this.controls="undefined"!=typeof e.controls?e.controls:!0;var u=e.idCanvas?e.idCanvas:o+"canvas",a=e.idButton?e.idButton:o+"button";this.dims={width:e.width?e.width:r.defaults.canvas.width,height:e.height?e.height:r.defaults.canvas.heigth},this.canvas=node.window.getCanvas(u,this.dims),this.fp=new i(this.canvas),this.fp.draw(new s(this.features));var f={id:"cf_controls",features:t.mergeOnKey(s.defaults,this.features,"value"),change:this.change,fieldset:{id:this.id+"_controls_fieldest",legend:this.controls.legend||"Controls"},submit:"Send"};this.sc=node.window.getWidget("Controls.Slider",f),this.controls&&this.table.add(this.sc),"undefined"==typeof e.change?node.on(this.change,this.changeFunc):(e.change?node.on(e.change,this.changeFunc):node.removeListener(this.change,this.changeFunc),this.change=e.change),this.table.add(this.canvas),this.table.parse(),this.root.appendChild(this.table.table)},r.prototype.getRoot=function(){return this.root},r.prototype.getCanvas=function(){return this.canvas},r.prototype.append=function(e){return e.appendChild(this.root),this.table.parse(),this.root},r.prototype.listeners=function(){},r.prototype.draw=function(e){if(!e)return;var n=new s(e);this.fp.redraw(n),this.sc.init({features:t.mergeOnKey(s.defaults,e,"value")}),this.sc.refresh()},r.prototype.getAllValues=function(){return this.fp.face},r.prototype.randomize=function(){var e=s.random();this.fp.redraw(e);var n={features:t.mergeOnValue(s.defaults,e),change:this.change};return this.sc.init(n),this.sc.refresh(),!0},i.prototype.draw=function(e,t,n){if(!e)return;this.face=e,this.fit2Canvas(e),this.canvas.scale(e.scaleX,e.scaleY),t=t||this.canvas.centerX,n=n||this.canvas.centerY,this.drawHead(e,t,n),this.drawEyes(e,t,n),this.drawPupils(e,t,n),this.drawEyebrow(e,t,n),this.drawNose(e,t,n),this.drawMouth(e,t,n)},i.prototype.redraw=function(e,t,n){this.canvas.clear(),this.draw(e,t,n)},i.prototype.scale=function(e,t){this.canvas.scale(this.scaleX,this.scaleY)},i.prototype.fit2Canvas=function(e){if(!this.canvas){console.log("No canvas found");return}var t;this.canvas.width>this.canvas.height?ratio=this.canvas.width/e.head_radius*e.head_scale_x:ratio=this.canvas.height/e.head_radius*e.head_scale_y,e.scaleX=ratio/2,e.scaleY=ratio/2},i.prototype.drawHead=function(e,t,n){var r=e.head_radius;this.canvas.drawOval({x:t,y:n,radius:r,scale_x:e.head_scale_x,scale_y:e.head_scale_y,color:e.color,lineWidth:e.lineWidth})},i.prototype.drawEyes=function(e,t,n){var r=i.computeFaceOffset(e,e.eye_height,n),s=e.eye_spacing,o=e.eye_radius;this.canvas.drawOval({x:t-s,y:r,radius:o,scale_x:e.eye_scale_x,scale_y:e.eye_scale_y,color:e.color,lineWidth:e.lineWidth}),this.canvas.drawOval({x:t+s,y:r,radius:o,scale_x:e.eye_scale_x,scale_y:e.eye_scale_y,color:e.color,lineWidth:e.lineWidth})},i.prototype.drawPupils=function(e,t,n){var r=e.pupil_radius,s=e.eye_spacing,o=i.computeFaceOffset(e,e.eye_height,n);this.canvas.drawOval({x:t-s,y:o,radius:r,scale_x:e.pupil_scale_x,scale_y:e.pupil_scale_y,color:e.color,lineWidth:e.lineWidth}),this.canvas.drawOval({x:t+s,y:o,radius:r,scale_x:e.pupil_scale_x,scale_y:e.pupil_scale_y,color:e.color,lineWidth:e.lineWidth})},i.prototype.drawEyebrow=function(e,t,n){var r=i.computeEyebrowOffset(e,n),s=e.eyebrow_spacing,o=e.eyebrow_length,u=e.eyebrow_angle;this.canvas.drawLine({x:t-s,y:r,length:o,angle:u,color:e.color,lineWidth:e.lineWidth}),this.canvas.drawLine({x:t+s,y:r,length:0-o,angle:-u,color:e.color,lineWidth:e.lineWidth})},i.prototype.drawNose=function(e,t,n){var r=i.computeFaceOffset(e,e.nose_height,n),s=t+e.nose_width/2,o=r+e.nose_length,u=s-e.nose_width,a=o;this.canvas.ctx.lineWidth=e.lineWidth,this.canvas.ctx.strokeStyle=e.color,this.canvas.ctx.save(),this.canvas.ctx.beginPath(),this.canvas.ctx.moveTo(t,r),this.canvas.ctx.lineTo(s,o),this.canvas.ctx.lineTo(u,a),this.canvas.ctx.stroke(),this.canvas.ctx.restore()},i.prototype.drawMouth=function(e,t,n){var r=i.computeFaceOffset(e,e.mouth_height,n),s=t-e.mouth_width/2,o=t+e.mouth_width/2,u=r-e.mouth_top_y,a=r+e.mouth_bottom_y;this.canvas.ctx.moveTo(s,r),this.canvas.ctx.quadraticCurveTo(t,u,o,r),this.canvas.ctx.stroke(),this.canvas.ctx.moveTo(s,r),this.canvas.ctx.quadraticCurveTo(t,a,o,r),this.canvas.ctx.stroke()},i.computeFaceOffset=function(e,t,n){n=n||0;var r=n-e.head_radius+e.head_radius*2*t;return r},i.computeEyebrowOffset=function(e,t){t=t||0;var n=2;return i.computeFaceOffset(e,e.eye_height,t)-n-e.eyebrow_eyedistance},s.defaults={head_radius:{min:10,max:100,step:.01,value:30,label:"Face radius"},head_scale_x:{min:.2,max:2,step:.01,value:.5,label:"Scale head horizontally"},head_scale_y:{min:.2,max:2,step:.01,value:1,label:"Scale head vertically"},eye_height:{min:.1,max:.9,step:.01,value:.4,label:"Eye height"},eye_radius:{min:2,max:30,step:.01,value:5,label:"Eye radius"},eye_spacing:{min:0,max:50,step:.01,value:10,label:"Eye spacing"},eye_scale_x:{min:.2,max:2,step:.01,value:1,label:"Scale eyes horizontally"},eye_scale_y:{min:.2,max:2,step:.01,value:1,label:"Scale eyes vertically"},pupil_radius:{min:1,max:9,step:.01,value:1,label:"Pupil radius"},pupil_scale_x:{min:.2,max:2,step:.01,value:1,label:"Scale pupils horizontally"},pupil_scale_y:{min:.2,max:2,step:.01,value:1,label:"Scale pupils vertically"},eyebrow_length:{min:1,max:30,step:.01,value:10,label:"Eyebrow length"},eyebrow_eyedistance:{min:.3,max:10,step:.01,value:3,label:"Eyebrow from eye"},eyebrow_angle:{min:-2,max:2,step:.01,value:-0.5,label:"Eyebrow angle"},eyebrow_spacing:{min:0,max:20,step:.01,value:5,label:"Eyebrow spacing"},nose_height:{min:.4,max:1,step:.01,value:.4,label:"Nose height"},nose_length:{min:.2,max:30,step:.01,value:15,label:"Nose length"},nose_width:{min:0,max:30,step:.01,value:10,label:"Nose width"},mouth_height:{min:.2,max:2,step:.01,value:.75,label:"Mouth height"},mouth_width:{min:2,max:100,step:.01,value:20,label:"Mouth width"},mouth_top_y:{min:-10,max:30,step:.01,value:-2,label:"Upper lip"},mouth_bottom_y:{min:-10,max:30,step:.01,value:20,label:"Lower lip"}},s.random=function(){var e={};for(var n in s.defaults)s.defaults.hasOwnProperty(n)&&(t.in_array(n,["color","lineWidth","scaleX","scaleY"])||(e[n]=s.defaults[n].min+Math.random()*s.defaults[n].max));return e.scaleX=1,e.scaleY=1,e.color="green",e.lineWidth=1,new s(e)},s.prototype.shuffle=function(){for(var e in this)this.hasOwnProperty(e)&&s.defaults.hasOwnProperty(e)&&e!=="color"&&(this[e]=s.defaults[e].min+Math.random()*s.defaults[e].max)},s.prototype.distance=function(e){return s.distance(this,e)},s.distance=function(e,t){var n=0,r;for(var i in e)e.hasOwnProperty(i)&&(r=e[i]-t[i],n+=r*r);return Math.sqrt(n)},s.prototype.toString=function(){var e="Face: ";for(var t in this)this.hasOwnProperty(t)&&(e+=t+" "+this[t]);return e}}(node.window.widgets,node.JSUS),function(e){function t(e){this.game=node.game,this.id=e.id,this.fieldset={legend:"Game Summary"},this.summaryDiv=null}e.GameSummary=t,t.id="gamesummary",t.name="Game Summary",t.version="0.3",t.description="Show the general configuration options of the game.",t.prototype.init=function(){},t.prototype.append=function(e){return this.root=e,this.summaryDiv=node.window.addDiv(e),this.writeSummary(),e},t.prototype.getRoot=function(){return this.root},t.prototype.writeSummary=function(e,t){var n=document.createTextNode("Name: "+this.game.name),r=document.createTextNode("Descr: "+this.game.description),i=document.createTextNode("Min Pl.: "+this.game.minPlayers),s=document.createTextNode("Max Pl.: "+this.game.maxPlayers);this.summaryDiv.appendChild(n),this.summaryDiv.appendChild(document.createElement("br")),this.summaryDiv.appendChild(r),this.summaryDiv.appendChild(document.createElement("br")),this.summaryDiv.appendChild(i),this.summaryDiv.appendChild(document.createElement("br")),this.summaryDiv.appendChild(s),node.window.addDiv(this.root,this.summaryDiv,t)},t.prototype.listeners=function(){}}(node.window.widgets),function(e){function t(e){this.id=t.id,this.fieldset={legend:"Earnings"},this.root=null,this.spanCurrency=document.createElement("span"),this.spanMoney=document.createElement("span"),this.currency="EUR",this.money=0,this.precision=2,this.init(e)}e.MoneyTalks=t,JSUS=node.JSUS,t.id="moneytalks",t.name="Money talks",t.version="0.1.0",t.description="Display the earnings of a player.",t.dependencies={JSUS:{}},t.prototype.init=function(e){this.currency=e.currency||this.currency,this.money=e.money||this.money,this.precision=e.precision||this.precision,this.spanCurrency.id=e.idCurrency||this.spanCurrency.id||"moneytalks_currency",this.spanMoney.id=e.idMoney||this.spanMoney.id||"moneytalks_money",this.spanCurrency.innerHTML=this.currency,this.spanMoney.innerHTML=this.money},t.prototype.getRoot=function(){return this.root},t.prototype.append=function(e,t){var n=this.id+"_";return e.appendChild(this.spanMoney),e.appendChild(this.spanCurrency),e},t.prototype.listeners=function(){var e=this;node.on("MONEYTALKS",function(t){e.update(t)})},t.prototype.update=function(e){if("number"!=typeof e)return;this.money+=e,this.spanMoney.innerHTML=this.money.toFixed(this.precision)}}(node.window.widgets),function(e){function r(e){this.id=e.id,this.recipient=null,this.actionSel=null,this.targetSel=null,this.table=new n,this.fieldset={legend:"Send MSG"},this.init()}var t=node.GameMsg,n=node.window.Table;e.MsgBar=r,r.id="msgbar",r.name="Msg Bar",r.version="0.4",r.description="Send a nodeGame message to players",r.prototype.init=function(){var e=this,n=new t,r=0;for(var i in n)if(n.hasOwnProperty(i)){var s=this.id+"_"+i;this.table.add(i,0,r),this.table.add(node.window.getTextInput(s),1,r),i==="target"?(this.targetSel=node.window.getTargetSelector(this.id+"_targets"),this.table.add(this.targetSel,2,r),this.targetSel.onchange=function(){node.window.getElementById(e.id+"_target").value=e.targetSel.value}):i==="action"?(this.actionSel=node.window.getActionSelector(this.id+"_actions"),this.table.add(this.actionSel,2,r),this.actionSel.onchange=function(){node.window.getElementById(e.id+"_action").value=e.actionSel.value}):i==="to"&&(this.recipient=node.window.getRecipientSelector(this.id+"recipients"),this.table.add(this.recipient,2,r),this.recipient.onchange=function(){node.window.getElementById(e.id+"_to").value=e.recipient.value}),r++}this.table.parse()},r.prototype.append=function(e){var t=node.window.addButton(e),n=node.window.addButton(e,"stub","Add Stub"),r=this;return t.onclick=function(){var e=r.parse();node.node.gsc.send(e)},n.onclick=function(){r.addStub()},e.appendChild(this.table.table),this.root=e,e},r.prototype.getRoot=function(){return this.root},r.prototype.listeners=function(){var e=this;node.onPLIST(function(t){node.window.populateRecipientSelector(e.recipient,t.data)})},r.prototype.parse=function(){var e={},n=this,r=null,i=null;return this.table.forEach(function(t){if(t.x===0)r=t.content,e[r]="";else if(t.x===1){i=t.content.value;if(r==="state"||r==="data")try{i=JSON.parse(t.content.value)}catch(n){i=t.content.value}e[r]=i}}),console.log(e),new t(e)},r.prototype.addStub=function(){node.window.getElementById(this.id+"_from").value=node.player?node.player.id:"undefined",node.window.getElementById(this.id+"_to").value=this.recipient.value,node.window.getElementById(this.id+"_forward").value=0,node.window.getElementById(this.id+"_reliable").value=1,node.window.getElementById(this.id+"_priority").value=0,node.gsc&&node.gsc.session&&(node.window.getElementById(this.id+"_session").value=node.gsc.session),node.window.getElementById(this.id+"_state").value=JSON.stringify(node.state),node.window.getElementById(this.id+"_action").value=this.actionSel.value,node.window.getElementById(this.id+"_target").value=this.targetSel.value}}(node.window.widgets),function(e){function t(e){this.options=e,this.id=e.id,this.gameTimer=null,this.timerDiv=null,this.root=null,this.fieldset={legend:"Time left",id:this.id+"_fieldset"},this.init(this.options)}e.VisualTimer=t,JSUS=node.JSUS,t.id="visualtimer",t.name="Visual Timer",t.version="0.3.3",t.description="Display a timer for the game. Timer can trigger events. Only for countdown smaller than 1h.",t.dependencies={GameTimer:{},JSUS:{}},t.prototype.init=function(e){e=e||this.options;var t=this;(function(){e.hooks?!e.hooks instanceof Array&&(e.hooks=[e.hooks]):e.hooks=[],e.hooks.push({hook:t.updateDisplay,ctx:t})})(),this.gameTimer=e.gameTimer||new node.GameTimer,this.gameTimer?this.gameTimer.init(e):node.log("GameTimer object could not be initialized. VisualTimer will not work properly.","ERR")},t.prototype.getRoot=function(){return this.root},t.prototype.append=function(e){return this.root=e,this.timerDiv=node.window.addDiv(e,this.id+"_div"),this.updateDisplay(),e},t.prototype.updateDisplay=function(){if(!this.gameTimer.milliseconds||this.gameTimer.milliseconds===0){this.timerDiv.innerHTML="00:00";return}var e=this.gameTimer.milliseconds-this.gameTimer.timePassed;e=JSUS.parseMilliseconds(e);var t=e[2]<10?"0"+e[2]:e[2],n=e[3]<10?"0"+e[3]:e[3];this.timerDiv.innerHTML=t+":"+n},t.prototype.start=function(){this.updateDisplay(),this.gameTimer.start()},t.prototype.restart=function(e){this.init(e),this.start()},t.prototype.stop=function(e){this.gameTimer.stop()},t.prototype.resume=function(e){this.gameTimer.resume()},t.prototype.listeners=function(){var e=this;node.on("LOADED",function(){var t=node.game.gameLoop.getAllParams(node.game.gameState).timer;if(t){t=JSUS.clone(t),e.timerDiv.className="";var n={},r=typeof t;switch(r){case"number":n.milliseconds=t;break;case"object":n=t;break;case"function":n.milliseconds=t;break;case"string":n.milliseconds=Number(t)}if(!n.milliseconds)return;"function"==typeof n.milliseconds&&(n.milliseconds=n.milliseconds.call(node.game)),n.timeup||(n.timeup="DONE"),e.gameTimer.init(n),e.start()}}),node.on("DONE",function(){e.gameTimer.stop(),e.timerDiv.className="strike"})}}(node.window.widgets),function(e){function t(e){this.game=node.game,this.id=e.id||t.id,this.fieldset={legend:"Rew-Fwd"}}e.NextPreviousState=t,t.id="nextprevious",t.name="Next,Previous State",t.version="0.3.1",t.description="Adds two buttons to push forward or rewind the state of the game by one step.",t.prototype.init=function(){},t.prototype.getRoot=function(){return this.root},t.prototype.append=function(e){var t=this.id+"_button",n=this.id+"_button",r=node.window.addButton(e,t,"<<"),i=node.window.addButton(e,n,">>"),s=this,o=function(e){if(e){var t=node.IN+node.actions.SAY+".STATE",n=node.msg.createSTATE(t,e);node.emit(t,n),t=node.OUT+node.actions.SAY+".STATE",node.emit(t,e,"ALL")}else node.log("No next/previous state. Not sent","ERR")};return i.onclick=function(){o(s.game.next())},r.onclick=function(){o(s.game.previous())},this.root=e,e},t.prototype.listeners=function(){}}(node.window.widgets),function(e){function n(e){this.id=e.id||n.id,this.name=e.name||this.name,this.buffer=[],this.counter=0,this.wall=node.window.getElement("pre",this.id),this.fieldset={legend:"Game Log",id:this.id}}e.Wall=n;var t=node.JSUS;n.id="wall",n.name="Wall",n.version="0.3",n.description="Intercepts all LOG events and prints them ",n.description+="into a DIV element with an ordinal number and a timestamp.",n.dependencies={JSUS:{}},n.prototype.init=function(e){e=e||{},this.counter=e.counter||this.counter},n.prototype.append=function(e){return e.appendChild(this.wall)},n.prototype.getRoot=function(){return this.wall},n.prototype.listeners=function(){var e=this;node.on("LOG",function(t){e.debuffer(),e.write(t)})},n.prototype.write=function(e){if(document.readyState!=="complete")this.buffer.push(s);else{var n=this.counter++ +") "+t.getTime()+" ";this.wall.innerHTML=n+e+"\n"+this.wall.innerHTML}},n.prototype.debuffer=function(){if(document.readyState==="complete"&&this.buffer.length>0){for(var e=0;e<this.buffer.length;e++)this.write(this.buffer[e]);this.buffer=[]}}}(node.window.widgets),function(e){function r(e){this.options=e,this.id=e.id,this.name=e.name||r.name,this.fieldset={legend:this.name,id:this.id+"_fieldset"},this.root=null,this.gtbl=null,this.plist=null,this.init(this.options)}var t=node.GameState,n=node.PlayerList;e.GameTable=r,r.id="gametable",r.name="Game Table",r.version="0.2",r.dependencies={JSUS:{}},r.prototype.init=function(e){this.plist||(this.plist=new n),this.gtbl=new node.window.Table({auto_update:!0,id:e.id||this.id,render:e.render},node.game.memory.db),this.gtbl.c("state",t.compare),this.gtbl.setLeft([]),this.gtbl.parse(!0)},r.prototype.addRenderer=function(e){return this.gtbl.addRenderer(e)},r.prototype.resetRender=function(){return this.gtbl.resetRenderer()},r.prototype.removeRenderer=function(e){return this.gtbl.removeRenderer(e)},r.prototype.append=function(e){return this.root=e,e.appendChild(this.gtbl.table),e},r.prototype.listeners=function(){var e=this;node.onPLIST(function(t){if(!t.data.length)return;var r=new n({},t.data),i=r.diff(e.plist);i&&i.forEach(function(t){e.addPlayer(t)}),e.gtbl.parse(!0)}),node.on("in.set.DATA",function(t){e.addLeft(t.state,t.from);var n=e.player2x(t.from),r=e.state2y(node.game.state,t.text);e.gtbl.add(t.data,n,r),e.gtbl.parse(!0)})},r.prototype.addPlayer=function(e){this.plist.add(e);var t=this.plist.map(function(e){return e.name});this.gtbl.setHeader(t)},r.prototype.addLeft=function(e,n){if(!e)return;e=new t(e);if(!JSUS.in_array({content:e.toString(),type:"left"},this.gtbl.left))this.gtbl.add2Left(e.toString());else{var r=this.state2y(e),i=this.player2x(n);this.gtbl.select("y","=",r).select("x","=",i).count()>1&&this.gtbl.add2Left(e.toString())}},r.prototype.player2x=function(e){return e?this.plist.select("id","=",e).first().count:!1},r.prototype.x2Player=function(e){return e?this.plist.select("count","=",e).first().count:!1},r.prototype.state2y=function(e){return e?node.game.gameLoop.indexOf(e):!1},r.prototype.y2State=function(e){return e?node.game.gameLoop.jumpTo(new t,e):!1}}(node.window.widgets),function(e){function t(e){this.id=e.id,this.actionSel=null,this.recipient=null,this.fieldset={legend:"Change Game State"}}e.StateBar=t,t.id="statebar",t.name="State Bar",t.version="0.3.1",t.description="Provides a simple interface to change the state of the game.",t.prototype.init=function(){},t.prototype.getRoot=function(){return this.root},t.prototype.append=function(e){var t=this.id+"_",n=t+"sendButton",r=t+"stateSel",i=t+"actionSel",s=t+"recipient",o=node.window.addButton(e,n),u=node.window.addStateSelector(e,r);this.actionSel=node.window.addActionSelector(e,i),this.recipient=node.window.addRecipientSelector(e,s);var a=this;return o.onclick=function(){var e=a.recipient.value,t=/^(\d+)(?:\.(\d+))?(?::(\d+))?$/,n=t.exec(u.value);if(n!==null){var r=n[1],i=n[2]||1,s=n[3]||1;console.log("Action: "+a.actionSel.value+" Parsed State: "+n.join("|")),r=new node.GameState({state:r,step:i,round:s});var o;if(e==="ALL"){o=node.IN+node.actions.SAY+".STATE";var f=node.msg.createSTATE(o,r);node.emit(o,f)}o=node.OUT+a.actionSel.value+".STATE",node.emit(o,r,e)}else console.log("Not valid state. Not sent."),node.gsc.sendTXT("E: not valid state. Not sent")},this.root=e,e},t.prototype.listeners=function(){var e=this,t=node.actions.SAY+".",n=node.actions.SET+".",r=node.actions.GET+".";node.onPLIST(function(t){node.window.populateRecipientSelector(e.recipient,t.data)})}}(node.window.widgets)