<!DOCTYPE html>
<html>
<head>
  <title>EventEmitter_NDDB.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="../doc-style.css" />
  <script src="../doc-filelist.js"></script>
  <script>
    var relativeDir = '../', thisFile = 'lib/EventEmitter_NDDB.js';
  </script>
  <script src="../doc-script.js"></script>
</head>
<body>
  <div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">
    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container"><div class="background highlight"></div>
<table cellpadding="0" cellspacing="0">
  <tbody>
      <tr>
        <td class="docs">
          <h1>EventEmitter_NDDB.js</h1>
        </td>
        <td class="code highlight"></td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-1" id="section-1">&#182;</a>
</div>

        </td>
        <td class="code highlight"><div class="highlight"><pre><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">exports</span><span class="p">,</span> <span class="nx">node</span><span class="p">,</span> <span class="nx">NDDB</span><span class="p">,</span> <span class="nx">JSUS</span><span class="p">)</span> <span class="p">{</span> </pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-2" id="section-2">&#182;</a>
</div>
<p>node is empty now</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>  
  </pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-3" id="section-3">&#182;</a>
</div>
<div class="dox">
  <div class="summary"><ul>
<li>Expose constructor.</li>
</ul>
  </div>
  <div class="body">
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>  <span class="nx">exports</span><span class="p">.</span><span class="nx">EventEmitter</span> <span class="o">=</span> <span class="nx">EventEmitter</span><span class="p">;</span>
  </pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-4" id="section-4">&#182;</a>
</div>
<p>var parser = exports.parser = {};</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>     
  <span class="kd">function</span> <span class="nx">EventEmitter</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">_listeners</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">NDDB</span><span class="p">({</span><span class="nx">auto_sort</span><span class="o">:</span> <span class="kc">true</span><span class="p">});</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">_listeners</span><span class="p">.</span><span class="nx">globalCompare</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">l1</span><span class="p">,</span> <span class="nx">l2</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">l1</span><span class="p">.</span><span class="nx">priority</span> <span class="o">&gt;</span> <span class="nx">l2</span><span class="p">.</span><span class="nx">priority</span><span class="p">)</span> <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">l1</span><span class="p">.</span><span class="nx">priority</span> <span class="o">&lt;</span> <span class="nx">l2</span><span class="p">.</span><span class="nx">priority</span><span class="p">)</span> <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
        <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
      <span class="p">};</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-5" id="section-5">&#182;</a>
</div>
<p>this._listeners.d('state', node.GameBit.compareState);</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>      <span class="k">this</span><span class="p">.</span><span class="nx">_listeners</span><span class="p">.</span><span class="nx">d</span><span class="p">(</span><span class="s1">&#39;state&#39;</span><span class="p">,</span> <span class="nx">EMcompareState</span><span class="p">);</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-6" id="section-6">&#182;</a>
</div>
<p>console.log(EMcompareState.toString());</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>  <span class="p">};</span>
  
  <span class="kd">function</span> <span class="nx">EMcompareState</span><span class="p">(</span><span class="nx">gb1</span><span class="p">,</span> <span class="nx">gb2</span><span class="p">)</span> <span class="p">{</span>
    
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">gb1</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">gb2</span><span class="p">)</span> <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">gb1</span><span class="p">)</span> <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">gb2</span><span class="p">)</span> <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    
    <span class="kd">var</span> <span class="nx">gs1</span> <span class="o">=</span> <span class="nx">gb1</span><span class="p">.</span><span class="nx">state</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">gs2</span> <span class="o">=</span> <span class="nx">gb2</span><span class="p">.</span><span class="nx">state</span><span class="p">;</span>
    </pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-7" id="section-7">&#182;</a>
</div>
<p>TODO: check: it is correct to return FALSE, if both
states are undefined?</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>    <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;undefined&#39;</span> <span class="o">===</span> <span class="k">typeof</span> <span class="nx">gs1</span> <span class="o">&amp;&amp;</span> <span class="s1">&#39;undefined&#39;</span> <span class="o">===</span> <span class="k">typeof</span> <span class="nx">gs2</span><span class="p">)</span> <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;undefined&#39;</span> <span class="o">===</span> <span class="k">typeof</span> <span class="nx">gs1</span><span class="p">)</span> <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;undefined&#39;</span> <span class="o">===</span> <span class="k">typeof</span> <span class="nx">gs2</span><span class="p">)</span> <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    
    <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;undefined&#39;</span> <span class="o">===</span> <span class="k">typeof</span> <span class="nx">gs1</span><span class="p">.</span><span class="nx">state</span> <span class="o">&amp;&amp;</span> <span class="s1">&#39;undefined&#39;</span> <span class="o">===</span> <span class="k">typeof</span> <span class="nx">gs2</span><span class="p">.</span><span class="nx">state</span><span class="p">)</span> <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;undefined&#39;</span> <span class="o">===</span> <span class="k">typeof</span> <span class="nx">gs1</span><span class="p">.</span><span class="nx">state</span><span class="p">)</span> <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;undefined&#39;</span> <span class="o">===</span> <span class="k">typeof</span> <span class="nx">gs2</span><span class="p">.</span><span class="nx">state</span><span class="p">)</span> <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    
    
    <span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">gs1</span><span class="p">.</span><span class="nx">state</span> <span class="o">-</span> <span class="nx">gs2</span><span class="p">.</span><span class="nx">state</span><span class="p">;</span>
    
    <span class="k">if</span> <span class="p">(</span><span class="nx">result</span> <span class="o">===</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="s1">&#39;undefined&#39;</span> <span class="o">!==</span> <span class="k">typeof</span> <span class="nx">gs1</span><span class="p">.</span><span class="nx">round</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">result</span> <span class="o">=</span> <span class="nx">gs1</span><span class="p">.</span><span class="nx">round</span> <span class="o">-</span> <span class="nx">gs2</span><span class="p">.</span><span class="nx">round</span><span class="p">;</span>
    
      <span class="k">if</span> <span class="p">(</span><span class="nx">result</span> <span class="o">===</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="s1">&#39;undefined&#39;</span> <span class="o">!==</span> <span class="k">typeof</span> <span class="nx">gs1</span><span class="p">.</span><span class="nx">step</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">result</span> <span class="o">=</span> <span class="nx">gs1</span><span class="p">.</span><span class="nx">step</span> <span class="o">-</span> <span class="nx">gs2</span><span class="p">.</span><span class="nx">step</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>
    
    
    <span class="k">return</span> <span class="nx">result</span><span class="p">;</span>
  <span class="p">};</span>
  
  <span class="nx">EventEmitter</span><span class="p">.</span><span class="nx">prototype</span> <span class="o">=</span> <span class="p">{</span>
  
      <span class="nx">constructor</span><span class="o">:</span> <span class="nx">EventEmitter</span><span class="p">,</span>
    
      <span class="nx">addListener</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">type</span><span class="p">,</span> <span class="nx">listener</span><span class="p">)</span> <span class="p">{</span>
    </pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-8" id="section-8">&#182;</a>
</div>
<p>if type is an object we assume a Listener obj was passed</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>          <span class="kd">var</span> <span class="nx">l</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;object&#39;</span> <span class="o">===</span> <span class="k">typeof</span> <span class="nx">type</span><span class="p">)</span> <span class="o">?</span> <span class="nx">type</span> <span class="o">:</span> <span class="p">{</span><span class="nx">listener</span><span class="o">:</span> <span class="nx">listener</span><span class="p">,</span>
                                   <span class="nx">event</span><span class="o">:</span> <span class="nx">type</span>
          <span class="p">};</span>
          
          <span class="kd">var</span> <span class="nx">l</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Listener</span><span class="p">(</span><span class="nx">l</span><span class="p">);</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-9" id="section-9">&#182;</a>
</div>
<p>console.log('I am inserting a new listener');
console.log(l);</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>          
      <span class="k">this</span><span class="p">.</span><span class="nx">_listeners</span><span class="p">.</span><span class="nx">insert</span><span class="p">(</span><span class="nx">l</span><span class="p">);</span>
      <span class="p">},</span>
      
      <span class="nx">addLocalListener</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">type</span><span class="p">,</span> <span class="nx">listener</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">addListener</span><span class="p">(</span><span class="nx">type</span><span class="p">,</span> <span class="nx">listener</span><span class="p">);</span>
      <span class="p">},</span>
  </pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-10" id="section-10">&#182;</a>
</div>
<p>TODO: accept any number of parameters</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>      <span class="nx">emit</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">event</span><span class="p">,</span> <span class="nx">p1</span><span class="p">,</span> <span class="nx">p2</span><span class="p">,</span> <span class="nx">p3</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// Up to three params</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-11" id="section-11">&#182;</a>
</div>
<p>TODO: this is too slow...</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>        </pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-12" id="section-12">&#182;</a>
</div>

<div class="highlight"><pre><code>    <span class="k">if</span> <span class="p">(</span><span class="n">arguments</span><span class="o">.</span><span class="nb">length</span> <span class="o">!==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="sr">//</span> <span class="n">TODO:</span> <span class="n">this</span> <span class="n">operation</span> <span class="n">could</span> <span class="n">be</span> <span class="n">slow</span><span class="o">.</span> <span class="n">Can</span> <span class="n">we</span> <span class="n">avoid</span> <span class="n">it</span><span class="p">?</span>
        <span class="n">arguments</span> <span class="o">=</span> <span class="n">JSUS</span><span class="o">.</span><span class="n">obj2Array</span><span class="p">(</span><span class="n">arguments</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>
        <span class="n">var</span> <span class="n">event</span> <span class="o">=</span> <span class="n">arguments</span><span class="o">.</span><span class="nb">shift</span><span class="p">();</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="p">{</span>
        <span class="n">var</span> <span class="n">event</span> <span class="o">=</span> <span class="n">arguments</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
        <span class="n">var</span> <span class="n">arguments</span> <span class="o">=</span> <span class="o">[]</span><span class="p">;</span>
    <span class="p">}</span>
</code></pre></div>


        </td>
        <td class="code highlight"><div class="highlight"><pre>        </pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-13" id="section-13">&#182;</a>
</div>
<p>Debug
console.log('Fired ' + event);</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>        
          <span class="k">this</span><span class="p">.</span><span class="nx">_listeners</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">l</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">l</span><span class="p">.</span><span class="nx">event</span> <span class="o">===</span> <span class="nx">event</span><span class="p">)</span> <span class="p">{</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-14" id="section-14">&#182;</a>
</div>
<p>Executes the listeners only if it is still valid
Sometimes, when messages are buffered for example, 
events created in one state are fired during another
and in some situations that is a problem</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>              <span class="k">if</span> <span class="p">(</span><span class="nx">l</span><span class="p">.</span><span class="nx">state</span> <span class="o">&amp;&amp;</span> <span class="nx">l</span><span class="p">.</span><span class="nx">state</span> <span class="o">!==</span> <span class="nx">node</span><span class="p">.</span><span class="nx">game</span><span class="p">.</span><span class="nx">gameState</span><span class="p">)</span> <span class="p">{</span>
              <span class="k">if</span> <span class="p">(</span><span class="nx">l</span><span class="p">.</span><span class="nx">ttl</span> <span class="o">!==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">game</span><span class="p">.</span><span class="nx">gameLoop</span><span class="p">.</span><span class="nx">diff</span><span class="p">(</span><span class="nx">l</span><span class="p">.</span><span class="nx">state</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nx">l</span><span class="p">.</span><span class="nx">ttl</span><span class="p">)</span> <span class="p">{</span>
                  <span class="k">return</span><span class="p">;</span>
                <span class="p">}</span>
              <span class="p">}</span>
            <span class="p">}</span>
            <span class="kd">var</span> <span class="nx">target</span> <span class="o">=</span> <span class="nx">l</span><span class="p">.</span><span class="nx">target</span> <span class="o">||</span> <span class="nx">node</span><span class="p">.</span><span class="nx">game</span><span class="p">;</span>
            <span class="nx">l</span><span class="p">.</span><span class="nx">listener</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">target</span><span class="p">,</span> <span class="nx">p1</span><span class="p">,</span> <span class="nx">p2</span><span class="p">,</span> <span class="nx">p3</span><span class="p">);</span>
            <span class="p">}</span>
          <span class="p">});</span>
          </pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-15" id="section-15">&#182;</a>
</div>
<p>Global Listeners
        if (this.<em>listeners[event.type] instanceof Array) {
            var listeners = this.</em>listeners[event.type];
            for (var i=0, len=listeners.length; i &lt; len; i++) {
                //console.log('Event: ' +  event.type + ' '+ listeners[i].toString());
                listeners[i].call(this.game, p1, p2, p3);
            }
        }</p>


<div class="highlight"><pre><code>    <span class="sr">//</span> <span class="n">Local</span> <span class="n">Listeners</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">this</span><span class="o">.</span><span class="n">_localListeners</span><span class="p">[</span><span class="n">event</span><span class="o">.</span><span class="n">type</span><span class="p">]</span> <span class="n">instanceof</span> <span class="n">Array</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">var</span> <span class="n">listeners</span> <span class="o">=</span> <span class="n">this</span><span class="o">.</span><span class="n">_localListeners</span><span class="p">[</span><span class="n">event</span><span class="o">.</span><span class="n">type</span><span class="p">];</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">var</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">len</span><span class="o">=</span><span class="n">listeners</span><span class="o">.</span><span class="nb">length</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">len</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="sr">//co</span><span class="n">nsole</span><span class="o">.</span><span class="nb">log</span><span class="p">(</span><span class="s">&#39;Event: &#39;</span> <span class="o">+</span>  <span class="n">event</span><span class="o">.</span><span class="n">type</span> <span class="o">+</span> <span class="s">&#39; &#39;</span><span class="o">+</span> <span class="n">listeners</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">toString</span><span class="p">());</span>
            <span class="n">listeners</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">this</span><span class="o">.</span><span class="n">game</span><span class="p">,</span> <span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">,</span> <span class="n">p3</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
</code></pre></div>


        </td>
        <td class="code highlight"><div class="highlight"><pre>         
      <span class="p">},</span>
  
      <span class="nx">removeListener</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">,</span> <span class="nx">listener</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;undefined&#39;</span> <span class="o">===</span> <span class="k">typeof</span> <span class="nx">event</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
    
      <span class="kd">var</span> <span class="nx">listeners</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_listeners</span><span class="p">.</span><span class="nx">select</span><span class="p">(</span><span class="s1">&#39;event&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="nx">event</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">listeners</span><span class="p">.</span><span class="nx">size</span><span class="p">()</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="k">return</span> <span class="kc">false</span><span class="p">;</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-16" id="section-16">&#182;</a>
</div>
<p>remove all the listeners associated with 
the event if not listener is specified</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">listener</span><span class="p">)</span> <span class="nx">listeners</span><span class="p">.</span><span class="nx">clear</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span> 
        
      <span class="nx">listeners</span> <span class="o">=</span> <span class="nx">listeners</span><span class="p">.</span><span class="nx">select</span><span class="p">(</span><span class="s1">&#39;listener&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="nx">listener</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">listeners</span><span class="p">.</span><span class="nx">size</span><span class="p">()</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
      <span class="nx">listeners</span><span class="p">.</span><span class="nx">clear</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>  
    <span class="p">},</span>
      
      <span class="nx">clearLocalListeners</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;SIZE: &#39;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">_listeners</span><span class="p">.</span><span class="nx">size</span><span class="p">());</span>   
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;TO DELETE: &#39;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">_listeners</span><span class="p">.</span><span class="nx">select</span><span class="p">(</span><span class="s1">&#39;state&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="nx">node</span><span class="p">.</span><span class="nx">game</span><span class="p">.</span><span class="nx">previous</span><span class="p">()).</span><span class="nx">count</span><span class="p">());</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">_listeners</span><span class="p">.</span><span class="nx">select</span><span class="p">(</span><span class="s1">&#39;state&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="nx">node</span><span class="p">.</span><span class="nx">game</span><span class="p">.</span><span class="nx">previous</span><span class="p">()).</span><span class="k">delete</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;COUNT AFTER DELETE: &#39;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">_listeners</span><span class="p">.</span><span class="nx">count</span><span class="p">());</span>  
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_listeners</span><span class="p">.</span><span class="nx">fetchValues</span><span class="p">());</span>
      
      <span class="p">},</span>
      
      <span class="nx">clearState</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">state</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;undefined&#39;</span> <span class="o">===</span> <span class="k">typeof</span> <span class="nx">state</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;TO DELETE: &#39;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">_listeners</span><span class="p">.</span><span class="nx">select</span><span class="p">(</span><span class="s1">&#39;state&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="nx">state</span><span class="p">).</span><span class="nx">count</span><span class="p">());</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_listeners</span><span class="p">.</span><span class="nx">select</span><span class="p">(</span><span class="s1">&#39;state&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="nx">state</span><span class="p">).</span><span class="k">delete</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
        <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
      <span class="p">},</span>
      </pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-17" id="section-17">&#182;</a>
</div>
<p>Debug</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>      <span class="nx">printAllListeners</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">node</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Printing all listeners: &#39;</span><span class="p">);</span>
        <span class="kd">var</span> <span class="nx">that</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_listeners</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">l</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">node</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">l</span><span class="p">.</span><span class="nx">event</span> <span class="o">+</span> <span class="s1">&#39; = &#39;</span> <span class="o">+</span> <span class="nx">l</span><span class="p">.</span><span class="nx">listener</span><span class="p">.</span><span class="nx">toString</span><span class="p">());</span>
        <span class="p">});</span>
        <span class="nx">node</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_listeners</span><span class="p">.</span><span class="nx">size</span><span class="p">()</span> <span class="o">+</span> <span class="s1">&#39; listeners found.&#39;</span><span class="p">)</span>
      <span class="p">}</span>
  <span class="p">};</span>
  
  <span class="kd">function</span> <span class="nx">Listener</span> <span class="p">(</span><span class="nx">o</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">o</span> <span class="o">=</span> <span class="nx">o</span> <span class="o">||</span> <span class="p">{};</span>
    </pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-18" id="section-18">&#182;</a>
</div>
<p>event name</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>    <span class="k">this</span><span class="p">.</span><span class="nx">event</span> <span class="o">=</span> <span class="nx">o</span><span class="p">.</span><span class="nx">event</span><span class="p">;</span>           
    </pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-19" id="section-19">&#182;</a>
</div>
<p>callback function</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>    <span class="k">this</span><span class="p">.</span><span class="nx">listener</span> <span class="o">=</span> <span class="nx">o</span><span class="p">.</span><span class="nx">listener</span><span class="p">;</span>       
    </pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-20" id="section-20">&#182;</a>
</div>
<p>events with higher priority are executed first</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>    <span class="k">this</span><span class="p">.</span><span class="nx">priority</span> <span class="o">=</span> <span class="nx">o</span><span class="p">.</span><span class="nx">priority</span> <span class="o">||</span> <span class="mi">0</span><span class="p">;</span>  
    </pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-21" id="section-21">&#182;</a>
</div>
<p>the state in which the listener is
allowed to be executed</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>    <span class="k">this</span><span class="p">.</span><span class="nx">state</span> <span class="o">=</span> <span class="nx">o</span><span class="p">.</span><span class="nx">state</span> <span class="o">||</span> <span class="nx">node</span><span class="p">.</span><span class="nx">game</span><span class="p">.</span><span class="nx">gameState</span> <span class="o">||</span> <span class="kc">undefined</span><span class="p">;</span>   
    </pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-22" id="section-22">&#182;</a>
</div>
<p>for how many extra steps is the event 
still valid. -1 = always valid</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>    <span class="k">this</span><span class="p">.</span><span class="nx">ttl</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;undefined&#39;</span> <span class="o">!==</span> <span class="k">typeof</span> <span class="nx">o</span><span class="p">.</span><span class="nx">ttl</span><span class="p">)</span> <span class="o">?</span> <span class="nx">o</span><span class="p">.</span><span class="nx">ttl</span> <span class="o">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span> 
    </pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-23" id="section-23">&#182;</a>
</div>
<p>function will be called with
target as 'this'        </p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>    <span class="k">this</span><span class="p">.</span><span class="nx">target</span> <span class="o">=</span> <span class="nx">o</span><span class="p">.</span><span class="nx">target</span> <span class="o">||</span> <span class="kc">undefined</span><span class="p">;</span>  
  <span class="p">};</span>

<span class="p">})(</span>
  <span class="s1">&#39;object&#39;</span> <span class="o">===</span> <span class="k">typeof</span> <span class="nx">module</span> <span class="o">?</span> <span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">:</span> <span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">node</span> <span class="o">=</span> <span class="p">{})</span>
  <span class="p">,</span> <span class="s1">&#39;object&#39;</span> <span class="o">===</span> <span class="k">typeof</span> <span class="nx">module</span> <span class="o">?</span> <span class="nx">module</span><span class="p">.</span><span class="nx">parent</span><span class="p">.</span><span class="nx">exports</span> <span class="o">:</span> <span class="nx">node</span>     
  <span class="p">,</span> <span class="s1">&#39;undefined&#39;</span> <span class="o">!==</span> <span class="k">typeof</span> <span class="nx">NDDB</span> <span class="o">?</span> <span class="nx">NDDB</span> <span class="o">:</span> <span class="nx">module</span><span class="p">.</span><span class="nx">parent</span><span class="p">.</span><span class="nx">exports</span><span class="p">.</span><span class="nx">NDDB</span>
  <span class="p">,</span> <span class="s1">&#39;undefined&#39;</span> <span class="o">!==</span> <span class="k">typeof</span> <span class="nx">JSUS</span> <span class="o">?</span> <span class="nx">JSUS</span> <span class="o">:</span> <span class="nx">module</span><span class="p">.</span><span class="nx">parent</span><span class="p">.</span><span class="nx">exports</span><span class="p">.</span><span class="nx">JSUS</span>
<span class="p">);</span>
</pre></div>
        </td>
      </tr>
  </tbody>
</table>
  </div>
</body>
</html>
