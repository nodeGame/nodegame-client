<!DOCTYPE html>
<html>
<head>
  <title>Stager.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="../../doc-style.css" />
  <script src="../../doc-filelist.js"></script>
  <script>
    var relativeDir = '../../', thisFile = 'lib/stager/Stager.js', defaultSidebar = true;
  </script>
  <script src="../../doc-script.js"></script>
</head>
<body>
  <div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">
      <div class="heading h1">
        <a href="#stager">Stager</a>
      </div>
      <div class="heading h2">
        <a href="#global-scope">Global scope</a>
      </div>
      <div class="heading h2">
        <a href="#static-methods">Static Methods</a>
      </div>
      <div class="heading h4">
        <a href="#stager.defaultcallback">Stager.defaultCallback</a>
      </div>
      <div class="heading h2">
        <a href="#stager-constructor">Stager Constructor</a>
      </div>
      <div class="heading h2">
        <a href="#properties">Properties</a>
      </div>
      <div class="heading h4">
        <a href="#stager.steps">Stager.steps</a>
      </div>
      <div class="heading h4">
        <a href="#stager.stages">Stager.stages</a>
      </div>
      <div class="heading h4">
        <a href="#stager.sequence">Stager.sequence</a>
      </div>
      <div class="heading h4">
        <a href="#stager.generalnextfunction">Stager.generalNextFunction</a>
      </div>
      <div class="heading h4">
        <a href="#stager.nextfunctions">Stager.nextFunctions</a>
      </div>
      <div class="heading h4">
        <a href="#stager.defaultsteprule">Stager.defaultStepRule</a>
      </div>
      <div class="heading h4">
        <a href="#stager.defaultglobals">Stager.defaultGlobals</a>
      </div>
      <div class="heading h4">
        <a href="#stager.defaultproperties">Stager.defaultProperties</a>
      </div>
      <div class="heading h4">
        <a href="#stager.oninit">Stager.onInit</a>
      </div>
      <div class="heading h4">
        <a href="#stager.ongameover">Stager.onGameover</a>
      </div>
      <div class="heading h4">
        <a href="#stager.blocks">Stager.blocks</a>
      </div>
      <div class="heading h4">
        <a href="#stager.unfinishedblocks">Stager.unfinishedBlocks</a>
      </div>
      <div class="heading h4">
        <a href="#stager.finalized">Stager.finalized</a>
      </div>
      <div class="heading h4">
        <a href="#stager.currenttype">Stager.currentType</a>
      </div>
      <div class="heading h4">
        <a href="#stager.currentblocktype">Stager.currentBlockType</a>
      </div>
      <div class="heading h4">
        <a href="#stager.toskip">Stager.toSkip</a>
      </div>
      <div class="heading h4">
        <a href="#stager.defaultcallback">Stager.defaultCallback</a>
      </div>
      <div class="heading h4">
        <a href="#stager.cachereset">Stager.cacheReset</a>
      </div>
      <div class="heading h4">
        <a href="#stager.log">Stager.log</a>
      </div>
      <div class="heading h2">
        <a href="#methods">Methods</a>
      </div>
      <div class="heading h3">
        <a href="#clear--init--finalize--reset.">Clear, init, finalize, reset.</a>
      </div>
      <div class="heading h4">
        <a href="#stager.clear">Stager.clear</a>
      </div>
      <div class="heading h4">
        <a href="#stager.init">Stager.init</a>
      </div>
      <div class="heading h4">
        <a href="#stager.finalize">Stager.finalize</a>
      </div>
      <div class="heading h4">
        <a href="#stager.reset">Stager.reset</a>
      </div>
      <div class="heading h3">
        <a href="#setters--getters">Setters, Getters</a>
      </div>
      <div class="heading h4">
        <a href="#stager.setstate">Stager.setState</a>
      </div>
      <div class="heading h4">
        <a href="#stager.getstate">Stager.getState</a>
      </div>
      <div class="heading h4">
        <a href="#stager.setdefaultsteprule">Stager.setDefaultStepRule</a>
      </div>
      <div class="heading h4">
        <a href="#stager.getdefaultsteprule">Stager.getDefaultStepRule</a>
      </div>
      <div class="heading h4">
        <a href="#stager.setdefaultcallback">Stager.setDefaultCallback</a>
      </div>
      <div class="heading h4">
        <a href="#stager.getdefaultcallback">Stager.getDefaultCallback</a>
      </div>
      <div class="heading h4">
        <a href="#stager.setdefaultglobals">Stager.setDefaultGlobals</a>
      </div>
      <div class="heading h4">
        <a href="#stager.getdefaultglobals">Stager.getDefaultGlobals</a>
      </div>
      <div class="heading h4">
        <a href="#stager.setdefaultproperty">Stager.setDefaultProperty</a>
      </div>
      <div class="heading h4">
        <a href="#stager.setdefaultproperties">Stager.setDefaultProperties</a>
      </div>
      <div class="heading h4">
        <a href="#stager.getdefaultproperties">Stager.getDefaultProperties</a>
      </div>
      <div class="heading h4">
        <a href="#stager.setoninit">Stager.setOnInit</a>
      </div>
      <div class="heading h4">
        <a href="#stager.getoninit">Stager.getOnInit</a>
      </div>
      <div class="heading h4">
        <a href="#stager.setongameover">Stager.setOnGameover</a>
      </div>
      <div class="heading h4">
        <a href="#stager.setongameover">Stager.setOnGameOver</a>
      </div>
      <div class="heading h4">
        <a href="#stager.getongameover">Stager.getOnGameover</a>
      </div>
      <div class="heading h4">
        <a href="#stager.getongameover">Stager.getOnGameOver</a>
      </div>
      <div class="heading h3">
        <a href="#add-stages--steps">Add stages, steps</a>
      </div>
      <div class="heading h4">
        <a href="#stager.addstep">Stager.addStep</a>
      </div>
      <div class="heading h4">
        <a href="#stager.addstage">Stager.addStage</a>
      </div>
      <div class="heading h4">
        <a href="#stager.clonestep">Stager.cloneStep</a>
      </div>
      <div class="heading h4">
        <a href="#stager.clonestage">Stager.cloneStage</a>
      </div>
      <div class="heading h4">
        <a href="#stager.step">Stager.step</a>
      </div>
      <div class="heading h4">
        <a href="#stager.next---stage">Stager.next | stage</a>
      </div>
      <div class="heading h4">
        <a href="#stager.repeat---repeatstage">Stager.repeat | repeatStage</a>
      </div>
      <div class="heading h4">
        <a href="#stager.loop---loopstage">Stager.loop | loopStage</a>
      </div>
      <div class="heading h4">
        <a href="#stager.doloop---doloopstage">Stager.doLoop | doLoopStage</a>
      </div>
      <div class="heading h4">
        <a href="#stager.gameover">Stager.gameover</a>
      </div>
      <div class="heading h3">
        <a href="#extend-stages--modify-sequence">Extend stages, modify sequence</a>
      </div>
      <div class="heading h4">
        <a href="#stager.extendstep">Stager.extendStep</a>
      </div>
      <div class="heading h4">
        <a href="#stager.extendstage">Stager.extendStage</a>
      </div>
      <div class="heading h4">
        <a href="#stager.extendallsteps">Stager.extendAllSteps</a>
      </div>
      <div class="heading h4">
        <a href="#stager.extendallstages">Stager.extendAllStages</a>
      </div>
      <div class="heading h4">
        <a href="#stager.skip">Stager.skip</a>
      </div>
      <div class="heading h4">
        <a href="#stager.unskip">Stager.unskip</a>
      </div>
      <div class="heading h4">
        <a href="#stager.isskipped">Stager.isSkipped</a>
      </div>
      <div class="heading h3">
        <a href="#blocks">Blocks</a>
      </div>
      <div class="heading h4">
        <a href="#stager.beginblock">Stager.beginBlock</a>
      </div>
      <div class="heading h4">
        <a href="#stager.endblock">Stager.endBlock</a>
      </div>
      <div class="heading h4">
        <a href="#stager.endblocks">Stager.endBlocks</a>
      </div>
      <div class="heading h4">
        <a href="#stager.endallblocks">Stager.endAllBlocks</a>
      </div>
      <div class="heading h4">
        <a href="#stager.stepblock">Stager.stepBlock</a>
      </div>
      <div class="heading h4">
        <a href="#stager.stageblock">Stager.stageBlock</a>
      </div>
      <div class="heading h4">
        <a href="#stager.nextblock">Stager.nextBlock</a>
      </div>
      <div class="heading h4">
        <a href="#stager.getcurrentblock">Stager.getCurrentBlock</a>
      </div>
      <div class="heading h3">
        <a href="#extract-info">Extract Info</a>
      </div>
      <div class="heading h4">
        <a href="#stager.getsequence">Stager.getSequence</a>
      </div>
      <div class="heading h4">
        <a href="#stager.extractstage">Stager.extractStage</a>
      </div>
      <div class="heading h3">
        <a href="#flexible-mode">Flexible Mode</a>
      </div>
      <div class="heading h4">
        <a href="#stager.registergeneralnext">Stager.registerGeneralNext</a>
      </div>
      <div class="heading h4">
        <a href="#stager.registernext">Stager.registerNext</a>
      </div>
      <div class="heading h2">
        <a href="#private-methods">Private Methods</a>
      </div>
      <div class="heading h4">
        <a href="#handlestepsarray">handleStepsArray</a>
      </div>
      <div class="heading h4">
        <a href="#addloop">addLoop</a>
      </div>
      <div class="heading h4">
        <a href="#addstepstocurrentblock">addStepsToCurrentBlock</a>
      </div>
      <div class="heading h4">
        <a href="#extractalias">extractAlias</a>
      </div>
      <div class="heading h4">
        <a href="#handlealias">handleAlias</a>
      </div>
      <div class="heading h4">
        <a href="#checkfinalized">checkFinalized</a>
      </div>
      <div class="heading h4">
        <a href="#checkstepvalidity">checkStepValidity</a>
      </div>
      <div class="heading h4">
        <a href="#validateextendedstep">validateExtendedStep</a>
      </div>
      <div class="heading h4">
        <a href="#validateextendedstage">validateExtendedStage</a>
      </div>
      <div class="heading h4">
        <a href="#checkstepparameter">checkStepParameter</a>
      </div>
      <div class="heading h4">
        <a href="#handlestageparameter">handleStageParameter</a>
      </div>
      <div class="heading h4">
        <a href="#checkpositionsparameter">checkPositionsParameter</a>
      </div>
      <div class="heading h4">
        <a href="#addstagetocurrentblock">addStageToCurrentBlock</a>
      </div>
      <div class="heading h4">
        <a href="#setskipstagestep">setSkipStageStep</a>
      </div>
    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container"><div class="background highlight"></div>
<table cellpadding="0" cellspacing="0">
  <tbody>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="stager">
  <h1>
    <a href="#stager" class="pilcrow">&#182;</a>
    Stager
  </h1>
</div>


<p>Copyright(c) 2015 Stefano Balietti
MIT Licensed</p>
  </div>
  <div class="body"><p><code>nodeGame</code> container and builder of the game sequence</p>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">exports</span><span class="p">,</span> <span class="nx">parent</span><span class="p">)</span> <span class="p">{</span>

    <span class="s2">&quot;use strict&quot;</span><span class="p">;</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="global-scope">
  <h2>
    <a href="#global-scope" class="pilcrow">&#182;</a>
    Global scope
  </h2>
</div>

        </td>
        <td class="code highlight"><div class="highlight"><pre>    <span class="nx">exports</span><span class="p">.</span><span class="nx">Stager</span> <span class="o">=</span> <span class="nx">Stager</span><span class="p">;</span>

    <span class="kd">var</span> <span class="nx">Block</span> <span class="o">=</span> <span class="nx">parent</span><span class="p">.</span><span class="nx">Block</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">stepRules</span> <span class="o">=</span> <span class="nx">parent</span><span class="p">.</span><span class="nx">stepRules</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">J</span> <span class="o">=</span> <span class="nx">parent</span><span class="p">.</span><span class="nx">JSUS</span><span class="p">;</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="static-methods">
  <h2>
    <a href="#static-methods" class="pilcrow">&#182;</a>
    Static Methods
  </h2>
</div>

        </td>
        <td class="code highlight"><div class="highlight"><pre></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="stager.defaultcallback">
  <h4>
    <a href="#stager.defaultcallback" class="pilcrow">&#182;</a>
    Stager.defaultCallback
  </h4>
</div>

  </div>
  <div class="body"><p>Default callback added to steps when none is specified</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">Stager.setDefaultCallback</span>
    </div>
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">Stager.getDefaultCallback
  </span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>    <span class="nx">Stager</span><span class="p">.</span><span class="nx">defaultCallback</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">node</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">getCurrentStepObj</span><span class="p">().</span><span class="nx">id</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">node</span><span class="p">.</span><span class="nx">done</span><span class="p">();</span>
    <span class="p">};</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-5" id="section-5">&#182;</a>
</div>
<p>Do not change. These are shared with Stager.js.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>    <span class="kd">var</span> <span class="nx">BLOCK_DEFAULT</span>     <span class="o">=</span> <span class="s1">&#39;__default&#39;</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">BLOCK_STAGE</span>       <span class="o">=</span> <span class="s1">&#39;__stage&#39;</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">BLOCK_STEP</span>        <span class="o">=</span> <span class="s1">&#39;__step&#39;</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">BLOCK_ENCLOSING</span>   <span class="o">=</span> <span class="s1">&#39;__enclosing_&#39;</span><span class="p">;</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="stager-constructor">
  <h2>
    <a href="#stager-constructor" class="pilcrow">&#182;</a>
    Stager Constructor
  </h2>
</div>

  </div>
  <div class="body"><p>Creates a new instance of Stager</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">stateObj</span>
      <span class="dox_type">object</span>
      <span>Optional. State to initialize the new
  Stager object with. See <code>Stager.setState</code>.</span>
    </div>
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">Stager.setState
  </span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>    <span class="kd">function</span> <span class="nx">Stager</span><span class="p">(</span><span class="nx">stateObj</span><span class="p">)</span> <span class="p">{</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="properties">
  <h2>
    <a href="#properties" class="pilcrow">&#182;</a>
    Properties
  </h2>
</div>

        </td>
        <td class="code highlight"><div class="highlight"><pre></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="stager.steps">
  <h4>
    <a href="#stager.steps" class="pilcrow">&#182;</a>
    Stager.steps
  </h4>
</div>

  </div>
  <div class="body"><p>Step object container</p>

<p>key: step ID,  value: step object</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">Stager.addStep
  </span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>        <span class="k">this</span><span class="p">.</span><span class="nx">steps</span> <span class="o">=</span> <span class="p">{};</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="stager.stages">
  <h4>
    <a href="#stager.stages" class="pilcrow">&#182;</a>
    Stager.stages
  </h4>
</div>

  </div>
  <div class="body"><p>Stage object container</p>

<p>key: stage ID,  value: stage object</p>

<p>Stage aliases are stored the same way, with a reference to
the original stage object as the value.</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">Stager.addStage
  </span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>        <span class="k">this</span><span class="p">.</span><span class="nx">stages</span> <span class="o">=</span> <span class="p">{};</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="stager.sequence">
  <h4>
    <a href="#stager.sequence" class="pilcrow">&#182;</a>
    Stager.sequence
  </h4>
</div>

  </div>
  <div class="body"><p>Sequence block container</p>

<p>Stores the game plan in 'simple mode'.</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">Stager.gameover</span>
    </div>
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">Stager.next</span>
    </div>
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">Stager.repeat</span>
    </div>
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">Stager.loop</span>
    </div>
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">Stager.doLoop
  </span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>        <span class="k">this</span><span class="p">.</span><span class="nx">sequence</span> <span class="o">=</span> <span class="p">[];</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="stager.generalnextfunction">
  <h4>
    <a href="#stager.generalnextfunction" class="pilcrow">&#182;</a>
    Stager.generalNextFunction
  </h4>
</div>

  </div>
  <div class="body"><p>General next-stage decider function</p>

<p>Returns the id of the next game step.
Available only when nodegame is executed in <em>flexible</em> mode.</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">Stager.registerGeneralNext
  </span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>        <span class="k">this</span><span class="p">.</span><span class="nx">generalNextFunction</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="stager.nextfunctions">
  <h4>
    <a href="#stager.nextfunctions" class="pilcrow">&#182;</a>
    Stager.nextFunctions
  </h4>
</div>

  </div>
  <div class="body"><p>Per-stage next-stage decider function</p>

<p>key: stage ID,  value: callback function</p>

<p>Stores functions to be called to yield the id of the next
game stage for a specific previous stage.</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">Stager.registerNext
  </span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>        <span class="k">this</span><span class="p">.</span><span class="nx">nextFunctions</span> <span class="o">=</span> <span class="p">{};</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="stager.defaultsteprule">
  <h4>
    <a href="#stager.defaultsteprule" class="pilcrow">&#182;</a>
    Stager.defaultStepRule
  </h4>
</div>

  </div>
  <div class="body"><p>Default step-rule function</p>

<p>This function decides whether it is possible to proceed to
the next step/stage. If a step/stage object defines a
<code>steprule</code> property, then that function is used instead.</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">Stager.getDefaultStepRule</span>
    </div>
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">GamePlot.getStepRule
  </span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>        <span class="k">this</span><span class="p">.</span><span class="nx">setDefaultStepRule</span><span class="p">();</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="stager.defaultglobals">
  <h4>
    <a href="#stager.defaultglobals" class="pilcrow">&#182;</a>
    Stager.defaultGlobals
  </h4>
</div>

  </div>
  <div class="body"><p>Defaults of global variables</p>

<p>This map holds the default values of global variables. These
values are overridable by more specific version in step and
stage objects.</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">Stager.setDefaultGlobals</span>
    </div>
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">GamePlot.getGlobal
  </span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>        <span class="k">this</span><span class="p">.</span><span class="nx">defaultGlobals</span> <span class="o">=</span> <span class="p">{};</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="stager.defaultproperties">
  <h4>
    <a href="#stager.defaultproperties" class="pilcrow">&#182;</a>
    Stager.defaultProperties
  </h4>
</div>

  </div>
  <div class="body"><p>Defaults of properties</p>

<p>This map holds the default values of properties. These values
are overridable by more specific version in step and stage
objects.</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">Stager.setDefaultProperties</span>
    </div>
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">GamePlot.getProperty
  </span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>        <span class="k">this</span><span class="p">.</span><span class="nx">defaultProperties</span> <span class="o">=</span> <span class="p">{};</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="stager.oninit">
  <h4>
    <a href="#stager.oninit" class="pilcrow">&#182;</a>
    Stager.onInit
  </h4>
</div>

  </div>
  <div class="body"><p>Initialization function</p>

<p>This function is called as soon as the game is instantiated,
i.e. at stage 0.0.0.</p>

<p>Event listeners defined here stay valid throughout the whole
game, unlike event listeners defined inside a function of the
gamePlot, which are valid only within the specific function.</p>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>        <span class="k">this</span><span class="p">.</span><span class="nx">onInit</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="stager.ongameover">
  <h4>
    <a href="#stager.ongameover" class="pilcrow">&#182;</a>
    Stager.onGameover
  </h4>
</div>

  </div>
  <div class="body"><p>Cleaning up function</p>

<p>This function is called after the last stage of the gamePlot
is terminated.</p>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>        <span class="k">this</span><span class="p">.</span><span class="nx">onGameover</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="stager.blocks">
  <h4>
    <a href="#stager.blocks" class="pilcrow">&#182;</a>
    Stager.blocks
  </h4>
</div>

  </div>
  <div class="body"><p>List of all Blocks used to build the hierarchy</p>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>        <span class="k">this</span><span class="p">.</span><span class="nx">blocks</span> <span class="o">=</span> <span class="p">[];</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="stager.unfinishedblocks">
  <h4>
    <a href="#stager.unfinishedblocks" class="pilcrow">&#182;</a>
    Stager.unfinishedBlocks
  </h4>
</div>

  </div>
  <div class="body"><p>List of all Blocks stager might still modify</p>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>        <span class="k">this</span><span class="p">.</span><span class="nx">unfinishedBlocks</span> <span class="o">=</span> <span class="p">[];</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="stager.finalized">
  <h4>
    <a href="#stager.finalized" class="pilcrow">&#182;</a>
    Stager.finalized
  </h4>
</div>

  </div>
  <div class="body"><p>Flag indicating if the hierarchy of has been set</p>

<p>Indicates if the hierarchy of stages and steps has been set.</p>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>        <span class="k">this</span><span class="p">.</span><span class="nx">finalized</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="stager.currenttype">
  <h4>
    <a href="#stager.currenttype" class="pilcrow">&#182;</a>
    Stager.currentType
  </h4>
</div>

  </div>
  <div class="body"><p>Name of the stage currently worked with in building hierarchy</p>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>        <span class="k">this</span><span class="p">.</span><span class="nx">currentType</span> <span class="o">=</span> <span class="nx">BLOCK_DEFAULT</span><span class="p">;</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="stager.currentblocktype">
  <h4>
    <a href="#stager.currentblocktype" class="pilcrow">&#182;</a>
    Stager.currentBlockType
  </h4>
</div>

  </div>
  <div class="body"><p>Indicates what type of Block was added last</p>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>        <span class="k">this</span><span class="p">.</span><span class="nx">currentBlockType</span> <span class="o">=</span> <span class="nx">BLOCK_DEFAULT</span><span class="p">;</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="stager.toskip">
  <h4>
    <a href="#stager.toskip" class="pilcrow">&#182;</a>
    Stager.toSkip
  </h4>
</div>

  </div>
  <div class="body"><p>List of stages and steps to skip when building the sequence</p>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>        <span class="k">this</span><span class="p">.</span><span class="nx">toSkip</span> <span class="o">=</span> <span class="p">{</span>
            <span class="nx">stages</span><span class="o">:</span> <span class="p">{},</span>
            <span class="nx">steps</span><span class="o">:</span> <span class="p">{}</span>
        <span class="p">};</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="stager.defaultcallback">
  <h4>
    <a href="#stager.defaultcallback" class="pilcrow">&#182;</a>
    Stager.defaultCallback
  </h4>
</div>

  </div>
  <div class="body"><p>Default callback assigned to a step if none is provided</p>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>        <span class="k">this</span><span class="p">.</span><span class="nx">defaultCallback</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="stager.cachereset">
  <h4>
    <a href="#stager.cachereset" class="pilcrow">&#182;</a>
    Stager.cacheReset
  </h4>
</div>

  </div>
  <div class="body"><p>Cache used to reset the state of the stager after finalization</p>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>        <span class="k">this</span><span class="p">.</span><span class="nx">cacheReset</span> <span class="o">=</span> <span class="p">{</span>
            <span class="nx">unfinishedBlocks</span><span class="o">:</span> <span class="p">[]</span>
        <span class="p">};</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="stager.log">
  <h4>
    <a href="#stager.log" class="pilcrow">&#182;</a>
    Stager.log
  </h4>
</div>

  </div>
  <div class="body"><p>Default standard output. Override to redirect.</p>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>        <span class="k">this</span><span class="p">.</span><span class="nx">log</span> <span class="o">=</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">;</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-27" id="section-27">&#182;</a>
</div>
<p>Set the state if one is passed.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>        <span class="k">if</span> <span class="p">(</span><span class="nx">stateObj</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;object&#39;</span> <span class="o">!==</span> <span class="k">typeof</span> <span class="nx">stateObj</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">throw</span> <span class="k">new</span> <span class="nx">TypeError</span><span class="p">(</span><span class="s1">&#39;Stager: stateObj must be object.&#39;</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">setState</span><span class="p">(</span><span class="nx">stateObj</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="p">{</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-28" id="section-28">&#182;</a>
</div>
<p>Add first block.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>            <span class="k">this</span><span class="p">.</span><span class="nx">stageBlock</span><span class="p">(</span><span class="s1">&#39;linear&#39;</span><span class="p">,</span> <span class="p">{</span> <span class="nx">id</span><span class="o">:</span> <span class="nx">BLOCK_DEFAULT</span> <span class="p">});</span>
        <span class="p">}</span>
    <span class="p">}</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="methods">
  <h2>
    <a href="#methods" class="pilcrow">&#182;</a>
    Methods
  </h2>
</div>

        </td>
        <td class="code highlight"><div class="highlight"><pre></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="clear--init--finalize--reset.">
  <h3>
    <a href="#clear--init--finalize--reset." class="pilcrow">&#182;</a>
    Clear, init, finalize, reset.
  </h3>
</div>

        </td>
        <td class="code highlight"><div class="highlight"><pre></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="stager.clear">
  <h4>
    <a href="#stager.clear" class="pilcrow">&#182;</a>
    Stager.clear
  </h4>
</div>

  </div>
  <div class="body"><p>Clears the state of the stager</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">Returns</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name"></span>
      <span class="dox_type">Stager</span>
      <span>this object</span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>    <span class="nx">Stager</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">clear</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">steps</span> <span class="o">=</span> <span class="p">{};</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">stages</span> <span class="o">=</span> <span class="p">{};</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">sequence</span> <span class="o">=</span> <span class="p">[];</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">generalNextFunction</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">nextFunctions</span> <span class="o">=</span> <span class="p">{};</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">setDefaultStepRule</span><span class="p">();</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">defaultGlobals</span> <span class="o">=</span> <span class="p">{};</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">defaultProperties</span> <span class="o">=</span> <span class="p">{};</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">onInit</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">onGameover</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">blocks</span> <span class="o">=</span> <span class="p">[];</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">unfinishedBlocks</span> <span class="o">=</span> <span class="p">[];</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">finalized</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">currentType</span> <span class="o">=</span> <span class="nx">BLOCK_DEFAULT</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">currentBlockType</span> <span class="o">=</span> <span class="nx">BLOCK_DEFAULT</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">toSkip</span> <span class="o">=</span> <span class="p">{</span> <span class="nx">stages</span><span class="o">:</span> <span class="p">{},</span> <span class="nx">steps</span><span class="o">:</span> <span class="p">{}</span> <span class="p">};</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">defaultCallback</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">cacheReset</span> <span class="o">=</span> <span class="p">{</span> <span class="nx">unfinishedBlocks</span><span class="o">:</span> <span class="p">[]</span> <span class="p">};</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
    <span class="p">};</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="stager.init">
  <h4>
    <a href="#stager.init" class="pilcrow">&#182;</a>
    Stager.init
  </h4>
</div>

  </div>
  <div class="body"><p>Clears the state of the stager and adds a default block</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">Returns</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name"></span>
      <span class="dox_type">Stager</span>
      <span>this object</span>
    </div>
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">Stager.clear
  </span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>    <span class="nx">Stager</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">init</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">clear</span><span class="p">();</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">stageBlock</span><span class="p">(</span><span class="s1">&#39;linear&#39;</span><span class="p">,</span> <span class="p">{</span> <span class="nx">id</span><span class="o">:</span> <span class="nx">BLOCK_DEFAULT</span> <span class="p">});</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
    <span class="p">};</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="stager.finalize">
  <h4>
    <a href="#stager.finalize" class="pilcrow">&#182;</a>
    Stager.finalize
  </h4>
</div>

  </div>
  <div class="body"><p>Builds stage and step sequence from the Block hieararchy</p>

<p>Stages and steps are excluded from the sequence if they were marked
as <em>toSkip</em>.</p>

<p>Steps are excluded from the sequence if they were added as
<em>default step</em>, but then other steps have been added to the same stage.</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">Stager.reset
  </span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>    <span class="nx">Stager</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">finalize</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">currentItem</span><span class="p">,</span> <span class="nx">stageId</span><span class="p">,</span> <span class="nx">stepId</span><span class="p">;</span>
        <span class="kd">var</span> <span class="nx">outermostBlock</span><span class="p">,</span> <span class="nx">blockIndex</span><span class="p">;</span>
        <span class="kd">var</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">len</span><span class="p">,</span> <span class="nx">seqItem</span><span class="p">;</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-34" id="section-34">&#182;</a>
</div>
<p>Already finalized.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">finalized</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-35" id="section-35">&#182;</a>
</div>
<p>Nothing to do, finalize called to early.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">blocks</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-36" id="section-36">&#182;</a>
</div>
<p>Cache the ids of unfinishedBlocks for future calls to .reset.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>        <span class="nx">i</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="nx">len</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">unfinishedBlocks</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
        <span class="k">for</span> <span class="p">(</span> <span class="p">;</span> <span class="o">++</span><span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">len</span> <span class="p">;</span> <span class="p">)</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">cacheReset</span><span class="p">.</span><span class="nx">unfinishedBlocks</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">unfinishedBlocks</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">id</span><span class="p">);</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-37" id="section-37">&#182;</a>
</div>
<p>Need to backup unfinished blocks before calling endAllBlocks().</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>            <span class="k">this</span><span class="p">.</span><span class="nx">unfinishedBlocks</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">backup</span><span class="p">();</span>
        <span class="p">}</span>
<span class="kr">debugger</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-38" id="section-38">&#182;</a>
</div>
<p>Closes unclosed blocks.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>        <span class="k">this</span><span class="p">.</span><span class="nx">endAllBlocks</span><span class="p">();</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-39" id="section-39">&#182;</a>
</div>
<p>Fixes the position of unfixed elements inside each block.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>        <span class="k">for</span> <span class="p">(</span><span class="nx">blockIndex</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">blockIndex</span> <span class="o">&lt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">blocks</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="o">++</span><span class="nx">blockIndex</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">blocks</span><span class="p">[</span><span class="nx">blockIndex</span><span class="p">].</span><span class="nx">finalize</span><span class="p">();</span>
        <span class="p">}</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-40" id="section-40">&#182;</a>
</div>
<p>Take outermost block and start building sequence.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>        <span class="nx">outermostBlock</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">blocks</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
        <span class="nx">currentItem</span> <span class="o">=</span> <span class="nx">outermostBlock</span><span class="p">.</span><span class="nx">next</span><span class="p">();</span>
        <span class="k">while</span> <span class="p">(</span><span class="o">!!</span><span class="nx">currentItem</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">currentItem</span><span class="p">.</span><span class="nx">type</span> <span class="o">===</span> <span class="nx">BLOCK_STAGE</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">stageId</span> <span class="o">=</span> <span class="nx">currentItem</span><span class="p">.</span><span class="nx">item</span><span class="p">.</span><span class="nx">id</span><span class="p">;</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-41" id="section-41">&#182;</a>
</div>
<p>Add it to sequence if it was
not marked as <code>toSkip</code>, or it is a gameover stage.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>                <span class="k">if</span> <span class="p">(</span><span class="nx">currentItem</span><span class="p">.</span><span class="nx">item</span><span class="p">.</span><span class="nx">type</span> <span class="o">===</span> <span class="s1">&#39;gameover&#39;</span> <span class="o">||</span>
                    <span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">isSkipped</span><span class="p">(</span><span class="nx">stageId</span><span class="p">))</span> <span class="p">{</span>

                    <span class="nx">seqItem</span> <span class="o">=</span> <span class="nx">J</span><span class="p">.</span><span class="nx">clone</span><span class="p">(</span><span class="nx">currentItem</span><span class="p">.</span><span class="nx">item</span><span class="p">);</span>
                    <span class="nx">seqItem</span><span class="p">.</span><span class="nx">steps</span> <span class="o">=</span> <span class="p">[];</span>
                    <span class="k">this</span><span class="p">.</span><span class="nx">sequence</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">seqItem</span><span class="p">);</span>
                <span class="p">}</span>
            <span class="p">}</span>
            <span class="k">else</span> <span class="p">{</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-42" id="section-42">&#182;</a>
</div>
<p>It is a step, currentItem.type = stage id (TODO: change).</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>                <span class="nx">stageId</span> <span class="o">=</span> <span class="nx">currentItem</span><span class="p">.</span><span class="nx">type</span><span class="p">;</span>
                <span class="nx">stepId</span> <span class="o">=</span> <span class="nx">currentItem</span><span class="p">.</span><span class="nx">item</span><span class="p">;</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-43" id="section-43">&#182;</a>
</div>
<p>Do not add step to the sequence if:</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-44" id="section-44">&#182;</a>
</div>
<p>1 - Step was marked as <code>toSkip</code>.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>                <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">isSkipped</span><span class="p">(</span><span class="nx">stageId</span><span class="p">,</span> <span class="nx">stepId</span><span class="p">)</span> <span class="o">&amp;&amp;</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-45" id="section-45">&#182;</a>
</div>
<p>2 - Step was a default step,
    but other steps have been added.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>                    <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">steps</span><span class="p">[</span><span class="nx">stepId</span><span class="p">].</span><span class="nx">_defaultStep</span> <span class="o">||</span>
                     <span class="k">this</span><span class="p">.</span><span class="nx">stages</span><span class="p">[</span><span class="nx">stageId</span><span class="p">].</span><span class="nx">steps</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">1</span><span class="p">))</span> <span class="p">{</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-46" id="section-46">&#182;</a>
</div>
<p>Ok, add the step to the sequence (must look up stage).</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>                    <span class="nx">i</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="nx">len</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">sequence</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
                    <span class="k">for</span> <span class="p">(</span> <span class="p">;</span> <span class="o">++</span><span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">len</span> <span class="p">;</span> <span class="p">)</span> <span class="p">{</span>
                        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">sequence</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">id</span> <span class="o">===</span> <span class="nx">stageId</span><span class="p">)</span> <span class="p">{</span>
                            <span class="k">this</span><span class="p">.</span><span class="nx">sequence</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">steps</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">stepId</span><span class="p">);</span>
                            <span class="k">break</span><span class="p">;</span>
                        <span class="p">}</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">}</span>
            <span class="nx">currentItem</span> <span class="o">=</span> <span class="nx">outermostBlock</span><span class="p">.</span><span class="nx">next</span><span class="p">();</span>
        <span class="p">}</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">finalized</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
    <span class="p">};</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="stager.reset">
  <h4>
    <a href="#stager.reset" class="pilcrow">&#182;</a>
    Stager.reset
  </h4>
</div>

  </div>
  <div class="body"><p>Undoes a previous call to <code>finalize</code></p>

<p>Allows to call <code>Stager.finalize</code> again to build a potentially
different sequence from the Block hierarchy.</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">Stager.finalize</span>
    </div>
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">Stager.cacheReset
  </span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>    <span class="nx">Stager</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">reset</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">blockIndex</span><span class="p">;</span>
        <span class="kd">var</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">lenCache</span><span class="p">,</span> <span class="nx">lenBlocks</span><span class="p">,</span> <span class="nx">blocks</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">finalized</span><span class="p">)</span> <span class="k">return</span> <span class="k">this</span><span class="p">;</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-48" id="section-48">&#182;</a>
</div>
<p>Restore unfinishedBlocks, if any.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>        <span class="nx">lenCache</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">cacheReset</span><span class="p">.</span><span class="nx">unfinishedBlocks</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">lenCache</span><span class="p">)</span> <span class="p">{</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-49" id="section-49">&#182;</a>
</div>
<p>Create index of blocks by id.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>            <span class="nx">blocks</span> <span class="o">=</span> <span class="p">{};</span>
            <span class="nx">i</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="nx">lenBlocks</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">blocks</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
            <span class="k">for</span> <span class="p">(</span> <span class="p">;</span> <span class="o">++</span><span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">lenBlocks</span> <span class="p">;</span> <span class="p">)</span> <span class="p">{</span>
                <span class="nx">blocks</span><span class="p">[</span><span class="k">this</span><span class="p">.</span><span class="nx">blocks</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">id</span><span class="p">]</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">blocks</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
            <span class="p">}</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-50" id="section-50">&#182;</a>
</div>
<p>Copy by reference cached blocks.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>            <span class="nx">i</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
            <span class="k">for</span> <span class="p">(</span> <span class="p">;</span> <span class="o">++</span><span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">lenCache</span> <span class="p">;</span> <span class="p">)</span> <span class="p">{</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">unfinishedBlocks</span>
                    <span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">blocks</span><span class="p">[</span><span class="k">this</span><span class="p">.</span><span class="nx">cacheReset</span><span class="p">.</span><span class="nx">unfinishedBlocks</span><span class="p">[</span><span class="nx">i</span><span class="p">]]);</span>
            <span class="p">}</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">cacheReset</span> <span class="o">=</span> <span class="p">{</span> <span class="nx">unfinishedBlocks</span><span class="o">:</span> <span class="p">[]};</span>
        <span class="p">}</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-51" id="section-51">&#182;</a>
</div>
<p>End restore unfinishedBlocks.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-52" id="section-52">&#182;</a>
</div>
<p>Call restore on individual blocks.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>        <span class="k">for</span> <span class="p">(</span><span class="nx">blockIndex</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">blockIndex</span> <span class="o">&lt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">blocks</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="o">++</span><span class="nx">blockIndex</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">blocks</span><span class="p">[</span><span class="nx">blockIndex</span><span class="p">].</span><span class="nx">restore</span><span class="p">();</span>
        <span class="p">}</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">sequence</span> <span class="o">=</span> <span class="p">[];</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">finalized</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
    <span class="p">};</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="setters--getters">
  <h3>
    <a href="#setters--getters" class="pilcrow">&#182;</a>
    Setters, Getters
  </h3>
</div>

        </td>
        <td class="code highlight"><div class="highlight"><pre></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="stager.setstate">
  <h4>
    <a href="#stager.setstate" class="pilcrow">&#182;</a>
    Stager.setState
  </h4>
</div>

  </div>
  <div class="body"><p>Sets the internal state of the Stager</p>

<p>The passed state object can have the following fields:
steps, stages, sequence, generalNextFunction, nextFunctions,
defaultStepRule, defaultGlobals, defaultProperties, onInit,
onGameover.
All fields are optional.</p>

<p>This function calls the corresponding functions to set these
fields, and performs error checking.</p>

<p>If updateRule is 'replace', the Stager is cleared before applying
the state.</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">stateObj</span>
      <span class="dox_type">object</span>
      <span>The Stager's state</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">updateRule</span>
      <span class="dox_type">string</span>
      <span>Optional. Whether to
   'replace' (default) or to 'append'.</span>
    </div>
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">Stager.getState
  </span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>    <span class="nx">Stager</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">setState</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">stateObj</span><span class="p">,</span> <span class="nx">updateRule</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">idx</span><span class="p">;</span>
        <span class="kd">var</span> <span class="nx">stageObj</span><span class="p">;</span>
        <span class="kd">var</span> <span class="nx">seqObj</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;object&#39;</span> <span class="o">!==</span> <span class="k">typeof</span> <span class="nx">stateObj</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nx">TypeError</span><span class="p">(</span><span class="s1">&#39;Stager.setState: stateObj must be object.&#39;</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="nx">updateRule</span> <span class="o">=</span> <span class="nx">updateRule</span> <span class="o">||</span> <span class="s1">&#39;replace&#39;</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;string&#39;</span> <span class="o">!==</span> <span class="k">typeof</span> <span class="nx">updateRule</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nx">TypeError</span><span class="p">(</span><span class="s1">&#39;Stager.setState: updateRule must be object &#39;</span> <span class="o">+</span>
                                <span class="s1">&#39;or undefined.&#39;</span><span class="p">);</span>
        <span class="p">}</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-55" id="section-55">&#182;</a>
</div>
<p>Clear previous state:</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>        <span class="k">if</span> <span class="p">(</span><span class="nx">updateRule</span> <span class="o">===</span> <span class="s1">&#39;replace&#39;</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">clear</span><span class="p">();</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">updateRule</span> <span class="o">!==</span> <span class="s1">&#39;append&#39;</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">&#39;Stager.setState: invalid updateRule: &#39;</span> <span class="o">+</span>
                            <span class="nx">updateRule</span><span class="p">);</span>
        <span class="p">}</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-56" id="section-56">&#182;</a>
</div>
<p>Add steps:</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>        <span class="k">for</span> <span class="p">(</span><span class="nx">idx</span> <span class="k">in</span> <span class="nx">stateObj</span><span class="p">.</span><span class="nx">steps</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">stateObj</span><span class="p">.</span><span class="nx">steps</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">idx</span><span class="p">))</span> <span class="p">{</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">addStep</span><span class="p">(</span><span class="nx">stateObj</span><span class="p">.</span><span class="nx">steps</span><span class="p">[</span><span class="nx">idx</span><span class="p">]);</span>
            <span class="p">}</span>
        <span class="p">}</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-57" id="section-57">&#182;</a>
</div>
<p>Add stages:
first, handle all non-aliases
(key of <code>stages</code> entry is same as <code>id</code> field of its value)</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>        <span class="k">for</span> <span class="p">(</span><span class="nx">idx</span> <span class="k">in</span> <span class="nx">stateObj</span><span class="p">.</span><span class="nx">stages</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">stageObj</span> <span class="o">=</span> <span class="nx">stateObj</span><span class="p">.</span><span class="nx">stages</span><span class="p">[</span><span class="nx">idx</span><span class="p">];</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">stateObj</span><span class="p">.</span><span class="nx">stages</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">idx</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
                <span class="nx">stageObj</span><span class="p">.</span><span class="nx">id</span> <span class="o">===</span> <span class="nx">idx</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">this</span><span class="p">.</span><span class="nx">addStage</span><span class="p">(</span><span class="nx">stageObj</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-58" id="section-58">&#182;</a>
</div>
<p>second, handle all aliases
(key of <code>stages</code> entry is different from <code>id</code> field of
its value)</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>        <span class="k">for</span> <span class="p">(</span><span class="nx">idx</span> <span class="k">in</span> <span class="nx">stateObj</span><span class="p">.</span><span class="nx">stages</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">stageObj</span> <span class="o">=</span> <span class="nx">stateObj</span><span class="p">.</span><span class="nx">stages</span><span class="p">[</span><span class="nx">idx</span><span class="p">];</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">stateObj</span><span class="p">.</span><span class="nx">stages</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">idx</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
                <span class="nx">stageObj</span><span class="p">.</span><span class="nx">id</span> <span class="o">!==</span> <span class="nx">idx</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">this</span><span class="p">.</span><span class="nx">stages</span><span class="p">[</span><span class="nx">idx</span><span class="p">]</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">stages</span><span class="p">[</span><span class="nx">stageObj</span><span class="p">.</span><span class="nx">id</span><span class="p">];</span>
            <span class="p">}</span>
        <span class="p">}</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-59" id="section-59">&#182;</a>
</div>
<p>Add sequence blocks:</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>        <span class="k">if</span> <span class="p">(</span><span class="nx">stateObj</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="s1">&#39;sequence&#39;</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">for</span> <span class="p">(</span><span class="nx">idx</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">idx</span> <span class="o">&lt;</span> <span class="nx">stateObj</span><span class="p">.</span><span class="nx">sequence</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">idx</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">seqObj</span> <span class="o">=</span> <span class="nx">stateObj</span><span class="p">.</span><span class="nx">sequence</span><span class="p">[</span><span class="nx">idx</span><span class="p">];</span>

                <span class="k">this</span><span class="p">.</span><span class="nx">sequence</span><span class="p">[</span><span class="nx">idx</span><span class="p">]</span> <span class="o">=</span> <span class="nx">seqObj</span><span class="p">;</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-60" id="section-60">&#182;</a>
</div>
<p>switch (seqObj.type) {
case 'gameover':
this.gameover();
break;</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-61" id="section-61">&#182;</a>
</div>
<p>case 'plain':
if (!this.next(seqObj.id)) {
throw new Error('Stager.setState: invalid' +
+ 'sequence.');
}
break;</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-62" id="section-62">&#182;</a>
</div>
<p>case 'repeat':
if (!this.repeat(seqObj.id, seqObj.num)) {
throw new Error('Stager.setState: invalid' +
+ 'sequence.');                    //}
break;</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-63" id="section-63">&#182;</a>
</div>
<p>case 'loop':
if (!this.loop(seqObj.id, seqObj.cb)) {
throw new Error('Stager.setState: invalid' +
+ 'sequence.');                    //}
}
break;</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-64" id="section-64">&#182;</a>
</div>
<p>case 'doLoop':
if (!this.doLoop(seqObj.id, seqObj.cb)) {
throw new Error('Stager.setState: invalid' +
+ 'sequence.');                    //}</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-65" id="section-65">&#182;</a>
</div>
<p>}
break;</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-66" id="section-66">&#182;</a>
</div>
<p>default:
// Unknown type:
throw new Error('Stager.setState: invalid' +
+ 'sequence.');                    //}</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-67" id="section-67">&#182;</a>
</div>
<p>}</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>            <span class="p">}</span>
        <span class="p">}</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-68" id="section-68">&#182;</a>
</div>
<p>Set general next-decider:</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>        <span class="k">if</span> <span class="p">(</span><span class="nx">stateObj</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="s1">&#39;generalNextFunction&#39;</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">registerGeneralNext</span><span class="p">(</span><span class="nx">stateObj</span><span class="p">.</span><span class="nx">generalNextFunction</span><span class="p">);</span>
        <span class="p">}</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-69" id="section-69">&#182;</a>
</div>
<p>Set specific next-deciders:</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>        <span class="k">for</span> <span class="p">(</span><span class="nx">idx</span> <span class="k">in</span> <span class="nx">stateObj</span><span class="p">.</span><span class="nx">nextFunctions</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">stateObj</span><span class="p">.</span><span class="nx">nextFunctions</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">idx</span><span class="p">))</span> <span class="p">{</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">registerNext</span><span class="p">(</span><span class="nx">idx</span><span class="p">,</span> <span class="nx">stateObj</span><span class="p">.</span><span class="nx">nextFunctions</span><span class="p">[</span><span class="nx">idx</span><span class="p">]);</span>
            <span class="p">}</span>
        <span class="p">}</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-70" id="section-70">&#182;</a>
</div>
<p>Set default step-rule:</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>        <span class="k">if</span> <span class="p">(</span><span class="nx">stateObj</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="s1">&#39;defaultStepRule&#39;</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">setDefaultStepRule</span><span class="p">(</span><span class="nx">stateObj</span><span class="p">.</span><span class="nx">defaultStepRule</span><span class="p">);</span>
        <span class="p">}</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-71" id="section-71">&#182;</a>
</div>
<p>Set default globals:</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>        <span class="k">if</span> <span class="p">(</span><span class="nx">stateObj</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="s1">&#39;defaultGlobals&#39;</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">setDefaultGlobals</span><span class="p">(</span><span class="nx">stateObj</span><span class="p">.</span><span class="nx">defaultGlobals</span><span class="p">);</span>
        <span class="p">}</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-72" id="section-72">&#182;</a>
</div>
<p>Set default properties:</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>        <span class="k">if</span> <span class="p">(</span><span class="nx">stateObj</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="s1">&#39;defaultProperties&#39;</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">setDefaultProperties</span><span class="p">(</span><span class="nx">stateObj</span><span class="p">.</span><span class="nx">defaultProperties</span><span class="p">);</span>
        <span class="p">}</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-73" id="section-73">&#182;</a>
</div>
<p>Set onInit:</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>        <span class="k">if</span> <span class="p">(</span><span class="nx">stateObj</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="s1">&#39;onInit&#39;</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">setOnInit</span><span class="p">(</span><span class="nx">stateObj</span><span class="p">.</span><span class="nx">onInit</span><span class="p">);</span>
        <span class="p">}</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-74" id="section-74">&#182;</a>
</div>
<p>Set onGameover:</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>        <span class="k">if</span> <span class="p">(</span><span class="nx">stateObj</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="s1">&#39;onGameover&#39;</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">setOnGameover</span><span class="p">(</span><span class="nx">stateObj</span><span class="p">.</span><span class="nx">onGameover</span><span class="p">);</span>
        <span class="p">}</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-75" id="section-75">&#182;</a>
</div>
<p>Set toSkip.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>        <span class="k">if</span> <span class="p">(</span><span class="nx">stateObj</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="s1">&#39;toSkip&#39;</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">toSkip</span> <span class="o">=</span> <span class="nx">stateObj</span><span class="p">.</span><span class="nx">toSkip</span><span class="p">;</span>
        <span class="p">}</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-76" id="section-76">&#182;</a>
</div>
<p>Set defaultCallback</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>        <span class="k">if</span> <span class="p">(</span><span class="nx">stateObj</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="s1">&#39;defaultCallback&#39;</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">setDefaultCallback</span><span class="p">(</span><span class="nx">stateObj</span><span class="p">.</span><span class="nx">defaultCallback</span><span class="p">);</span>
        <span class="p">}</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-77" id="section-77">&#182;</a>
</div>
<p>Cache reset.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>        <span class="k">if</span> <span class="p">(</span><span class="nx">stateObj</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="s1">&#39;cacheReset&#39;</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">cacheReset</span> <span class="o">=</span> <span class="nx">stageObj</span><span class="p">.</span><span class="nx">cacheReset</span><span class="p">;</span>
        <span class="p">}</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-78" id="section-78">&#182;</a>
</div>
<p>Mark finalized.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>        <span class="k">this</span><span class="p">.</span><span class="nx">finalized</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
    <span class="p">};</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="stager.getstate">
  <h4>
    <a href="#stager.getstate" class="pilcrow">&#182;</a>
    Stager.getState
  </h4>
</div>

  </div>
  <div class="body"><p>Finalizes the stager and returns a copy of internal state</p>

<p>Fields of returned object:</p>

<p>steps, stages, sequence, generalNextFunction, nextFunctions,
defaultStepRule, defaultGlobals, defaultProperties, onInit,
onGameover, blocks.</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">Returns</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name"></span>
      <span class="dox_type">object</span>
      <span>Clone of the Stager's state</span>
    </div>
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">Stager.setState</span>
    </div>
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">Stager.finalize
  </span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>    <span class="nx">Stager</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">getState</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">finalize</span><span class="p">();</span>

        <span class="k">return</span> <span class="nx">J</span><span class="p">.</span><span class="nx">clone</span><span class="p">({</span>
            <span class="nx">steps</span><span class="o">:</span>               <span class="k">this</span><span class="p">.</span><span class="nx">steps</span><span class="p">,</span>
            <span class="nx">stages</span><span class="o">:</span>              <span class="k">this</span><span class="p">.</span><span class="nx">stages</span><span class="p">,</span>
            <span class="nx">sequence</span><span class="o">:</span>            <span class="k">this</span><span class="p">.</span><span class="nx">sequence</span><span class="p">,</span>
            <span class="nx">generalNextFunction</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">generalNextFunction</span><span class="p">,</span>
            <span class="nx">nextFunctions</span><span class="o">:</span>       <span class="k">this</span><span class="p">.</span><span class="nx">nextFunctions</span><span class="p">,</span>
            <span class="nx">defaultStepRule</span><span class="o">:</span>     <span class="k">this</span><span class="p">.</span><span class="nx">defaultStepRule</span><span class="p">,</span>
            <span class="nx">defaultGlobals</span><span class="o">:</span>      <span class="k">this</span><span class="p">.</span><span class="nx">defaultGlobals</span><span class="p">,</span>
            <span class="nx">defaultProperties</span><span class="o">:</span>   <span class="k">this</span><span class="p">.</span><span class="nx">defaultProperties</span><span class="p">,</span>
            <span class="nx">onInit</span><span class="o">:</span>              <span class="k">this</span><span class="p">.</span><span class="nx">onInit</span><span class="p">,</span>
            <span class="nx">onGameover</span><span class="o">:</span>          <span class="k">this</span><span class="p">.</span><span class="nx">onGameover</span><span class="p">,</span>
            <span class="nx">blocks</span><span class="o">:</span>              <span class="k">this</span><span class="p">.</span><span class="nx">blocks</span><span class="p">,</span>
            <span class="nx">toSkip</span><span class="o">:</span>              <span class="k">this</span><span class="p">.</span><span class="nx">toSkip</span><span class="p">,</span>
            <span class="nx">defaultCallback</span><span class="o">:</span>     <span class="k">this</span><span class="p">.</span><span class="nx">defaultCallback</span>
        <span class="p">});</span>
    <span class="p">};</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="stager.setdefaultsteprule">
  <h4>
    <a href="#stager.setdefaultsteprule" class="pilcrow">&#182;</a>
    Stager.setDefaultStepRule
  </h4>
</div>

  </div>
  <div class="body"><p>Sets the default step-rule function</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">stepRule</span>
      <span class="dox_type">function</span>
      <span>Optional. The step-rule function.
  If undefined, the <code>SOLO</code> rule is set.</span>
    </div>
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">Stager.defaultStepRule</span>
    </div>
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">stepRules
  </span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>    <span class="nx">Stager</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">setDefaultStepRule</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">stepRule</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">stepRule</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;function&#39;</span> <span class="o">!==</span> <span class="k">typeof</span> <span class="nx">stepRule</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">throw</span> <span class="k">new</span> <span class="nx">TypeError</span><span class="p">(</span><span class="s1">&#39;Stager.setDefaultStepRule: &#39;</span> <span class="o">+</span>
                                    <span class="s1">&#39;stepRule must be function or &#39;</span> <span class="o">+</span>
                                    <span class="s1">&#39;undefined.&#39;</span><span class="p">);</span>
            <span class="p">}</span>

            <span class="k">this</span><span class="p">.</span><span class="nx">defaultStepRule</span> <span class="o">=</span> <span class="nx">stepRule</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="p">{</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-81" id="section-81">&#182;</a>
</div>
<p>Initial default.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>            <span class="k">this</span><span class="p">.</span><span class="nx">defaultStepRule</span> <span class="o">=</span> <span class="nx">stepRules</span><span class="p">.</span><span class="nx">SOLO</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">};</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="stager.getdefaultsteprule">
  <h4>
    <a href="#stager.getdefaultsteprule" class="pilcrow">&#182;</a>
    Stager.getDefaultStepRule
  </h4>
</div>

  </div>
  <div class="body"><p>Returns the default step-rule function</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">Returns</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name"></span>
      <span class="dox_type">function</span>
      <span>The default step-rule function</span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>    <span class="nx">Stager</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">getDefaultStepRule</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">defaultStepRule</span><span class="p">;</span>
    <span class="p">};</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="stager.setdefaultcallback">
  <h4>
    <a href="#stager.setdefaultcallback" class="pilcrow">&#182;</a>
    Stager.setDefaultCallback
  </h4>
</div>

  </div>
  <div class="body"><p>Sets the default callback</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">cb</span>
      <span class="dox_type">function</span>
      <span class="dox_type">null</span>
      <span>The default callback or null to unset it</span>
    </div>
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">Stager.defaultCallback</span>
    </div>
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">Stager.getDefaultCallback
  </span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>    <span class="nx">Stager</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">setDefaultCallback</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">cb</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">cb</span> <span class="o">!==</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="s1">&#39;function&#39;</span> <span class="o">!==</span> <span class="k">typeof</span> <span class="nx">cb</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nx">TypeError</span><span class="p">(</span><span class="s1">&#39;Stager.setDefaultCallback: &#39;</span> <span class="o">+</span>
                                <span class="s1">&#39;defaultCallback must be function or null.&#39;</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">defaultCallback</span> <span class="o">=</span> <span class="nx">cb</span><span class="p">;</span>
    <span class="p">};</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="stager.getdefaultcallback">
  <h4>
    <a href="#stager.getdefaultcallback" class="pilcrow">&#182;</a>
    Stager.getDefaultCallback
  </h4>
</div>

  </div>
  <div class="body"><p>Returns the default callback</p>

<p>If the default callback is not set return the static function
<code>Stager.defaultCallback</code></p>
  </div>
  <div class="details">
    <div class="dox_tag_title">Returns</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name"></span>
      <span class="dox_type">function</span>
      <span>The default callback</span>
    </div>
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">Stager.defaultCallback (static)</span>
    </div>
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">Stager.defaultCallback</span>
    </div>
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">Stager.setDefaultCallback
  </span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>    <span class="nx">Stager</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">getDefaultCallback</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">defaultCallback</span> <span class="o">||</span> <span class="nx">Stager</span><span class="p">.</span><span class="nx">defaultCallback</span><span class="p">;</span>
    <span class="p">};</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="stager.setdefaultglobals">
  <h4>
    <a href="#stager.setdefaultglobals" class="pilcrow">&#182;</a>
    Stager.setDefaultGlobals
  </h4>
</div>

  </div>
  <div class="body"><p>Sets/mixes in the default globals</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">defaultGlobals</span>
      <span class="dox_type">object</span>
      <span>The map of default global
  variables</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">mixin</span>
      <span class="dox_type">boolean</span>
      <span>Optional. If TRUE, parameter defaultGlobals
   will be mixed-in with current globals, otherwise it will replace
     it. Default FALSE.</span>
    </div>
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">Stager.defaultGlobals</span>
    </div>
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">GamePlot.getGlobal
  </span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>    <span class="nx">Stager</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">setDefaultGlobals</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">defaultGlobals</span><span class="p">,</span> <span class="nx">mixin</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">defaultGlobals</span> <span class="o">||</span> <span class="s1">&#39;object&#39;</span> <span class="o">!==</span> <span class="k">typeof</span> <span class="nx">defaultGlobals</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nx">TypeError</span><span class="p">(</span><span class="s1">&#39;Stager.setDefaultGlobals: &#39;</span> <span class="o">+</span>
                                <span class="s1">&#39;defaultGlobals must be object.&#39;</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">mixin</span><span class="p">)</span> <span class="nx">J</span><span class="p">.</span><span class="nx">mixin</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">defaultGlobals</span><span class="p">,</span> <span class="nx">defaultGlobals</span><span class="p">);</span>
        <span class="k">else</span> <span class="k">this</span><span class="p">.</span><span class="nx">defaultGlobals</span> <span class="o">=</span> <span class="nx">defaultGlobals</span><span class="p">;</span>
    <span class="p">};</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="stager.getdefaultglobals">
  <h4>
    <a href="#stager.getdefaultglobals" class="pilcrow">&#182;</a>
    Stager.getDefaultGlobals
  </h4>
</div>

  </div>
  <div class="body"><p>Returns the default globals</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">Returns</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name"></span>
      <span class="dox_type">object</span>
      <span>The map of default global variables</span>
    </div>
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">Stager.defaultGlobals</span>
    </div>
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">GamePlot.getGlobal
  </span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>    <span class="nx">Stager</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">getDefaultGlobals</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">defaultGlobals</span><span class="p">;</span>
    <span class="p">};</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="stager.setdefaultproperty">
  <h4>
    <a href="#stager.setdefaultproperty" class="pilcrow">&#182;</a>
    Stager.setDefaultProperty
  </h4>
</div>

  </div>
  <div class="body"><p>Sets a default property</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">name</span>
      <span class="dox_type">string</span>
      <span>The name of the default property</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">value</span>
      <span class="dox_type">mixed</span>
      <span>The value for the default property</span>
    </div>
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">Stager.defaultProperties</span>
    </div>
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">Stager.setDefaultProperties</span>
    </div>
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">GamePlot.getProperty
  </span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>    <span class="nx">Stager</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">setDefaultProperty</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;string&#39;</span> <span class="o">!==</span> <span class="k">typeof</span> <span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nx">TypeError</span><span class="p">(</span><span class="s1">&#39;Stager.setDefaultProperty: name &#39;</span> <span class="o">+</span>
                                <span class="s1">&#39;must be string.&#39;</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">defaultProperties</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span> <span class="o">=</span> <span class="nx">value</span><span class="p">;</span>
    <span class="p">};</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="stager.setdefaultproperties">
  <h4>
    <a href="#stager.setdefaultproperties" class="pilcrow">&#182;</a>
    Stager.setDefaultProperties
  </h4>
</div>

  </div>
  <div class="body"><p>Sets the default properties</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">defaultProperties</span>
      <span class="dox_type">object</span>
      <span>The map of default properties</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">mixin</span>
      <span class="dox_type">boolean</span>
      <span>Optional. If TRUE, parameter defaulProperties
   will be mixed-in with current globals, otherwise it will replace
     it. Default FALSE.</span>
    </div>
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">Stager.defaultProperties</span>
    </div>
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">GamePlot.getProperty
  </span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>    <span class="nx">Stager</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">setDefaultProperties</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">defaultProperties</span><span class="p">,</span>
                                                     <span class="nx">mixin</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">defaultProperties</span> <span class="o">||</span>
            <span class="s1">&#39;object&#39;</span> <span class="o">!==</span> <span class="k">typeof</span> <span class="nx">defaultProperties</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nx">TypeError</span><span class="p">(</span><span class="s1">&#39;Stager.setDefaultProperties: &#39;</span> <span class="o">+</span>
                                <span class="s1">&#39;defaultProperties must be object.&#39;</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">mixin</span><span class="p">)</span> <span class="nx">J</span><span class="p">.</span><span class="nx">mixin</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">defaultProperties</span><span class="p">,</span> <span class="nx">defaultProperties</span><span class="p">);</span>
        <span class="k">else</span> <span class="k">this</span><span class="p">.</span><span class="nx">defaultProperties</span> <span class="o">=</span> <span class="nx">defaultProperties</span><span class="p">;</span>
    <span class="p">};</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="stager.getdefaultproperties">
  <h4>
    <a href="#stager.getdefaultproperties" class="pilcrow">&#182;</a>
    Stager.getDefaultProperties
  </h4>
</div>

  </div>
  <div class="body"><p>Returns the default properties</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">Returns</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name"></span>
      <span class="dox_type">object</span>
      <span>The map of default properties</span>
    </div>
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">Stager.defaultProperties</span>
    </div>
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">GamePlot.getProperty
  </span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>    <span class="nx">Stager</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">getDefaultProperties</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">defaultProperties</span><span class="p">;</span>
    <span class="p">};</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="stager.setoninit">
  <h4>
    <a href="#stager.setoninit" class="pilcrow">&#182;</a>
    Stager.setOnInit
  </h4>
</div>

  </div>
  <div class="body"><p>Sets onInit function</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">func</span>
      <span class="dox_type">function</span>
      <span class="dox_type">null</span>
      <span>The onInit function.
  NULL can be given to signify non-existence.</span>
    </div>
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">Stager.onInit
  </span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>    <span class="nx">Stager</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">setOnInit</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">func</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">func</span> <span class="o">&amp;&amp;</span> <span class="s1">&#39;function&#39;</span> <span class="o">!==</span> <span class="k">typeof</span> <span class="nx">func</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nx">TypeError</span><span class="p">(</span><span class="s1">&#39;Stager.setOnInit: func must be&#39;</span> <span class="o">+</span>
                                <span class="s1">&#39; function or undefined.&#39;</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">onInit</span> <span class="o">=</span> <span class="nx">func</span><span class="p">;</span>
    <span class="p">};</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="stager.getoninit">
  <h4>
    <a href="#stager.getoninit" class="pilcrow">&#182;</a>
    Stager.getOnInit
  </h4>
</div>

  </div>
  <div class="body"><p>Gets onInit function</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">Returns</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name"></span>
      <span class="dox_type">function</span>
      <span class="dox_type">null</span>
      <span>The onInit function.
 NULL signifies non-existence.</span>
    </div>
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">Stager.onInit
  </span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>    <span class="nx">Stager</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">getOnInit</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">func</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">onInit</span><span class="p">;</span>
    <span class="p">};</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="stager.setongameover">
  <h4>
    <a href="#stager.setongameover" class="pilcrow">&#182;</a>
    Stager.setOnGameover
  </h4>
</div>

  </div>
  <div class="body"><p>Sets onGameover function</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">func</span>
      <span class="dox_type">function</span>
      <span class="dox_type">null</span>
      <span>The onGameover function.
  NULL can be given to signify non-existence.</span>
    </div>
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">Stager.onGameover
  </span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>    <span class="nx">Stager</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">setOnGameover</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">func</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">func</span> <span class="o">&amp;&amp;</span> <span class="s1">&#39;function&#39;</span> <span class="o">!==</span> <span class="k">typeof</span> <span class="nx">func</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">&#39;Stager.setOnGameover: func must be &#39;</span> <span class="o">+</span>
                                <span class="s1">&#39;function or undefined.&#39;</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">onGameover</span> <span class="o">=</span> <span class="nx">func</span><span class="p">;</span>
    <span class="p">};</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="stager.setongameover">
  <h4>
    <a href="#stager.setongameover" class="pilcrow">&#182;</a>
    Stager.setOnGameOver
  </h4>
</div>

  </div>
  <div class="body"><p>Alias for <code>setOnGameover</code></p>
  </div>
  <div class="details">
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">Stager.setOnGameover
  </span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>    <span class="nx">Stager</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">setOnGameOver</span> <span class="o">=</span> <span class="nx">Stager</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">setOnGameover</span><span class="p">;</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="stager.getongameover">
  <h4>
    <a href="#stager.getongameover" class="pilcrow">&#182;</a>
    Stager.getOnGameover
  </h4>
</div>

  </div>
  <div class="body"><p>Gets onGameover function</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">Returns</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name"></span>
      <span class="dox_type">function</span>
      <span class="dox_type">null</span>
      <span>The onGameover function, or NULL if none
   is found</span>
    </div>
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">Stager.onGameover
  </span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>    <span class="nx">Stager</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">getOnGameover</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">func</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">onGameover</span><span class="p">;</span>
    <span class="p">};</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="stager.getongameover">
  <h4>
    <a href="#stager.getongameover" class="pilcrow">&#182;</a>
    Stager.getOnGameOver
  </h4>
</div>

  </div>
  <div class="body"><p>Alias for <code>getOnGameover</code></p>
  </div>
  <div class="details">
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">Stager.getOnGameover
  </span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>    <span class="nx">Stager</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">getOnGameOver</span> <span class="o">=</span> <span class="nx">Stager</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">getOnGameover</span><span class="p">;</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="add-stages--steps">
  <h3>
    <a href="#add-stages--steps" class="pilcrow">&#182;</a>
    Add stages, steps
  </h3>
</div>

        </td>
        <td class="code highlight"><div class="highlight"><pre></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="stager.addstep">
  <h4>
    <a href="#stager.addstep" class="pilcrow">&#182;</a>
    Stager.addStep
  </h4>
</div>

  </div>
  <div class="body"><p>Adds a new step</p>

<p>Registers a new game step object. Must have the following fields:</p>

<ul>
<li>id (string): The step's name</li>
<li>cb (function): The step's callback function</li>
</ul>
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">step</span>
      <span class="dox_type">object</span>
      <span>A valid step object. Shallowly copied.</span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>    <span class="nx">Stager</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">addStep</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">step</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">checkStepValidity</span><span class="p">(</span><span class="nx">step</span><span class="p">,</span> <span class="s1">&#39;addStep&#39;</span><span class="p">);</span>

        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">steps</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">step</span><span class="p">.</span><span class="nx">id</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">&#39;Stager.addStep: step id already &#39;</span> <span class="o">+</span>
                            <span class="s1">&#39;existing: &#39;</span> <span class="o">+</span> <span class="nx">step</span><span class="p">.</span><span class="nx">id</span> <span class="o">+</span>
                            <span class="s1">&#39;. Use extendStep to modify it.&#39;</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">steps</span><span class="p">[</span><span class="nx">step</span><span class="p">.</span><span class="nx">id</span><span class="p">]</span> <span class="o">=</span> <span class="nx">step</span><span class="p">;</span>
    <span class="p">};</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="stager.addstage">
  <h4>
    <a href="#stager.addstage" class="pilcrow">&#182;</a>
    Stager.addStage
  </h4>
</div>

  </div>
  <div class="body"><p>Adds a new stage</p>

<p>Registers a new game stage object. Must have an id field:</p>

<ul>
<li>id (string): The stage's name</li>
</ul>

<p>and either of the two following fields:</p>

<ul>
<li><p>steps (array of strings|objects): The names of the steps belonging
to this stage, or the steps objects to define them. In the latter
case steps with the same id must not have been defined before.</p></li>
<li><p>cb (function): The callback function. If this field is used,
then a step with the same name as the stage will be created,
containing all the properties. The stage will be an empty
container referencing</p></li>
</ul>
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">stage</span>
      <span class="dox_type">object</span>
      <span>A valid stage or step object. Shallowly
   copied.</span>
    </div>
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">checkStageValidity
  </span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>    <span class="nx">Stager</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">addStage</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">stage</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">id</span><span class="p">;</span>

        <span class="nx">checkStageValidity</span><span class="p">(</span><span class="nx">stage</span><span class="p">,</span> <span class="s1">&#39;addStage&#39;</span><span class="p">);</span>

        <span class="nx">id</span> <span class="o">=</span> <span class="nx">stage</span><span class="p">.</span><span class="nx">id</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">stages</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">id</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">&#39;Stager.addStage: stage id already existing: &#39;</span> <span class="o">+</span>
                            <span class="nx">id</span> <span class="o">+</span> <span class="s1">&#39;. Use extendStage to modify it.&#39;</span><span class="p">);</span>
        <span class="p">}</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-99" id="section-99">&#182;</a>
</div>
<p>The stage contains only 1 step inside given through the callback
function. A step will be created with same id and callback.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>        <span class="k">if</span> <span class="p">(</span><span class="nx">stage</span><span class="p">.</span><span class="nx">cb</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">addStep</span><span class="p">({</span>
                <span class="nx">id</span><span class="o">:</span> <span class="nx">id</span><span class="p">,</span>
                <span class="nx">cb</span><span class="o">:</span> <span class="nx">stage</span><span class="p">.</span><span class="nx">cb</span>
            <span class="p">});</span>
            <span class="k">delete</span> <span class="nx">stage</span><span class="p">.</span><span class="nx">cb</span><span class="p">;</span>
            <span class="nx">stage</span><span class="p">.</span><span class="nx">steps</span> <span class="o">=</span> <span class="p">[</span> <span class="nx">id</span> <span class="p">];</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="p">{</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-100" id="section-100">&#182;</a>
</div>
<p>Process every step in the array. Steps array is modified.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>            <span class="nx">handleStepsArray</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">id</span><span class="p">,</span> <span class="nx">stage</span><span class="p">.</span><span class="nx">steps</span><span class="p">,</span> <span class="s1">&#39;addStage&#39;</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">stages</span><span class="p">[</span><span class="nx">id</span><span class="p">]</span> <span class="o">=</span> <span class="nx">stage</span><span class="p">;</span>
    <span class="p">};</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="stager.clonestep">
  <h4>
    <a href="#stager.clonestep" class="pilcrow">&#182;</a>
    Stager.cloneStep
  </h4>
</div>

  </div>
  <div class="body"><p>Clones a stage and assigns a new id to it</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">stepId</span>
      <span class="dox_type">string</span>
      <span>The name of the stage to clone</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">newStepId</span>
      <span class="dox_type">string</span>
      <span>The new unique id to assign to the clone</span>
    </div>
    <div class="dox_tag_title">Returns</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name"></span>
      <span class="dox_type">object</span>
      <span>step Reference to the cloned step</span>
    </div>
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">Stager.addStep
  </span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>    <span class="nx">Stager</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">cloneStep</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">stepId</span><span class="p">,</span> <span class="nx">newStepId</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">step</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;string&#39;</span> <span class="o">!==</span> <span class="k">typeof</span> <span class="nx">stepId</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nx">TypeError</span><span class="p">(</span><span class="s1">&#39;Stager.cloneStep: stepId must be string.&#39;</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;string&#39;</span> <span class="o">!==</span> <span class="k">typeof</span> <span class="nx">newStepId</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nx">TypeError</span><span class="p">(</span><span class="s1">&#39;Stager.cloneStep: newStepId must be string.&#39;</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">steps</span><span class="p">[</span><span class="nx">newStepId</span><span class="p">])</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">&#39;Stager.cloneStep: newStepId already taken: &#39;</span> <span class="o">+</span>
                            <span class="nx">newStepId</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="nx">step</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">steps</span><span class="p">[</span><span class="nx">stepId</span><span class="p">];</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">step</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">&#39;Stager.cloneStep: step not found: &#39;</span> <span class="o">+</span>
                            <span class="nx">stepId</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="nx">step</span> <span class="o">=</span> <span class="nx">J</span><span class="p">.</span><span class="nx">clone</span><span class="p">(</span><span class="nx">step</span><span class="p">);</span>
        <span class="nx">step</span><span class="p">.</span><span class="nx">id</span> <span class="o">=</span> <span class="nx">newStepId</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">addStep</span><span class="p">(</span><span class="nx">step</span><span class="p">);</span>
        <span class="k">return</span> <span class="nx">step</span><span class="p">;</span>
    <span class="p">};</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="stager.clonestage">
  <h4>
    <a href="#stager.clonestage" class="pilcrow">&#182;</a>
    Stager.cloneStage
  </h4>
</div>

  </div>
  <div class="body"><p>Clones a stage and assigns a new id to it</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">stageId</span>
      <span class="dox_type">string</span>
      <span>The id of the stage to clone</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">newStageId</span>
      <span class="dox_type">string</span>
      <span>The new unique id to assign to the clone</span>
    </div>
    <div class="dox_tag_title">Returns</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name"></span>
      <span class="dox_type">object</span>
      <span>stage Reference to the cloned stage</span>
    </div>
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">Stager.addStage
  </span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>    <span class="nx">Stager</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">cloneStage</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">stageId</span><span class="p">,</span> <span class="nx">newStageId</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">stage</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;string&#39;</span> <span class="o">!==</span> <span class="k">typeof</span> <span class="nx">stageId</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nx">TypeError</span><span class="p">(</span><span class="s1">&#39;Stager.cloneStage: stageId must be string.&#39;</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;string&#39;</span> <span class="o">!==</span> <span class="k">typeof</span> <span class="nx">newStageId</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nx">TypeError</span><span class="p">(</span><span class="s1">&#39;Stager.cloneStage: newStageId must &#39;</span> <span class="o">+</span>
                                <span class="s1">&#39;be string.&#39;</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">stages</span><span class="p">[</span><span class="nx">newStageId</span><span class="p">])</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">&#39;Stager.cloneStage: newStageId already taken: &#39;</span> <span class="o">+</span>
                            <span class="nx">newStageId</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="nx">stage</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">stages</span><span class="p">[</span><span class="nx">stageId</span><span class="p">];</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">stage</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">&#39;Stager.cloneStage: stage not found: &#39;</span> <span class="o">+</span>
                            <span class="nx">stageId</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="nx">stage</span> <span class="o">=</span> <span class="nx">J</span><span class="p">.</span><span class="nx">clone</span><span class="p">(</span><span class="nx">stage</span><span class="p">);</span>
        <span class="nx">stage</span><span class="p">.</span><span class="nx">id</span> <span class="o">=</span> <span class="nx">newStageId</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">addStage</span><span class="p">(</span><span class="nx">stage</span><span class="p">);</span>
        <span class="k">return</span> <span class="nx">stage</span><span class="p">;</span>
    <span class="p">};</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="stager.step">
  <h4>
    <a href="#stager.step" class="pilcrow">&#182;</a>
    Stager.step
  </h4>
</div>

  </div>
  <div class="body"><p>Adds a step to the current Block.</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">stage</span>
      <span class="dox_type">string</span>
      <span class="dox_type">object</span>
      <span>A valid step object or the stepId string.</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">positions</span>
      <span class="dox_type">string</span>
      <span>Optional. Positions within the
   enclosing Block that this step can occupy.</span>
    </div>
    <div class="dox_tag_title">Returns</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name"></span>
      <span class="dox_type">Stager</span>
      <span>Reference to this instance for method chaining</span>
    </div>
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">Stager.addStep
  </span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>    <span class="nx">Stager</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">step</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">step</span><span class="p">,</span> <span class="nx">positions</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">id</span><span class="p">;</span>

        <span class="nx">checkFinalized</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="s1">&#39;step&#39;</span><span class="p">);</span>
        <span class="nx">id</span> <span class="o">=</span> <span class="nx">checkStepParameter</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">step</span><span class="p">,</span> <span class="s1">&#39;step&#39;</span><span class="p">);</span>
        <span class="nx">positions</span> <span class="o">=</span> <span class="nx">checkPositionsParameter</span><span class="p">(</span><span class="nx">positions</span><span class="p">,</span> <span class="s1">&#39;step&#39;</span><span class="p">);</span>

        <span class="k">this</span><span class="p">.</span><span class="nx">getCurrentBlock</span><span class="p">().</span><span class="nx">add</span><span class="p">({</span>
            <span class="nx">type</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">currentType</span><span class="p">,</span>
            <span class="nx">item</span><span class="o">:</span> <span class="nx">id</span>
        <span class="p">},</span> <span class="nx">positions</span><span class="p">);</span>

        <span class="k">this</span><span class="p">.</span><span class="nx">stages</span><span class="p">[</span><span class="k">this</span><span class="p">.</span><span class="nx">currentType</span><span class="p">].</span><span class="nx">steps</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">id</span><span class="p">);</span>

        <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
    <span class="p">};</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="stager.next---stage">
  <h4>
    <a href="#stager.next---stage" class="pilcrow">&#182;</a>
    Stager.next | stage
  </h4>
</div>

  </div>
  <div class="body"><p>Adds a stage block to sequence</p>

<p>The <code>id</code> parameter must have the form 'stageID' or 'stageID AS alias'.
stageID must be a valid stage and it (or alias if given) must be
unique in the sequence.</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">id</span>
      <span class="dox_type">string</span>
      <span class="dox_type">object</span>
      <span>A stage name with optional alias
  or a stage object.</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">positions</span>
      <span class="dox_type">string</span>
      <span>Optional. Allowed positions for the stage</span>
    </div>
    <div class="dox_tag_title">Returns</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name"></span>
      <span class="dox_type">Stager</span>
      <span>Reference to this instance for method chaining</span>
    </div>
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">Stager.addStage
  </span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>    <span class="nx">Stager</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">stage</span> <span class="o">=</span> <span class="nx">Stager</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">next</span> <span class="o">=</span>
        <span class="kd">function</span><span class="p">(</span><span class="nx">stage</span><span class="p">,</span> <span class="nx">positions</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">stageName</span><span class="p">;</span>

            <span class="nx">checkFinalized</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="s1">&#39;next&#39;</span><span class="p">);</span>
            <span class="nx">stageName</span> <span class="o">=</span> <span class="nx">handleStageParameter</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">stage</span><span class="p">,</span> <span class="s1">&#39;next&#39;</span><span class="p">);</span>
            <span class="nx">positions</span> <span class="o">=</span> <span class="nx">checkPositionsParameter</span><span class="p">(</span><span class="nx">positions</span><span class="p">,</span> <span class="s1">&#39;next&#39;</span><span class="p">);</span>

            <span class="nx">addStageToCurrentBlock</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="p">{</span>
                <span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;plain&#39;</span><span class="p">,</span>
                <span class="nx">id</span><span class="o">:</span> <span class="nx">stageName</span>
            <span class="p">},</span> <span class="nx">positions</span><span class="p">);</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-105" id="section-105">&#182;</a>
</div>
<p>Must be done after addStageToCurrentBlock is called.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>            <span class="nx">addStepsToCurrentBlock</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">stages</span><span class="p">[</span><span class="nx">stageName</span><span class="p">]);</span>
            <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
        <span class="p">};</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="stager.repeat---repeatstage">
  <h4>
    <a href="#stager.repeat---repeatstage" class="pilcrow">&#182;</a>
    Stager.repeat | repeatStage
  </h4>
</div>

  </div>
  <div class="body"><p>Adds repeated stage block to sequence</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">stage</span>
      <span class="dox_type">string</span>
      <span class="dox_type">object</span>
      <span>A stage name with optional alias
  or a stage object.</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">positions</span>
      <span class="dox_type">string</span>
      <span>Optional. Allowed positions for the stage</span>
    </div>
    <div class="dox_tag_title">Returns</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name"></span>
      <span class="dox_type">Stager</span>
      <span>Reference to this instance for method chaining</span>
    </div>
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">Stager.addStage</span>
    </div>
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">Stager.next
  </span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>    <span class="nx">Stager</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">repeatStage</span> <span class="o">=</span> <span class="nx">Stager</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">repeat</span> <span class="o">=</span>
        <span class="kd">function</span><span class="p">(</span><span class="nx">stage</span><span class="p">,</span> <span class="nx">nRepeats</span><span class="p">,</span> <span class="nx">positions</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">stageName</span><span class="p">;</span>

            <span class="nx">checkFinalized</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="s1">&#39;repeat&#39;</span><span class="p">);</span>

            <span class="nx">stageName</span> <span class="o">=</span> <span class="nx">handleStageParameter</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">stage</span><span class="p">,</span> <span class="s1">&#39;next&#39;</span><span class="p">);</span>

            <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;number&#39;</span> <span class="o">!==</span> <span class="k">typeof</span> <span class="nx">nRepeats</span> <span class="o">||</span>
                <span class="nb">isNaN</span><span class="p">(</span><span class="nx">nRepeats</span><span class="p">)</span> <span class="o">||</span>
                <span class="nx">nRepeats</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>

                <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">&#39;Stager.repeat: nRepeats must be a positive &#39;</span> <span class="o">+</span>
                                <span class="s1">&#39;number. Found: &#39;</span> <span class="o">+</span> <span class="nx">nRepeats</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span><span class="p">);</span>
            <span class="p">}</span>

            <span class="nx">positions</span> <span class="o">=</span> <span class="nx">checkPositionsParameter</span><span class="p">(</span><span class="nx">positions</span><span class="p">,</span> <span class="s1">&#39;repeat&#39;</span><span class="p">);</span>

            <span class="nx">addStageToCurrentBlock</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="p">{</span>
                <span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;repeat&#39;</span><span class="p">,</span>
                <span class="nx">id</span><span class="o">:</span> <span class="nx">stageName</span><span class="p">,</span>
                <span class="nx">num</span><span class="o">:</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">nRepeats</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
            <span class="p">},</span> <span class="nx">positions</span><span class="p">);</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-107" id="section-107">&#182;</a>
</div>
<p>Must be done after addStageToCurrentBlock is called.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>            <span class="nx">addStepsToCurrentBlock</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">stages</span><span class="p">[</span><span class="nx">stageName</span><span class="p">]);</span>
            <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
        <span class="p">};</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="stager.loop---loopstage">
  <h4>
    <a href="#stager.loop---loopstage" class="pilcrow">&#182;</a>
    Stager.loop | loopStage
  </h4>
</div>

  </div>
  <div class="body"><p>Adds looped stage block to sequence</p>

<p>The given stage will be repeated as long as the <code>func</code> callback
returns TRUE. If it returns FALSE on the first time, the stage is
never executed.</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">stage</span>
      <span class="dox_type">string</span>
      <span class="dox_type">object</span>
      <span>A stage name with optional alias
  or a stage object.</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">loopFunc</span>
      <span class="dox_type">function</span>
      <span>Callback returning TRUE for
  repetition.</span>
    </div>
    <div class="dox_tag_title">Returns</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name"></span>
      <span class="dox_type">Stager</span>
      <span>Reference to this instance for method chaining</span>
    </div>
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">Stager.addStage</span>
    </div>
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">Stager.next</span>
    </div>
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">Stager.doLoop
  </span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>    <span class="nx">Stager</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">loopStage</span> <span class="o">=</span> <span class="nx">Stager</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">loop</span> <span class="o">=</span>
        <span class="kd">function</span><span class="p">(</span><span class="nx">stage</span><span class="p">,</span> <span class="nx">loopFunc</span><span class="p">,</span> <span class="nx">positions</span><span class="p">)</span> <span class="p">{</span>

            <span class="k">return</span> <span class="nx">addLoop</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="s1">&#39;loop&#39;</span><span class="p">,</span> <span class="nx">stage</span><span class="p">,</span> <span class="nx">loopFunc</span><span class="p">,</span> <span class="nx">positions</span><span class="p">);</span>
        <span class="p">};</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="stager.doloop---doloopstage">
  <h4>
    <a href="#stager.doloop---doloopstage" class="pilcrow">&#182;</a>
    Stager.doLoop | doLoopStage
  </h4>
</div>

  </div>
  <div class="body"><p>Adds alternatively looped stage block to sequence</p>

<p>The given stage will be repeated once plus as many times as the
<code>func</code> callback returns TRUE.</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">stage</span>
      <span class="dox_type">string</span>
      <span class="dox_type">object</span>
      <span>A stage name with optional alias
  or a stage object.</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">loopFunc</span>
      <span class="dox_type">function</span>
      <span>Optional. Callback returning TRUE for
  repetition.</span>
    </div>
    <div class="dox_tag_title">Returns</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name"></span>
      <span class="dox_type">Stager</span>
      <span>Reference to this instance for method chaining</span>
    </div>
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">Stager.addStage</span>
    </div>
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">Stager.next</span>
    </div>
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">Stager.loop
  </span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>    <span class="nx">Stager</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">doLoopStage</span> <span class="o">=</span> <span class="nx">Stager</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">doLoop</span> <span class="o">=</span>
        <span class="kd">function</span><span class="p">(</span><span class="nx">stage</span><span class="p">,</span> <span class="nx">loopFunc</span><span class="p">,</span> <span class="nx">positions</span><span class="p">)</span> <span class="p">{</span>

            <span class="k">return</span> <span class="nx">addLoop</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="s1">&#39;doLoop&#39;</span><span class="p">,</span> <span class="nx">stage</span><span class="p">,</span> <span class="nx">loopFunc</span><span class="p">,</span> <span class="nx">positions</span><span class="p">);</span>
        <span class="p">};</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="stager.gameover">
  <h4>
    <a href="#stager.gameover" class="pilcrow">&#182;</a>
    Stager.gameover
  </h4>
</div>

  </div>
  <div class="body"><p>Adds gameover block to sequence</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">Returns</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name"></span>
      <span class="dox_type">Stager</span>
      <span>this object</span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>    <span class="nx">Stager</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">gameover</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">addStageToCurrentBlock</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="p">{</span> <span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;gameover&#39;</span> <span class="p">});</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
    <span class="p">};</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="extend-stages--modify-sequence">
  <h3>
    <a href="#extend-stages--modify-sequence" class="pilcrow">&#182;</a>
    Extend stages, modify sequence
  </h3>
</div>

        </td>
        <td class="code highlight"><div class="highlight"><pre></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="stager.extendstep">
  <h4>
    <a href="#stager.extendstep" class="pilcrow">&#182;</a>
    Stager.extendStep
  </h4>
</div>

  </div>
  <div class="body"><p>Extends an existing step</p>

<p>Notice: properties <code>id</code> cannot be modified, and property <code>cb</code>
must always be a function.</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">stepId</span>
      <span class="dox_type">string</span>
      <span>The id of the step to update</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">update</span>
      <span class="dox_type">object</span>
      <span class="dox_type">function</span>
      <span>The object containing the
  properties to update, or an update function that takes a copy
  of current step and returns the whole new updated step</span>
    </div>
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">Stager.addStep</span>
    </div>
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">validateExtendedStep
  </span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>    <span class="nx">Stager</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">extendStep</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">stepId</span><span class="p">,</span> <span class="nx">update</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">step</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;string&#39;</span> <span class="o">!==</span> <span class="k">typeof</span> <span class="nx">stepId</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nx">TypeError</span><span class="p">(</span><span class="s1">&#39;Stager.extendStep: stepId must be a&#39;</span> <span class="o">+</span>
                                <span class="s1">&#39; string.&#39;</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="nx">step</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">steps</span><span class="p">[</span><span class="nx">stepId</span><span class="p">];</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">step</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">&#39;Stager.extendStep: stepId not found: &#39;</span> <span class="o">+</span>
                            <span class="nx">stepId</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;function&#39;</span> <span class="o">===</span> <span class="k">typeof</span> <span class="nx">update</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">step</span> <span class="o">=</span> <span class="nx">update</span><span class="p">(</span><span class="nx">J</span><span class="p">.</span><span class="nx">clone</span><span class="p">(</span><span class="nx">step</span><span class="p">));</span>
            <span class="nx">validateExtendedStep</span><span class="p">(</span><span class="nx">stepId</span><span class="p">,</span> <span class="nx">step</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">steps</span><span class="p">[</span><span class="nx">stepId</span><span class="p">]</span> <span class="o">=</span> <span class="nx">step</span><span class="p">;</span>

        <span class="p">}</span>
        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">update</span> <span class="o">&amp;&amp;</span> <span class="s1">&#39;object&#39;</span> <span class="o">===</span> <span class="k">typeof</span> <span class="nx">update</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">validateExtendedStep</span><span class="p">(</span><span class="nx">stepId</span><span class="p">,</span> <span class="nx">update</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
            <span class="nx">J</span><span class="p">.</span><span class="nx">mixin</span><span class="p">(</span><span class="nx">step</span><span class="p">,</span> <span class="nx">update</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nx">TypeError</span><span class="p">(</span><span class="s1">&#39;Stager.extendStep: update must be object &#39;</span> <span class="o">+</span>
                                <span class="s1">&#39;or function. Step id: &#39;</span> <span class="o">+</span> <span class="nx">stepId</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">};</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="stager.extendstage">
  <h4>
    <a href="#stager.extendstage" class="pilcrow">&#182;</a>
    Stager.extendStage
  </h4>
</div>

  </div>
  <div class="body"><p>Extends an existing stage</p>

<p>Notice: properties <code>id</code> and <code>cb</code> cannot be modified / added.</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">stageId</span>
      <span class="dox_type">string</span>
      <span>The id of the stage to update</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">update</span>
      <span class="dox_type">object</span>
      <span class="dox_type">function</span>
      <span>The object containing the
  properties to update, or an update function that takes a copy
  of current stage and returns the whole new updated stage</span>
    </div>
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">Stager.addStage</span>
    </div>
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">validateExtendedStage
  </span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>    <span class="nx">Stager</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">extendStage</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">stageId</span><span class="p">,</span> <span class="nx">update</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">stage</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;string&#39;</span> <span class="o">!==</span> <span class="k">typeof</span> <span class="nx">stageId</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nx">TypeError</span><span class="p">(</span><span class="s1">&#39;Stager.extendStage: stageId must be &#39;</span> <span class="o">+</span>
                                <span class="s1">&#39;a string.&#39;</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="nx">stage</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">stages</span><span class="p">[</span><span class="nx">stageId</span><span class="p">];</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">stage</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">&#39;Stager.extendStage: stageId not found: &#39;</span> <span class="o">+</span>
                            <span class="nx">stageId</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;function&#39;</span> <span class="o">===</span> <span class="k">typeof</span> <span class="nx">update</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">stage</span> <span class="o">=</span> <span class="nx">update</span><span class="p">(</span><span class="nx">J</span><span class="p">.</span><span class="nx">clone</span><span class="p">(</span><span class="nx">stage</span><span class="p">));</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">stage</span> <span class="o">||</span> <span class="s1">&#39;object&#39;</span> <span class="o">!==</span> <span class="k">typeof</span> <span class="nx">stage</span> <span class="o">||</span>
                <span class="o">!</span><span class="nx">stage</span><span class="p">.</span><span class="nx">id</span> <span class="o">||</span> <span class="o">!</span><span class="nx">stage</span><span class="p">.</span><span class="nx">steps</span><span class="p">)</span> <span class="p">{</span>

                <span class="k">throw</span> <span class="k">new</span> <span class="nx">TypeError</span><span class="p">(</span><span class="s1">&#39;Stager.extendStage: update function &#39;</span> <span class="o">+</span>
                                    <span class="s1">&#39;must return an object with id and steps.&#39;</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="nx">validateExtendedStage</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">stageId</span><span class="p">,</span> <span class="nx">stage</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">stages</span><span class="p">[</span><span class="nx">stageId</span><span class="p">]</span> <span class="o">=</span> <span class="nx">stage</span><span class="p">;</span>

        <span class="p">}</span>
        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">update</span> <span class="o">&amp;&amp;</span> <span class="s1">&#39;object&#39;</span> <span class="o">===</span> <span class="k">typeof</span> <span class="nx">update</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">validateExtendedStage</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">stageId</span><span class="p">,</span> <span class="nx">update</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
            <span class="nx">J</span><span class="p">.</span><span class="nx">mixin</span><span class="p">(</span><span class="nx">stage</span><span class="p">,</span> <span class="nx">update</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nx">TypeError</span><span class="p">(</span><span class="s1">&#39;Stager.extendStage: update must be object &#39;</span> <span class="o">+</span>
                                <span class="s1">&#39;or function. Stage id: &#39;</span> <span class="o">+</span> <span class="nx">stageId</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">};</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="stager.extendallsteps">
  <h4>
    <a href="#stager.extendallsteps" class="pilcrow">&#182;</a>
    Stager.extendAllSteps
  </h4>
</div>

  </div>
  <div class="body"><p>Extends all existing steps</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">update</span>
      <span class="dox_type">object</span>
      <span class="dox_type">function</span>
      <span>The object containing the
  properties to update, or an update function that takes a copy
  of current step and returns the whole new updated step</span>
    </div>
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">Stager.addStep</span>
    </div>
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">Stager.extendStep
  </span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>    <span class="nx">Stager</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">extendAllSteps</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">update</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">step</span><span class="p">;</span>
        <span class="k">for</span> <span class="p">(</span><span class="nx">step</span> <span class="k">in</span> <span class="k">this</span><span class="p">.</span><span class="nx">steps</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">steps</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">step</span><span class="p">))</span> <span class="p">{</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">extendStep</span><span class="p">(</span><span class="nx">step</span><span class="p">,</span> <span class="nx">update</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">};</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="stager.extendallstages">
  <h4>
    <a href="#stager.extendallstages" class="pilcrow">&#182;</a>
    Stager.extendAllStages
  </h4>
</div>

  </div>
  <div class="body"><p>Extends all existing stages</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">update</span>
      <span class="dox_type">object</span>
      <span class="dox_type">function</span>
      <span>The object containing the
  properties to update, or an update function that takes a copy
  of current stage and returns the whole new updated stage</span>
    </div>
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">Stager.addStage</span>
    </div>
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">Stager.extendStage
  </span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>    <span class="nx">Stager</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">extendAllStages</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">update</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">stage</span><span class="p">;</span>
        <span class="k">for</span> <span class="p">(</span><span class="nx">stage</span> <span class="k">in</span> <span class="k">this</span><span class="p">.</span><span class="nx">stages</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">stages</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">stage</span><span class="p">))</span> <span class="p">{</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">extendStage</span><span class="p">(</span><span class="nx">stage</span><span class="p">,</span> <span class="nx">update</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">};</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="stager.skip">
  <h4>
    <a href="#stager.skip" class="pilcrow">&#182;</a>
    Stager.skip
  </h4>
</div>

  </div>
  <div class="body"><p>Marks a stage or as step as <code>toSkip</code> and won't be added to sequence</p>

<p>Must be called before invoking <code>Stager.finalize()</code>.</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">stageId</span>
      <span class="dox_type">string</span>
      <span>The id of the stage to skip</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">stepId</span>
      <span class="dox_type">string</span>
      <span>Optional. The id of the step within
  the stage to skip</span>
    </div>
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">Stager.unskip</span>
    </div>
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">Stager.finalize
  </span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>    <span class="nx">Stager</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">skip</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">stageId</span><span class="p">,</span> <span class="nx">stepId</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">checkFinalized</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="s1">&#39;skip&#39;</span><span class="p">);</span>
        <span class="nx">setSkipStageStep</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">stageId</span><span class="p">,</span> <span class="nx">stepId</span><span class="p">,</span> <span class="kc">true</span><span class="p">,</span> <span class="s1">&#39;skip&#39;</span><span class="p">);</span>
    <span class="p">};</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="stager.unskip">
  <h4>
    <a href="#stager.unskip" class="pilcrow">&#182;</a>
    Stager.unskip
  </h4>
</div>

  </div>
  <div class="body"><p>Unskips a stage or step</p>

<p>Must be called before invoking <code>Stager.finalize()</code>.</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">stageId</span>
      <span class="dox_type">string</span>
      <span>The id of the stage</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">stepId</span>
      <span class="dox_type">string</span>
      <span>Optional. The id of the step within the stage</span>
    </div>
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">Stager.skip</span>
    </div>
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">Stager.finalize
  </span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>    <span class="nx">Stager</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">unskip</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">stageId</span><span class="p">,</span> <span class="nx">stepId</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">checkFinalized</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="s1">&#39;unskip&#39;</span><span class="p">);</span>
        <span class="nx">setSkipStageStep</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">stageId</span><span class="p">,</span> <span class="nx">stepId</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="s1">&#39;unskip&#39;</span><span class="p">);</span>
    <span class="p">};</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="stager.isskipped">
  <h4>
    <a href="#stager.isskipped" class="pilcrow">&#182;</a>
    Stager.isSkipped
  </h4>
</div>

  </div>
  <div class="body"><p>Returns TRUE if a stage or step is currently marked as <code>toSkip</code></p>
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">stageId</span>
      <span class="dox_type">string</span>
      <span>The id of the stage</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">stepId</span>
      <span class="dox_type">string</span>
      <span>Optional. The id of the step within the stage</span>
    </div>
    <div class="dox_tag_title">Returns</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name"></span>
      <span class="dox_type">boolean</span>
      <span>TRUE, if the stage or step is marked as <code>toSkip</code></span>
    </div>
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">Stager.skip</span>
    </div>
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">Stager.unskip
  </span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>    <span class="nx">Stager</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">isSkipped</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">stageId</span><span class="p">,</span> <span class="nx">stepId</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="o">!!</span><span class="nx">setSkipStageStep</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">stageId</span><span class="p">,</span> <span class="nx">stepId</span><span class="p">,</span> <span class="kc">undefined</span><span class="p">,</span>
                                  <span class="s1">&#39;isSkipped&#39;</span><span class="p">);</span>
    <span class="p">};</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="blocks">
  <h3>
    <a href="#blocks" class="pilcrow">&#182;</a>
    Blocks
  </h3>
</div>

        </td>
        <td class="code highlight"><div class="highlight"><pre></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="stager.beginblock">
  <h4>
    <a href="#stager.beginblock" class="pilcrow">&#182;</a>
    Stager.beginBlock
  </h4>
</div>

  </div>
  <div class="body"><p>Begins a new Block</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">positions</span>
      <span class="dox_type">string</span>
      <span>Optional. Positions within the
   enclosing Block that this block can occupy.</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">options</span>
      <span class="dox_type">object</span>
      <span>for the Block constructor</span>
    </div>
    <div class="dox_tag_title">Returns</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name"></span>
      <span class="dox_type">Stager</span>
      <span>Reference to the current instance for method chainining</span>
    </div>
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">Block
  </span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>    <span class="nx">Stager</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">beginBlock</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">positions</span><span class="p">,</span> <span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">block</span><span class="p">;</span>
        <span class="nx">options</span> <span class="o">=</span> <span class="nx">options</span> <span class="o">||</span> <span class="p">{};</span>
        <span class="nx">options</span><span class="p">.</span><span class="nx">type</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">currentBlockType</span><span class="p">;</span>

        <span class="nx">block</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Block</span><span class="p">(</span><span class="nx">positions</span><span class="p">,</span> <span class="nx">options</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">unfinishedBlocks</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">block</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">blocks</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">block</span><span class="p">);</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
    <span class="p">};</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="stager.endblock">
  <h4>
    <a href="#stager.endblock" class="pilcrow">&#182;</a>
    Stager.endBlock
  </h4>
</div>

  </div>
  <div class="body"><p>Ends the current Block</p>

<p>param {object} options Optional If <code>options.finalize</code> is set, the
  block gets finalized.</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">Returns</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name"></span>
      <span class="dox_type">Stager</span>
      <span>Reference to the current instance for method chainining</span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>    <span class="nx">Stager</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">endBlock</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">block</span><span class="p">,</span> <span class="nx">currentBlock</span><span class="p">;</span>
        <span class="kd">var</span> <span class="nx">found</span><span class="p">,</span> <span class="nx">i</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">unfinishedBlocks</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
        <span class="nx">options</span> <span class="o">=</span> <span class="nx">options</span> <span class="o">||</span> <span class="p">{};</span>

        <span class="nx">block</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">unfinishedBlocks</span><span class="p">.</span><span class="nx">pop</span><span class="p">();</span>


        <span class="k">if</span> <span class="p">(</span><span class="nx">block</span><span class="p">.</span><span class="nx">id</span> <span class="o">&amp;&amp;</span> <span class="nx">block</span><span class="p">.</span><span class="nx">id</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s1">&#39;STEPBL&#39;</span><span class="p">)</span> <span class="o">!==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>

            <span class="nx">i</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">blocks</span><span class="p">.</span><span class="nx">length</span><span class="o">-</span><span class="mi">1</span><span class="p">;</span>
            <span class="k">do</span> <span class="p">{</span>
                <span class="nx">currentBlock</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">blocks</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
                <span class="nx">found</span> <span class="o">=</span> <span class="nx">currentBlock</span><span class="p">.</span><span class="nx">id</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">BLOCK_ENCLOSING</span><span class="p">)</span> <span class="o">!==</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
                <span class="nx">i</span><span class="o">--</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">while</span> <span class="p">(</span><span class="o">!</span><span class="nx">found</span> <span class="o">&amp;&amp;</span> <span class="nx">i</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span>

            <span class="k">if</span> <span class="p">(</span><span class="nx">found</span><span class="p">)</span> <span class="nx">currentBlock</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">block</span><span class="p">,</span> <span class="nx">block</span><span class="p">.</span><span class="nx">positions</span><span class="p">);</span>
            <span class="k">else</span> <span class="p">{</span>
                <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">&#39;AAAAAAAAAAAh, this should not happen.&#39;</span><span class="p">);</span>
            <span class="p">}</span>

        <span class="p">}</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-122" id="section-122">&#182;</a>
</div>
<p>Normal stage / step block, add it to preb</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">block</span><span class="p">.</span><span class="nx">id</span> <span class="o">&amp;&amp;</span> <span class="nx">block</span><span class="p">.</span><span class="nx">id</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s1">&#39;AAA&#39;</span><span class="p">)</span> <span class="o">===</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>

            <span class="nx">currentBlock</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">getCurrentBlock</span><span class="p">();</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">currentBlock</span><span class="p">)</span> <span class="nx">currentBlock</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">block</span><span class="p">,</span> <span class="nx">block</span><span class="p">.</span><span class="nx">positions</span><span class="p">);</span>

        <span class="p">}</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-123" id="section-123">&#182;</a>
</div>
<p>Add stage block to default block.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">block</span><span class="p">.</span><span class="nx">id</span> <span class="o">!==</span> <span class="nx">BLOCK_DEFAULT</span> <span class="o">&amp;&amp;</span>
                 <span class="nx">block</span><span class="p">.</span><span class="nx">id</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">BLOCK_ENCLOSING</span><span class="p">)</span> <span class="o">===</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>

            <span class="k">this</span><span class="p">.</span><span class="nx">blocks</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">add</span><span class="p">(</span><span class="nx">block</span><span class="p">,</span> <span class="nx">block</span><span class="p">.</span><span class="nx">positions</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">finalize</span><span class="p">)</span> <span class="nx">block</span><span class="p">.</span><span class="nx">finalize</span><span class="p">();</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
    <span class="p">};</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="stager.endblocks">
  <h4>
    <a href="#stager.endblocks" class="pilcrow">&#182;</a>
    Stager.endBlocks
  </h4>
</div>

  </div>
  <div class="body"><p>Ends multiple Blocks</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">Number</span>
      <span>n Number of Blocks to be ended.</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">options</span>
      <span class="dox_type">object</span>
      <span>Optional If options.finalize is set, the
     block gets finalized.</span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>    <span class="nx">Stager</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">endBlocks</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">n</span><span class="p">,</span> <span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">i</span><span class="p">;</span>
        <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">n</span><span class="p">;</span> <span class="o">++</span><span class="nx">i</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">endBlock</span><span class="p">(</span><span class="nx">options</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
    <span class="p">};</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="stager.endallblocks">
  <h4>
    <a href="#stager.endallblocks" class="pilcrow">&#182;</a>
    Stager.endAllBlocks
  </h4>
</div>

  </div>
  <div class="body"><p>Ends all unfinished Blocks.</p>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>    <span class="nx">Stager</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">endAllBlocks</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">endBlocks</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">unfinishedBlocks</span><span class="p">.</span><span class="nx">length</span><span class="p">);</span>
    <span class="p">};</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="stager.stepblock">
  <h4>
    <a href="#stager.stepblock" class="pilcrow">&#182;</a>
    Stager.stepBlock
  </h4>
</div>

  </div>
  <div class="body"><p>Begins a new Block of steps</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">positions</span>
      <span class="dox_type">string</span>
      <span>Optional. Positions within the
  enclosing Block that this block can occupy.</span>
    </div>
    <div class="dox_tag_title">Returns</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name"></span>
      <span class="dox_type">Stager</span>
      <span>Reference to the current instance for method chainining</span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>    <span class="nx">Stager</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">stepBlock</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">position</span><span class="p">,</span> <span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">currentBlockType</span> <span class="o">=</span> <span class="nx">BLOCK_STEP</span><span class="p">;</span>
        <span class="nx">options</span> <span class="o">=</span> <span class="nx">options</span> <span class="o">||</span> <span class="p">{};</span>
        <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;undefined&#39;</span> <span class="o">===</span> <span class="k">typeof</span> <span class="nx">options</span><span class="p">.</span><span class="nx">id</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">options</span><span class="p">.</span><span class="nx">id</span> <span class="o">=</span> <span class="s1">&#39;STEPBL_&#39;</span> <span class="o">+</span> <span class="nx">J</span><span class="p">.</span><span class="nx">randomInt</span><span class="p">(</span><span class="mi">1000</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">beginBlock</span><span class="p">(</span><span class="nx">position</span><span class="p">,</span> <span class="nx">options</span><span class="p">);</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
    <span class="p">};</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="stager.stageblock">
  <h4>
    <a href="#stager.stageblock" class="pilcrow">&#182;</a>
    Stager.stageBlock
  </h4>
</div>

  </div>
  <div class="body"><p>Begins a new Block of stages</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">positions</span>
      <span class="dox_type">string</span>
      <span>Optional. Positions within the
  enclosing Block that this block can occupy.</span>
    </div>
    <div class="dox_tag_title">Returns</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name"></span>
      <span class="dox_type">Stager</span>
      <span>Reference to the current instance for method chainining</span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>    <span class="nx">Stager</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">stageBlock</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">positions</span><span class="p">,</span> <span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">curBlock</span><span class="p">;</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-128" id="section-128">&#182;</a>
</div>
<p>Begin stage block (closes two: steps and stage).</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">currentType</span> <span class="o">!==</span> <span class="nx">BLOCK_DEFAULT</span><span class="p">)</span> <span class="k">this</span><span class="p">.</span><span class="nx">endBlocks</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">currentType</span> <span class="o">=</span> <span class="nx">BLOCK_DEFAULT</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">currentBlockType</span> <span class="o">=</span> <span class="nx">BLOCK_STAGE</span><span class="p">;</span>

        <span class="nx">options</span> <span class="o">=</span> <span class="nx">options</span> <span class="o">||</span> <span class="p">{};</span>
        <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;undefined&#39;</span> <span class="o">===</span> <span class="k">typeof</span> <span class="nx">options</span><span class="p">.</span><span class="nx">id</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">options</span><span class="p">.</span><span class="nx">id</span> <span class="o">=</span> <span class="s1">&#39;AAA_&#39;</span> <span class="o">+</span> <span class="nx">J</span><span class="p">.</span><span class="nx">randomInt</span><span class="p">(</span><span class="mi">1000</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">this</span><span class="p">.</span><span class="nx">beginBlock</span><span class="p">(</span><span class="nx">positions</span><span class="p">,</span> <span class="nx">options</span><span class="p">);</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
    <span class="p">};</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="stager.nextblock">
  <h4>
    <a href="#stager.nextblock" class="pilcrow">&#182;</a>
    Stager.nextBlock
  </h4>
</div>

  </div>
  <div class="body"><p>Ends current Block and begins a new one of the same type</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">positions</span>
      <span class="dox_type">string</span>
      <span>Optional. Positions within the
  enclosing Block that this block can occupy.</span>
    </div>
    <div class="dox_tag_title">Returns</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name"></span>
      <span class="dox_type">Stager</span>
      <span>Reference to the current instance for method chainining</span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>    <span class="nx">Stager</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">nextBlock</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">positions</span><span class="p">,</span> <span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">endBlock</span><span class="p">();</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">currentBlockType</span> <span class="o">===</span> <span class="nx">BLOCK_STAGE</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">stageBlock</span><span class="p">(</span><span class="nx">positions</span><span class="p">,</span> <span class="nx">options</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">currentBlockType</span> <span class="o">===</span> <span class="nx">BLOCK_STEP</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">stepBlock</span><span class="p">(</span><span class="nx">positions</span><span class="p">,</span> <span class="nx">options</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
    <span class="p">};</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="stager.getcurrentblock">
  <h4>
    <a href="#stager.getcurrentblock" class="pilcrow">&#182;</a>
    Stager.getCurrentBlock
  </h4>
</div>

  </div>
  <div class="body"><p>Returns the Block that Stager is currently working on</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">positions</span>
      <span class="dox_type">string</span>
      <span>Optional. Positions within the
     enclosing Block that this block can occupy.</span>
    </div>
    <div class="dox_tag_title">Returns</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name"></span>
      <span class="dox_type">object</span>
      <span class="dox_type">boolean</span>
      <span>Currently open block, or FALSE if no
  unfinished block is found</span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>    <span class="nx">Stager</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">getCurrentBlock</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">unfinishedBlocks</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">unfinishedBlocks</span><span class="p">[</span><span class="k">this</span><span class="p">.</span><span class="nx">unfinishedBlocks</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span><span class="mi">1</span><span class="p">];</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
    <span class="p">};</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="extract-info">
  <h3>
    <a href="#extract-info" class="pilcrow">&#182;</a>
    Extract Info
  </h3>
</div>

        </td>
        <td class="code highlight"><div class="highlight"><pre></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="stager.getsequence">
  <h4>
    <a href="#stager.getsequence" class="pilcrow">&#182;</a>
    Stager.getSequence
  </h4>
</div>

  </div>
  <div class="body"><p>Returns the sequence of stages</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">format</span>
      <span class="dox_type">string</span>
      <span>'hstages' for an array of human-readable
  stage descriptions, 'hsteps' for an array of human-readable
  step descriptions, 'o' for the internal JavaScript object</span>
    </div>
    <div class="dox_tag_title">Returns</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name"></span>
      <span class="dox_type">array</span>
      <span class="dox_type">object</span>
      <span class="dox_type">null</span>
      <span>The stage sequence in requested
  format. NULL on error.</span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>    <span class="nx">Stager</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">getSequence</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">format</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">result</span><span class="p">;</span>
        <span class="kd">var</span> <span class="nx">seqIdx</span><span class="p">;</span>
        <span class="kd">var</span> <span class="nx">seqObj</span><span class="p">;</span>
        <span class="kd">var</span> <span class="nx">stepPrefix</span><span class="p">;</span>

        <span class="k">switch</span> <span class="p">(</span><span class="nx">format</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">case</span> <span class="s1">&#39;hstages&#39;</span><span class="o">:</span>
            <span class="nx">result</span> <span class="o">=</span> <span class="p">[];</span>

            <span class="k">for</span> <span class="p">(</span><span class="nx">seqIdx</span> <span class="k">in</span> <span class="k">this</span><span class="p">.</span><span class="nx">sequence</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">sequence</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">seqIdx</span><span class="p">))</span> <span class="p">{</span>
                    <span class="nx">seqObj</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">sequence</span><span class="p">[</span><span class="nx">seqIdx</span><span class="p">];</span>

                    <span class="k">switch</span> <span class="p">(</span><span class="nx">seqObj</span><span class="p">.</span><span class="nx">type</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">case</span> <span class="s1">&#39;gameover&#39;</span><span class="o">:</span>
                        <span class="nx">result</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="s1">&#39;[game over]&#39;</span><span class="p">);</span>
                        <span class="k">break</span><span class="p">;</span>

                    <span class="k">case</span> <span class="s1">&#39;plain&#39;</span><span class="o">:</span>
                        <span class="nx">result</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">seqObj</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>
                        <span class="k">break</span><span class="p">;</span>

                    <span class="k">case</span> <span class="s1">&#39;repeat&#39;</span><span class="o">:</span>
                        <span class="nx">result</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">seqObj</span><span class="p">.</span><span class="nx">id</span> <span class="o">+</span> <span class="s1">&#39; [x&#39;</span> <span class="o">+</span> <span class="nx">seqObj</span><span class="p">.</span><span class="nx">num</span> <span class="o">+</span>
                            <span class="s1">&#39;]&#39;</span><span class="p">);</span>
                        <span class="k">break</span><span class="p">;</span>

                    <span class="k">case</span> <span class="s1">&#39;loop&#39;</span><span class="o">:</span>
                        <span class="nx">result</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">seqObj</span><span class="p">.</span><span class="nx">id</span> <span class="o">+</span> <span class="s1">&#39; [loop]&#39;</span><span class="p">);</span>
                        <span class="k">break</span><span class="p">;</span>

                    <span class="k">case</span> <span class="s1">&#39;doLoop&#39;</span><span class="o">:</span>
                        <span class="nx">result</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">seqObj</span><span class="p">.</span><span class="nx">id</span> <span class="o">+</span> <span class="s1">&#39; [doLoop]&#39;</span><span class="p">);</span>
                        <span class="k">break</span><span class="p">;</span>

                    <span class="k">default</span><span class="o">:</span>
                        <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">&#39;Stager.getSequence: unknown&#39;</span> <span class="o">+</span>
                                        <span class="s1">&#39;sequence object type.&#39;</span><span class="p">);</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">}</span>
            <span class="k">break</span><span class="p">;</span>

        <span class="k">case</span> <span class="s1">&#39;hsteps&#39;</span><span class="o">:</span>
            <span class="nx">result</span> <span class="o">=</span> <span class="p">[];</span>

            <span class="k">for</span> <span class="p">(</span><span class="nx">seqIdx</span> <span class="k">in</span> <span class="k">this</span><span class="p">.</span><span class="nx">sequence</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">sequence</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">seqIdx</span><span class="p">))</span> <span class="p">{</span>
                    <span class="nx">seqObj</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">sequence</span><span class="p">[</span><span class="nx">seqIdx</span><span class="p">];</span>
                    <span class="nx">stepPrefix</span> <span class="o">=</span> <span class="nx">seqObj</span><span class="p">.</span><span class="nx">id</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span><span class="p">;</span>

                    <span class="k">switch</span> <span class="p">(</span><span class="nx">seqObj</span><span class="p">.</span><span class="nx">type</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">case</span> <span class="s1">&#39;gameover&#39;</span><span class="o">:</span>
                        <span class="nx">result</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="s1">&#39;[game over]&#39;</span><span class="p">);</span>
                        <span class="k">break</span><span class="p">;</span>

                    <span class="k">case</span> <span class="s1">&#39;plain&#39;</span><span class="o">:</span>
                        <span class="nx">seqObj</span><span class="p">.</span><span class="nx">steps</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span>
                            <span class="kd">function</span><span class="p">(</span><span class="nx">stepID</span><span class="p">)</span> <span class="p">{</span>
                                <span class="nx">result</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">stepPrefix</span> <span class="o">+</span> <span class="nx">stepID</span><span class="p">);</span>
                            <span class="p">}</span>
                        <span class="p">);</span>
                        <span class="k">break</span><span class="p">;</span>

                    <span class="k">case</span> <span class="s1">&#39;repeat&#39;</span><span class="o">:</span>
                        <span class="nx">seqObj</span><span class="p">.</span><span class="nx">steps</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span>
                            <span class="kd">function</span><span class="p">(</span><span class="nx">stepID</span><span class="p">)</span> <span class="p">{</span>
                                <span class="nx">result</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">stepPrefix</span> <span class="o">+</span> <span class="nx">stepID</span> <span class="o">+</span>
                                    <span class="s1">&#39; [x&#39;</span> <span class="o">+</span> <span class="nx">seqObj</span><span class="p">.</span><span class="nx">num</span> <span class="o">+</span> <span class="s1">&#39;]&#39;</span><span class="p">);</span>
                            <span class="p">}</span>
                        <span class="p">);</span>
                        <span class="k">break</span><span class="p">;</span>

                    <span class="k">case</span> <span class="s1">&#39;loop&#39;</span><span class="o">:</span>
                        <span class="nx">seqObj</span><span class="p">.</span><span class="nx">steps</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span>
                            <span class="kd">function</span><span class="p">(</span><span class="nx">stepID</span><span class="p">)</span> <span class="p">{</span>
                                <span class="nx">result</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">stepPrefix</span> <span class="o">+</span>
                                            <span class="nx">stepID</span> <span class="o">+</span> <span class="s1">&#39; [loop]&#39;</span><span class="p">);</span>
                            <span class="p">}</span>
                        <span class="p">);</span>
                        <span class="k">break</span><span class="p">;</span>

                    <span class="k">case</span> <span class="s1">&#39;doLoop&#39;</span><span class="o">:</span>
                        <span class="nx">seqObj</span><span class="p">.</span><span class="nx">steps</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span>
                            <span class="kd">function</span><span class="p">(</span><span class="nx">stepID</span><span class="p">)</span> <span class="p">{</span>
                                <span class="nx">result</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">stepPrefix</span> <span class="o">+</span>
                                            <span class="nx">stepID</span> <span class="o">+</span> <span class="s1">&#39; [doLoop]&#39;</span><span class="p">);</span>
                            <span class="p">}</span>
                        <span class="p">);</span>
                        <span class="k">break</span><span class="p">;</span>

                    <span class="k">default</span><span class="o">:</span>
                        <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">&#39;Stager.getSequence: unknown&#39;</span> <span class="o">+</span>
                                        <span class="s1">&#39;sequence object type.&#39;</span><span class="p">);</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">}</span>
            <span class="k">break</span><span class="p">;</span>

        <span class="k">case</span> <span class="s1">&#39;o&#39;</span><span class="o">:</span>
            <span class="nx">result</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">sequence</span><span class="p">;</span>
            <span class="k">break</span><span class="p">;</span>

        <span class="k">default</span><span class="o">:</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">&#39;Stager.getSequence: invalid format.&#39;</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nx">result</span><span class="p">;</span>
    <span class="p">};</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="stager.extractstage">
  <h4>
    <a href="#stager.extractstage" class="pilcrow">&#182;</a>
    Stager.extractStage
  </h4>
</div>

  </div>
  <div class="body"><p>Returns a minimal state package containing one or more stages</p>

<p>The returned package consists of a <code>setState</code>-compatible object
with the <code>steps</code> and <code>stages</code> properties set to include the given
stages.
The <code>sequence</code> is optionally set to a single <code>next</code> block for the
stage.</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">ids</span>
      <span class="dox_type">string</span>
      <span class="dox_type">array</span>
      <span>Valid stage name(s)</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">useSeq</span>
      <span class="dox_type">boolean</span>
      <span>Optional. Whether to generate a singleton
  sequence.  TRUE by default.</span>
    </div>
    <div class="dox_tag_title">Returns</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name"></span>
      <span class="dox_type">object</span>
      <span class="dox_type">null</span>
      <span>The state object on success, NULL on error</span>
    </div>
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">Stager.setState
  </span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>    <span class="nx">Stager</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">extractStage</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">ids</span><span class="p">,</span> <span class="nx">useSeq</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">result</span><span class="p">;</span>
        <span class="kd">var</span> <span class="nx">stepIdx</span><span class="p">,</span> <span class="nx">stepId</span><span class="p">;</span>
        <span class="kd">var</span> <span class="nx">stageId</span><span class="p">;</span>
        <span class="kd">var</span> <span class="nx">stageObj</span><span class="p">;</span>
        <span class="kd">var</span> <span class="nx">idArray</span><span class="p">,</span> <span class="nx">idIdx</span><span class="p">,</span> <span class="nx">id</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">ids</span> <span class="k">instanceof</span> <span class="nb">Array</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">idArray</span> <span class="o">=</span> <span class="nx">ids</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;string&#39;</span> <span class="o">===</span> <span class="k">typeof</span> <span class="nx">ids</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">idArray</span> <span class="o">=</span> <span class="p">[</span> <span class="nx">ids</span> <span class="p">];</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>

        <span class="nx">result</span> <span class="o">=</span> <span class="p">{</span> <span class="nx">steps</span><span class="o">:</span> <span class="p">{},</span> <span class="nx">stages</span><span class="o">:</span> <span class="p">{},</span> <span class="nx">sequence</span><span class="o">:</span> <span class="p">[]</span> <span class="p">};</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-134" id="section-134">&#182;</a>
</div>
<p>undefined (default) -> true</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>        <span class="nx">useSeq</span> <span class="o">=</span> <span class="p">(</span><span class="nx">useSeq</span> <span class="o">===</span> <span class="kc">false</span><span class="p">)</span> <span class="o">?</span> <span class="kc">false</span> <span class="o">:</span> <span class="kc">true</span><span class="p">;</span>

        <span class="k">for</span> <span class="p">(</span><span class="nx">idIdx</span> <span class="k">in</span> <span class="nx">idArray</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">idArray</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">idIdx</span><span class="p">))</span> <span class="p">{</span>
                <span class="nx">id</span> <span class="o">=</span> <span class="nx">idArray</span><span class="p">[</span><span class="nx">idIdx</span><span class="p">];</span>

                <span class="nx">stageObj</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">stages</span><span class="p">[</span><span class="nx">id</span><span class="p">];</span>

                <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">stageObj</span><span class="p">)</span> <span class="k">return</span> <span class="kc">null</span><span class="p">;</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-135" id="section-135">&#182;</a>
</div>
<p>Add step objects:</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>                <span class="k">for</span> <span class="p">(</span><span class="nx">stepIdx</span> <span class="k">in</span> <span class="nx">stageObj</span><span class="p">.</span><span class="nx">steps</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nx">stageObj</span><span class="p">.</span><span class="nx">steps</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">stepIdx</span><span class="p">))</span> <span class="p">{</span>
                        <span class="nx">stepId</span> <span class="o">=</span> <span class="nx">stageObj</span><span class="p">.</span><span class="nx">steps</span><span class="p">[</span><span class="nx">stepIdx</span><span class="p">];</span>
                        <span class="nx">result</span><span class="p">.</span><span class="nx">steps</span><span class="p">[</span><span class="nx">stepId</span><span class="p">]</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">steps</span><span class="p">[</span><span class="nx">stepId</span><span class="p">];</span>
                    <span class="p">}</span>
                <span class="p">}</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-136" id="section-136">&#182;</a>
</div>
<p>Add stage object:</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>                <span class="nx">stageId</span> <span class="o">=</span> <span class="nx">stageObj</span><span class="p">.</span><span class="nx">id</span><span class="p">;</span>
                <span class="nx">result</span><span class="p">.</span><span class="nx">stages</span><span class="p">[</span><span class="nx">stageId</span><span class="p">]</span> <span class="o">=</span> <span class="nx">stageObj</span><span class="p">;</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-137" id="section-137">&#182;</a>
</div>
<p>If given id is alias, also add alias:</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>                <span class="k">if</span> <span class="p">(</span><span class="nx">stageId</span> <span class="o">!==</span> <span class="nx">id</span><span class="p">)</span> <span class="nx">result</span><span class="p">.</span><span class="nx">stages</span><span class="p">[</span><span class="nx">id</span><span class="p">]</span> <span class="o">=</span> <span class="nx">stageObj</span><span class="p">;</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-138" id="section-138">&#182;</a>
</div>
<p>Add mini-sequence:</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>                <span class="k">if</span> <span class="p">(</span><span class="nx">useSeq</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">result</span><span class="p">.</span><span class="nx">sequence</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span>
                        <span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;plain&#39;</span><span class="p">,</span>
                        <span class="nx">id</span><span class="o">:</span> <span class="nx">stageId</span>
                    <span class="p">});</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nx">result</span><span class="p">;</span>
    <span class="p">};</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="flexible-mode">
  <h3>
    <a href="#flexible-mode" class="pilcrow">&#182;</a>
    Flexible Mode
  </h3>
</div>

        </td>
        <td class="code highlight"><div class="highlight"><pre></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="stager.registergeneralnext">
  <h4>
    <a href="#stager.registergeneralnext" class="pilcrow">&#182;</a>
    Stager.registerGeneralNext
  </h4>
</div>

  </div>
  <div class="body"><p>Sets general callback for next stage decision</p>

<p>Available only when nodegame is executed in <em>flexible</em> mode.
The callback given here is used to determine the next stage.</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">func</span>
      <span class="dox_type">function</span>
      <span class="dox_type">null</span>
      <span>The decider callback. It should
  return the name of the next stage, 'NODEGAME_GAMEOVER' to end
  the game or FALSE for sequence end. NULL can be given to
  signify non-existence.</span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>    <span class="nx">Stager</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">registerGeneralNext</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">func</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">func</span> <span class="o">!==</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="s1">&#39;function&#39;</span> <span class="o">!==</span> <span class="k">typeof</span> <span class="nx">func</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nx">TypeError</span><span class="p">(</span><span class="s1">&#39;Stager.registerGeneralNext: &#39;</span> <span class="o">+</span>
                                <span class="s1">&#39;func must be function or undefined.&#39;</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">generalNextFunction</span> <span class="o">=</span> <span class="nx">func</span><span class="p">;</span>
    <span class="p">};</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="stager.registernext">
  <h4>
    <a href="#stager.registernext" class="pilcrow">&#182;</a>
    Stager.registerNext
  </h4>
</div>

  </div>
  <div class="body"><p>Registers a step-decider callback for a specific stage</p>

<p>The function overrides the general callback for the specific
stage, and determines the next stage.
Available only when nodegame is executed in <em>flexible</em> mode.</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">id</span>
      <span class="dox_type">string</span>
      <span>The name of the stage after which the decider
  function will be called</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">func</span>
      <span class="dox_type">function</span>
      <span>The decider callback. It should return the
  name of the next stage, 'NODEGAME_GAMEOVER' to end the game or
  FALSE for sequence end.</span>
    </div>
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">Stager.registerGeneralNext
  </span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>    <span class="nx">Stager</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">registerNext</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">id</span><span class="p">,</span> <span class="nx">func</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;function&#39;</span> <span class="o">!==</span> <span class="k">typeof</span> <span class="nx">func</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nx">TypeError</span><span class="p">(</span><span class="s1">&#39;Stager.registerNext: func must be &#39;</span> <span class="o">+</span>
                <span class="s1">&#39;function.&#39;</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">stages</span><span class="p">[</span><span class="nx">id</span><span class="p">])</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nx">TypeError</span><span class="p">(</span><span class="s1">&#39;Stager.registerNext: non existent &#39;</span> <span class="o">+</span>
                               <span class="s1">&#39;stage id: &#39;</span> <span class="o">+</span> <span class="nx">id</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">this</span><span class="p">.</span><span class="nx">nextFunctions</span><span class="p">[</span><span class="nx">id</span><span class="p">]</span> <span class="o">=</span> <span class="nx">func</span><span class="p">;</span>
    <span class="p">};</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="private-methods">
  <h2>
    <a href="#private-methods" class="pilcrow">&#182;</a>
    Private Methods
  </h2>
</div>

        </td>
        <td class="code highlight"><div class="highlight"><pre></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="handlestepsarray">
  <h4>
    <a href="#handlestepsarray" class="pilcrow">&#182;</a>
    handleStepsArray
  </h4>
</div>

  </div>
  <div class="body"><p>Validates the items of a steps array, creates new steps if necessary</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">that</span>
      <span class="dox_type">Stager</span>
      <span>Stager object</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">stageId</span>
      <span class="dox_type">string</span>
      <span>The original stage id</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">steps</span>
      <span class="dox_type">array</span>
      <span>The array of steps to validate</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">method</span>
      <span class="dox_type">string</span>
      <span>The name of the method invoking the method</span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>    <span class="kd">function</span> <span class="nx">handleStepsArray</span><span class="p">(</span><span class="nx">that</span><span class="p">,</span> <span class="nx">stageId</span><span class="p">,</span> <span class="nx">steps</span><span class="p">,</span> <span class="nx">method</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">len</span><span class="p">;</span>
        <span class="nx">i</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="nx">len</span> <span class="o">=</span> <span class="nx">steps</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-144" id="section-144">&#182;</a>
</div>
<p>Missing steps are added with default callback (if string),
or as they are if object.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>        <span class="k">for</span> <span class="p">(</span> <span class="p">;</span> <span class="o">++</span><span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">len</span> <span class="p">;</span> <span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;object&#39;</span> <span class="o">===</span> <span class="k">typeof</span> <span class="nx">steps</span><span class="p">[</span><span class="nx">i</span><span class="p">])</span> <span class="p">{</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-145" id="section-145">&#182;</a>
</div>
<p>Throw error if step.id is not unique.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>                <span class="nx">that</span><span class="p">.</span><span class="nx">addStep</span><span class="p">(</span><span class="nx">steps</span><span class="p">[</span><span class="nx">i</span><span class="p">]);</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-146" id="section-146">&#182;</a>
</div>
<p>Substitute with its id.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>                <span class="nx">steps</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="nx">steps</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">id</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;string&#39;</span> <span class="o">===</span> <span class="k">typeof</span> <span class="nx">steps</span><span class="p">[</span><span class="nx">i</span><span class="p">])</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">that</span><span class="p">.</span><span class="nx">steps</span><span class="p">[</span><span class="nx">steps</span><span class="p">[</span><span class="nx">i</span><span class="p">]])</span> <span class="p">{</span>
                    <span class="nx">that</span><span class="p">.</span><span class="nx">addStep</span><span class="p">({</span>
                        <span class="nx">id</span><span class="o">:</span> <span class="nx">steps</span><span class="p">[</span><span class="nx">i</span><span class="p">],</span>
                        <span class="nx">cb</span><span class="o">:</span> <span class="nx">that</span><span class="p">.</span><span class="nx">getDefaultCallback</span><span class="p">()</span>
                    <span class="p">});</span>
                <span class="p">}</span>
            <span class="p">}</span>
            <span class="k">else</span> <span class="p">{</span>
                <span class="k">throw</span> <span class="k">new</span> <span class="nx">TypeError</span><span class="p">(</span><span class="s1">&#39;Stager.&#39;</span> <span class="o">+</span> <span class="nx">method</span> <span class="o">+</span> <span class="s1">&#39;: stage &#39;</span> <span class="o">+</span>
                                    <span class="nx">stageId</span>  <span class="o">+</span> <span class="s1">&#39;: items of the steps array &#39;</span> <span class="o">+</span>
                                    <span class="s1">&#39;must be string or object.&#39;</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="addloop">
  <h4>
    <a href="#addloop" class="pilcrow">&#182;</a>
    addLoop
  </h4>
</div>

  </div>
  <div class="body"><p>Handles adding a looped stage (doLoop or loop)</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">that</span>
      <span class="dox_type">object</span>
      <span>Reference to Stager object</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">type</span>
      <span class="dox_type">string</span>
      <span>The type of loop (doLoop or loop)</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">stage</span>
      <span class="dox_type">string</span>
      <span class="dox_type">object</span>
      <span>The stage to loop</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">loopFunc</span>
      <span class="dox_type">function</span>
      <span>The function checking the</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">positions</span>
      <span class="dox_type">string</span>
      <span>Optional. Positions within the
     enclosing Block that this block can occupy.</span>
    </div>
    <div class="dox_tag_title">Returns</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name"></span>
      <span class="dox_type">Stager</span>
      <span class="dox_type">null</span>
      <span>this object on success, NULL on error</span>
    </div>
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">Stager.loop</span>
    </div>
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">Stager.doLoop
</span>
    </div>
    <div class="dox_tag_title">API</div>
    <div class="dox_tag_detail">
      <span class="dox_type">private
</span>
    </span>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>    <span class="kd">function</span> <span class="nx">addLoop</span><span class="p">(</span><span class="nx">that</span><span class="p">,</span> <span class="nx">type</span><span class="p">,</span> <span class="nx">stage</span><span class="p">,</span> <span class="nx">loopFunc</span><span class="p">,</span> <span class="nx">positions</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">stageName</span><span class="p">;</span>

        <span class="nx">checkFinalized</span><span class="p">(</span><span class="nx">that</span><span class="p">,</span> <span class="nx">type</span><span class="p">);</span>

        <span class="nx">stageName</span> <span class="o">=</span> <span class="nx">handleStageParameter</span><span class="p">(</span><span class="nx">that</span><span class="p">,</span> <span class="nx">stage</span><span class="p">,</span> <span class="nx">type</span><span class="p">);</span>

        <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;function&#39;</span> <span class="o">!==</span> <span class="k">typeof</span> <span class="nx">loopFunc</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nx">TypeError</span><span class="p">(</span><span class="s1">&#39;Stager.&#39;</span> <span class="o">+</span> <span class="nx">type</span> <span class="o">+</span> <span class="s1">&#39;: loopFunc must be &#39;</span> <span class="o">+</span>
                                <span class="s1">&#39;function. Found: &#39;</span> <span class="o">+</span> <span class="nx">loopFunc</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="nx">positions</span> <span class="o">=</span> <span class="nx">checkPositionsParameter</span><span class="p">(</span><span class="nx">positions</span><span class="p">,</span> <span class="nx">type</span><span class="p">);</span>

        <span class="nx">addStageToCurrentBlock</span><span class="p">(</span><span class="nx">that</span><span class="p">,</span> <span class="p">{</span>
            <span class="nx">type</span><span class="o">:</span> <span class="nx">type</span><span class="p">,</span>
            <span class="nx">id</span><span class="o">:</span> <span class="nx">stageName</span><span class="p">,</span>
            <span class="nx">cb</span><span class="o">:</span> <span class="nx">loopFunc</span>
        <span class="p">},</span> <span class="nx">positions</span><span class="p">);</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-148" id="section-148">&#182;</a>
</div>
<p>Must be done after addStageToCurrentBlock is called.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>        <span class="nx">addStepsToCurrentBlock</span><span class="p">(</span><span class="nx">that</span><span class="p">,</span> <span class="nx">that</span><span class="p">.</span><span class="nx">stages</span><span class="p">[</span><span class="nx">stageName</span><span class="p">]);</span>
        <span class="k">return</span> <span class="nx">that</span><span class="p">;</span>
    <span class="p">}</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="addstepstocurrentblock">
  <h4>
    <a href="#addstepstocurrentblock" class="pilcrow">&#182;</a>
    addStepsToCurrentBlock
  </h4>
</div>

  </div>
  <div class="body"><p>Adds steps to current block</p>

<p>For each step inside stage.step, it checks whether the step was
already added to current block, and if not, it adds it.</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">that</span>
      <span class="dox_type">object</span>
      <span>Reference to Stager object</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">stage</span>
      <span class="dox_type">object</span>
      <span>The stage object</span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>    <span class="kd">function</span> <span class="nx">addStepsToCurrentBlock</span><span class="p">(</span><span class="nx">that</span><span class="p">,</span> <span class="nx">stage</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">curBlock</span><span class="p">;</span>
        <span class="kd">var</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">len</span><span class="p">,</span> <span class="nx">stepInBlock</span><span class="p">;</span>
        <span class="nx">curBlock</span> <span class="o">=</span> <span class="nx">that</span><span class="p">.</span><span class="nx">getCurrentBlock</span><span class="p">();</span>

        <span class="nx">i</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="nx">len</span> <span class="o">=</span> <span class="nx">stage</span><span class="p">.</span><span class="nx">steps</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
        <span class="k">for</span> <span class="p">(</span> <span class="p">;</span> <span class="o">++</span><span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">len</span> <span class="p">;</span> <span class="p">)</span> <span class="p">{</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-150" id="section-150">&#182;</a>
</div>
<p>Add step, if not already added.
TODO: This If might be always true.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">curBlock</span><span class="p">.</span><span class="nx">hasItem</span><span class="p">(</span><span class="nx">stage</span><span class="p">.</span><span class="nx">steps</span><span class="p">[</span><span class="nx">i</span><span class="p">]))</span> <span class="p">{</span>
                <span class="nx">stepInBlock</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="nx">type</span><span class="o">:</span> <span class="nx">that</span><span class="p">.</span><span class="nx">currentType</span><span class="p">,</span>
                    <span class="nx">item</span><span class="o">:</span> <span class="nx">stage</span><span class="p">.</span><span class="nx">steps</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span>
                <span class="p">};</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">that</span><span class="p">.</span><span class="nx">steps</span><span class="p">[</span><span class="nx">stage</span><span class="p">.</span><span class="nx">steps</span><span class="p">[</span><span class="nx">i</span><span class="p">]].</span><span class="nx">_defaultStep</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">stepInBlock</span><span class="p">.</span><span class="nx">_defaultStep</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
                <span class="p">}</span>
                <span class="nx">curBlock</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">stepInBlock</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="extractalias">
  <h4>
    <a href="#extractalias" class="pilcrow">&#182;</a>
    extractAlias
  </h4>
</div>

  </div>
  <div class="body"><p>Returns an object where alias and id are separated</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">nameAndAlias</span>
      <span class="dox_type">string</span>
      <span>The stage-name string</span>
    </div>
    <div class="dox_tag_title">Returns</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name"></span>
      <span class="dox_type">object</span>
      <span>Object with properties id and alias (if found)</span>
    </div>
    <div class="dox_tag_title">API</div>
    <div class="dox_tag_detail">
      <span class="dox_type">private
</span>
    </span>
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">handleAlias
  </span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>    <span class="kd">function</span> <span class="nx">extractAlias</span><span class="p">(</span><span class="nx">nameAndAlias</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">tokens</span><span class="p">;</span>
        <span class="nx">tokens</span> <span class="o">=</span> <span class="nx">nameAndAlias</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39; AS &#39;</span><span class="p">);</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="nx">id</span><span class="o">:</span> <span class="nx">tokens</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">trim</span><span class="p">(),</span>
            <span class="nx">alias</span><span class="o">:</span> <span class="nx">tokens</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">?</span> <span class="nx">tokens</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="nx">trim</span><span class="p">()</span> <span class="o">:</span> <span class="kc">undefined</span>
        <span class="p">};</span>
    <span class="p">}</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="handlealias">
  <h4>
    <a href="#handlealias" class="pilcrow">&#182;</a>
    handleAlias
  </h4>
</div>

  </div>
  <div class="body"><p>Handles stage id and alias strings</p>

<p>Takes a string like 'stageID' or 'stageID AS alias' and return 'alias'.
Checks that alias and stage id are different.</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">that</span>
      <span class="dox_type">object</span>
      <span>Reference to Stager object</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">nameAndAlias</span>
      <span class="dox_type">string</span>
      <span>The stage-name string</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">method</span>
      <span class="dox_type">string</span>
      <span>The name of the method calling the validation</span>
    </div>
    <div class="dox_tag_title">Returns</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name"></span>
      <span class="dox_type">object</span>
      <span>Object with properties id and alias (if found)</span>
    </div>
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">Stager.next</span>
    </div>
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">handleAlias
</span>
    </div>
    <div class="dox_tag_title">API</div>
    <div class="dox_tag_detail">
      <span class="dox_type">private
</span>
    </span>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>    <span class="kd">function</span> <span class="nx">handleAlias</span><span class="p">(</span><span class="nx">that</span><span class="p">,</span> <span class="nx">nameAndAlias</span><span class="p">,</span> <span class="nx">method</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">tokens</span><span class="p">,</span> <span class="nx">id</span><span class="p">,</span> <span class="nx">alias</span><span class="p">;</span>
        <span class="nx">tokens</span> <span class="o">=</span> <span class="nx">extractAlias</span><span class="p">(</span><span class="nx">nameAndAlias</span><span class="p">);</span>
        <span class="nx">id</span> <span class="o">=</span> <span class="nx">tokens</span><span class="p">.</span><span class="nx">id</span><span class="p">;</span>
        <span class="nx">alias</span> <span class="o">=</span> <span class="nx">tokens</span><span class="p">.</span><span class="nx">alias</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">id</span> <span class="o">===</span> <span class="nx">alias</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">&#39;Stager.&#39;</span> <span class="o">+</span> <span class="nx">method</span> <span class="o">+</span> <span class="s1">&#39;: id equal to alias: &#39;</span> <span class="o">+</span>
                            <span class="nx">nameAndAlias</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">alias</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">that</span><span class="p">.</span><span class="nx">stages</span><span class="p">[</span><span class="nx">id</span><span class="p">])</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">&#39;Stager.&#39;</span> <span class="o">+</span> <span class="nx">method</span> <span class="o">+</span> <span class="s1">&#39;: alias is referencing &#39;</span> <span class="o">+</span>
                            <span class="s1">&#39;non-existing stage: &#39;</span> <span class="o">+</span> <span class="nx">id</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">alias</span> <span class="o">&amp;&amp;</span> <span class="nx">that</span><span class="p">.</span><span class="nx">stages</span><span class="p">[</span><span class="nx">alias</span><span class="p">])</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">&#39;Stager.&#39;</span> <span class="o">+</span> <span class="nx">method</span> <span class="o">+</span> <span class="s1">&#39;: alias is not unique: &#39;</span> <span class="o">+</span>
                            <span class="nx">alias</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="nx">tokens</span><span class="p">;</span>
    <span class="p">}</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="checkfinalized">
  <h4>
    <a href="#checkfinalized" class="pilcrow">&#182;</a>
    checkFinalized
  </h4>
</div>

  </div>
  <div class="body"><p>Check whether the stager is already finalized, and throws an error if so</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">that</span>
      <span class="dox_type">object</span>
      <span>Reference to Stager object</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">method</span>
      <span class="dox_type">string</span>
      <span>The name of the method calling the validation</span>
    </div>
    <div class="dox_tag_title">API</div>
    <div class="dox_tag_detail">
      <span class="dox_type">private
</span>
    </span>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>    <span class="kd">function</span> <span class="nx">checkFinalized</span><span class="p">(</span><span class="nx">that</span><span class="p">,</span> <span class="nx">method</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">that</span><span class="p">.</span><span class="nx">finalized</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">&#39;Stager.&#39;</span> <span class="o">+</span> <span class="nx">method</span> <span class="o">+</span> <span class="s1">&#39;: stager has been &#39;</span> <span class="o">+</span>
                            <span class="s1">&#39;already finalized.&#39;</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="checkstepvalidity">
  <h4>
    <a href="#checkstepvalidity" class="pilcrow">&#182;</a>
    checkStepValidity
  </h4>
</div>

  </div>
  <div class="body"><p>Returns whether given step is valid</p>

<p>Checks for syntactic validity of the step object. Does not validate
whether the name is unique, etc.</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">step</span>
      <span class="dox_type">object</span>
      <span>The step object</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">method</span>
      <span class="dox_type">string</span>
      <span>The name of the method calling the validation</span>
    </div>
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">Stager.addStep
</span>
    </div>
    <div class="dox_tag_title">API</div>
    <div class="dox_tag_detail">
      <span class="dox_type">private
</span>
    </span>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>    <span class="kd">function</span> <span class="nx">checkStepValidity</span><span class="p">(</span><span class="nx">step</span><span class="p">,</span> <span class="nx">method</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;object&#39;</span> <span class="o">!==</span> <span class="k">typeof</span> <span class="nx">step</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nx">TypeError</span><span class="p">(</span><span class="s1">&#39;Stager.&#39;</span> <span class="o">+</span> <span class="nx">method</span> <span class="o">+</span> <span class="s1">&#39;: step must be object.&#39;</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;function&#39;</span> <span class="o">!==</span> <span class="k">typeof</span> <span class="nx">step</span><span class="p">.</span><span class="nx">cb</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nx">TypeError</span><span class="p">(</span><span class="s1">&#39;Stager.&#39;</span> <span class="o">+</span> <span class="nx">method</span> <span class="o">+</span> <span class="s1">&#39;: step.cb must be &#39;</span> <span class="o">+</span>
                                <span class="s1">&#39;function.&#39;</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;string&#39;</span> <span class="o">!==</span> <span class="k">typeof</span> <span class="nx">step</span><span class="p">.</span><span class="nx">id</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nx">TypeError</span><span class="p">(</span><span class="s1">&#39;Stager.&#39;</span> <span class="o">+</span> <span class="nx">method</span> <span class="o">+</span> <span class="s1">&#39;: step.id must &#39;</span> <span class="o">+</span>
                                <span class="s1">&#39;be string.&#39;</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">step</span><span class="p">.</span><span class="nx">id</span><span class="p">.</span><span class="nx">trim</span><span class="p">()</span> <span class="o">===</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nx">TypeError</span><span class="p">(</span><span class="s1">&#39;Stager.&#39;</span> <span class="o">+</span> <span class="nx">method</span> <span class="o">+</span> <span class="s1">&#39;: step.id cannot &#39;</span> <span class="o">+</span>
                                <span class="s1">&#39;be an empty string.&#39;</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-155" id="section-155">&#182;</a>
</div>
<div class="dox">
  <div class="summary"><p>checkStageValidity</p>
  </div>
  <div class="body"><p>Returns whether given stage is valid</p>

<p>Checks for syntactic validity of the stage object. Does not validate
whether the stage name is unique, the steps exists, etc.</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">stage</span>
      <span class="dox_type">object</span>
      <span>The stage to validate</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">method</span>
      <span class="dox_type">string</span>
      <span>The name of the method calling the validation</span>
    </div>
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">Stager.addStage
</span>
    </div>
    <div class="dox_tag_title">API</div>
    <div class="dox_tag_detail">
      <span class="dox_type">private
</span>
    </span>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>    <span class="kd">function</span> <span class="nx">checkStageValidity</span><span class="p">(</span><span class="nx">stage</span><span class="p">,</span> <span class="nx">method</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;object&#39;</span> <span class="o">!==</span> <span class="k">typeof</span> <span class="nx">stage</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nx">TypeError</span><span class="p">(</span><span class="s1">&#39;Stager.&#39;</span> <span class="o">+</span> <span class="nx">method</span> <span class="o">+</span> <span class="s1">&#39;: stage must be object.&#39;</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">((</span><span class="o">!</span><span class="nx">stage</span><span class="p">.</span><span class="nx">steps</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">stage</span><span class="p">.</span><span class="nx">cb</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="nx">stage</span><span class="p">.</span><span class="nx">steps</span> <span class="o">&amp;&amp;</span> <span class="nx">stage</span><span class="p">.</span><span class="nx">cb</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nx">TypeError</span><span class="p">(</span><span class="s1">&#39;Stager.&#39;</span> <span class="o">+</span> <span class="nx">method</span> <span class="o">+</span> <span class="s1">&#39;: stage must have &#39;</span> <span class="o">+</span>
                                <span class="s1">&#39;either a steps or a cb property.&#39;</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">J</span><span class="p">.</span><span class="nx">isArray</span><span class="p">(</span><span class="nx">stage</span><span class="p">.</span><span class="nx">steps</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">stage</span><span class="p">.</span><span class="nx">steps</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">&#39;Stager.&#39;</span> <span class="o">+</span> <span class="nx">method</span> <span class="o">+</span> <span class="s1">&#39;: stage.steps cannot &#39;</span> <span class="o">+</span>
                                <span class="s1">&#39;be empty.&#39;</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">stage</span><span class="p">.</span><span class="nx">steps</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nx">TypeError</span><span class="p">(</span><span class="s1">&#39;Stager.&#39;</span> <span class="o">+</span> <span class="nx">method</span> <span class="o">+</span> <span class="s1">&#39;: stage.steps must be &#39;</span> <span class="o">+</span>
                                <span class="s1">&#39;array or undefined.&#39;</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;string&#39;</span> <span class="o">!==</span> <span class="k">typeof</span> <span class="nx">stage</span><span class="p">.</span><span class="nx">id</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nx">TypeError</span><span class="p">(</span><span class="s1">&#39;Stager.&#39;</span> <span class="o">+</span> <span class="nx">method</span> <span class="o">+</span> <span class="s1">&#39;: stage.id must &#39;</span> <span class="o">+</span>
                                <span class="s1">&#39;be string.&#39;</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">stage</span><span class="p">.</span><span class="nx">id</span><span class="p">.</span><span class="nx">trim</span><span class="p">()</span> <span class="o">===</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nx">TypeError</span><span class="p">(</span><span class="s1">&#39;Stager.&#39;</span> <span class="o">+</span> <span class="nx">method</span> <span class="o">+</span> <span class="s1">&#39;: stage.id cannot &#39;</span> <span class="o">+</span>
                                <span class="s1">&#39;be an empty string.&#39;</span><span class="p">);</span>
        <span class="p">}</span>
     <span class="p">}</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="validateextendedstep">
  <h4>
    <a href="#validateextendedstep" class="pilcrow">&#182;</a>
    validateExtendedStep
  </h4>
</div>

  </div>
  <div class="body"><p>Validates the modification to a step (already known as object)</p>

<p>Each step inside the steps array is validated via <code>handleStepsArray</code>.</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">stepId</span>
      <span class="dox_type">string</span>
      <span>The original step id</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">update</span>
      <span class="dox_type">object</span>
      <span>The update/updated object</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">updateFunction</span>
      <span class="dox_type">boolean</span>
      <span>TRUE if the update object is the
   value returned by an update function</span>
    </div>
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">handleStepsArray
  </span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>    <span class="kd">function</span> <span class="nx">validateExtendedStep</span><span class="p">(</span><span class="nx">stepId</span><span class="p">,</span> <span class="nx">update</span><span class="p">,</span> <span class="nx">updateFunction</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">updateFunction</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">update</span> <span class="o">||</span> <span class="s1">&#39;object&#39;</span> <span class="o">!==</span> <span class="k">typeof</span> <span class="nx">update</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">throw</span> <span class="k">new</span> <span class="nx">TypeError</span><span class="p">(</span><span class="s1">&#39;Stager.extendStep: update function &#39;</span> <span class="o">+</span>
                                    <span class="s1">&#39;must return an object with id and cb: &#39;</span> <span class="o">+</span>
                                    <span class="nx">stepId</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">update</span><span class="p">.</span><span class="nx">id</span> <span class="o">!==</span> <span class="nx">stepId</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">&#39;Stager.extendStep: update function &#39;</span> <span class="o">+</span>
                                <span class="s1">&#39;cannot alter the step id: &#39;</span> <span class="o">+</span> <span class="nx">stepId</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;function&#39;</span> <span class="o">!==</span> <span class="k">typeof</span> <span class="nx">update</span><span class="p">.</span><span class="nx">cb</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">throw</span> <span class="k">new</span> <span class="nx">TypeError</span><span class="p">(</span><span class="s1">&#39;Stager.extendStep: update function &#39;</span> <span class="o">+</span>
                                    <span class="s1">&#39;must return an object with a valid &#39;</span> <span class="o">+</span>
                                    <span class="s1">&#39;callback. Step id:&#39;</span> <span class="o">+</span> <span class="nx">stepId</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="p">{</span>
             <span class="k">if</span> <span class="p">(</span><span class="nx">update</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">))</span> <span class="p">{</span>
                <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">&#39;Stager.extendStep: update.id cannot be set. &#39;</span> <span class="o">+</span>
                               <span class="s1">&#39;Step id: &#39;</span> <span class="o">+</span> <span class="nx">stepId</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;function&#39;</span> <span class="o">!==</span> <span class="k">typeof</span> <span class="nx">update</span><span class="p">.</span><span class="nx">cb</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">throw</span> <span class="k">new</span> <span class="nx">TypeError</span><span class="p">(</span><span class="s1">&#39;Stager.extendStep: update.cb must be &#39;</span> <span class="o">+</span>
                                    <span class="s1">&#39;function. Step id: &#39;</span> <span class="o">+</span> <span class="nx">stepId</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="validateextendedstage">
  <h4>
    <a href="#validateextendedstage" class="pilcrow">&#182;</a>
    validateExtendedStage
  </h4>
</div>

  </div>
  <div class="body"><p>Validates the modification to a stage (already known as object)</p>

<p>Each step inside the steps array is validated via <code>handleStepsArray</code>.</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">that</span>
      <span class="dox_type">Stager</span>
      <span>Stager object</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">stageId</span>
      <span class="dox_type">string</span>
      <span>The original stage id</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">update</span>
      <span class="dox_type">object</span>
      <span>The update/updated object</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">updateFunction</span>
      <span class="dox_type">boolean</span>
      <span>TRUE if the update object is the
   value returned by an update function</span>
    </div>
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">handleStepsArray
  </span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>    <span class="kd">function</span> <span class="nx">validateExtendedStage</span><span class="p">(</span><span class="nx">that</span><span class="p">,</span> <span class="nx">stageId</span><span class="p">,</span> <span class="nx">update</span><span class="p">,</span> <span class="nx">updateFunction</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">((</span><span class="nx">updateFunction</span> <span class="o">&amp;&amp;</span> <span class="nx">update</span><span class="p">.</span><span class="nx">id</span> <span class="o">!==</span> <span class="nx">stageId</span><span class="p">)</span> <span class="o">||</span>
            <span class="p">(</span><span class="o">!</span><span class="nx">updateFunction</span> <span class="o">&amp;&amp;</span> <span class="nx">update</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">)))</span> <span class="p">{</span>

            <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">&#39;Stager.extendStage: id cannot be altered: &#39;</span> <span class="o">+</span>
                            <span class="nx">stageId</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">update</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="s1">&#39;cb&#39;</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nx">TypeError</span><span class="p">(</span><span class="s1">&#39;Stager.extendStage: update.cb cannot be &#39;</span> <span class="o">+</span>
                                <span class="s1">&#39;specified. Stage id: &#39;</span> <span class="o">+</span> <span class="nx">stageId</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">update</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="s1">&#39;steps&#39;</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">((</span><span class="o">!</span><span class="nx">J</span><span class="p">.</span><span class="nx">isArray</span><span class="p">(</span><span class="nx">update</span><span class="p">.</span><span class="nx">steps</span><span class="p">)</span> <span class="o">||</span> <span class="o">!</span><span class="nx">update</span><span class="p">.</span><span class="nx">steps</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="o">||</span>
                <span class="nx">update</span><span class="p">.</span><span class="nx">steps</span> <span class="o">===</span> <span class="kc">undefined</span> <span class="o">||</span> <span class="nx">update</span><span class="p">.</span><span class="nx">steps</span> <span class="o">===</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>

                <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">&#39;Stager.extendStage: found update.steps, but &#39;</span> <span class="o">+</span>
                                <span class="s1">&#39;it is not a non-empty array. Stage id: &#39;</span> <span class="o">+</span>
                               <span class="nx">stageId</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span><span class="p">);</span>
            <span class="p">}</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-158" id="section-158">&#182;</a>
</div>
<p>Process every step in the array. Steps array is modified.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>            <span class="nx">handleStepsArray</span><span class="p">(</span><span class="nx">that</span><span class="p">,</span> <span class="nx">stageId</span><span class="p">,</span> <span class="nx">update</span><span class="p">.</span><span class="nx">steps</span><span class="p">,</span> <span class="s1">&#39;extendStage&#39;</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="checkstepparameter">
  <h4>
    <a href="#checkstepparameter" class="pilcrow">&#182;</a>
    checkStepParameter
  </h4>
</div>

  </div>
  <div class="body"><p>Check validity of a stage parameter, eventually adds it if missing</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">that</span>
      <span class="dox_type">Stager</span>
      <span>Stager object</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">step</span>
      <span class="dox_type">string</span>
      <span class="dox_type">object</span>
      <span>The step to validate</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">method</span>
      <span class="dox_type">string</span>
      <span>The name of the method calling the validation</span>
    </div>
    <div class="dox_tag_title">Returns</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name"></span>
      <span class="dox_type">string</span>
      <span>The id of the step</span>
    </div>
    <div class="dox_tag_title">API</div>
    <div class="dox_tag_detail">
      <span class="dox_type">private
</span>
    </span>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>    <span class="kd">function</span> <span class="nx">checkStepParameter</span><span class="p">(</span><span class="nx">that</span><span class="p">,</span> <span class="nx">step</span><span class="p">,</span> <span class="nx">method</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;string&#39;</span> <span class="o">===</span> <span class="k">typeof</span> <span class="nx">step</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">step</span> <span class="o">=</span> <span class="p">{</span>
                <span class="nx">id</span><span class="o">:</span> <span class="nx">step</span><span class="p">,</span>
                <span class="nx">cb</span><span class="o">:</span> <span class="nx">that</span><span class="p">.</span><span class="nx">getDefaultCallback</span><span class="p">()</span>
            <span class="p">};</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;object&#39;</span> <span class="o">!==</span> <span class="k">typeof</span> <span class="nx">step</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nx">TypeError</span><span class="p">(</span><span class="s1">&#39;Stager.&#39;</span> <span class="o">+</span> <span class="nx">method</span> <span class="o">+</span> <span class="s1">&#39;: step must be &#39;</span> <span class="o">+</span>
                                <span class="s1">&#39;string or object.&#39;</span><span class="p">);</span>
        <span class="p">}</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-160" id="section-160">&#182;</a>
</div>
<p>A new step is created if not found (performs validation).</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">that</span><span class="p">.</span><span class="nx">steps</span><span class="p">[</span><span class="nx">step</span><span class="p">.</span><span class="nx">id</span><span class="p">])</span> <span class="nx">that</span><span class="p">.</span><span class="nx">addStep</span><span class="p">(</span><span class="nx">step</span><span class="p">);</span>

        <span class="k">return</span> <span class="nx">step</span><span class="p">.</span><span class="nx">id</span><span class="p">;</span>
    <span class="p">}</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="handlestageparameter">
  <h4>
    <a href="#handlestageparameter" class="pilcrow">&#182;</a>
    handleStageParameter
  </h4>
</div>

  </div>
  <div class="body"><p>Check validity of a stage parameter, eventually adds it if missing</p>

<p>Called by: <code>stage</code>, <code>repeat</code>, <code>doLoop</code>, 'loop`.</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">that</span>
      <span class="dox_type">Stager</span>
      <span>Stager object</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">stage</span>
      <span class="dox_type">string</span>
      <span class="dox_type">object</span>
      <span>The stage to validate</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">method</span>
      <span class="dox_type">string</span>
      <span>The name of the method calling the validation</span>
    </div>
    <div class="dox_tag_title">Returns</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name"></span>
      <span class="dox_type">string</span>
      <span>The id or alias of the stage</span>
    </div>
    <div class="dox_tag_title">API</div>
    <div class="dox_tag_detail">
      <span class="dox_type">private
</span>
    </span>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>    <span class="kd">function</span> <span class="nx">handleStageParameter</span><span class="p">(</span><span class="nx">that</span><span class="p">,</span> <span class="nx">stage</span><span class="p">,</span> <span class="nx">method</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">tokens</span><span class="p">,</span> <span class="nx">id</span><span class="p">,</span> <span class="nx">alias</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;object&#39;</span> <span class="o">===</span> <span class="k">typeof</span> <span class="nx">stage</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">id</span> <span class="o">=</span> <span class="nx">stage</span><span class="p">.</span><span class="nx">id</span><span class="p">;</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-162" id="section-162">&#182;</a>
</div>
<p>It's a step.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>            <span class="k">if</span> <span class="p">(</span><span class="nx">stage</span><span class="p">.</span><span class="nx">cb</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">that</span><span class="p">.</span><span class="nx">steps</span><span class="p">[</span><span class="nx">id</span><span class="p">])</span> <span class="nx">that</span><span class="p">.</span><span class="nx">addStep</span><span class="p">(</span><span class="nx">stage</span><span class="p">);</span>
                <span class="nx">stage</span> <span class="o">=</span> <span class="p">{</span> <span class="nx">id</span><span class="o">:</span> <span class="nx">id</span><span class="p">,</span> <span class="nx">steps</span><span class="o">:</span> <span class="p">[</span> <span class="nx">id</span> <span class="p">]</span> <span class="p">};</span>
            <span class="p">}</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-163" id="section-163">&#182;</a>
</div>
<p>A new stage is created if not found (performs validation).</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">that</span><span class="p">.</span><span class="nx">stages</span><span class="p">[</span><span class="nx">id</span><span class="p">])</span> <span class="nx">that</span><span class="p">.</span><span class="nx">addStage</span><span class="p">(</span><span class="nx">stage</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;string&#39;</span> <span class="o">!==</span> <span class="k">typeof</span> <span class="nx">stage</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">throw</span> <span class="k">new</span> <span class="nx">TypeError</span><span class="p">(</span><span class="s1">&#39;Stager.&#39;</span> <span class="o">+</span> <span class="nx">method</span> <span class="o">+</span> <span class="s1">&#39;: stage must be &#39;</span> <span class="o">+</span>
                                    <span class="s1">&#39;string or object.&#39;</span><span class="p">);</span>
            <span class="p">}</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-164" id="section-164">&#182;</a>
</div>
<p>See whether the stage id contains an alias. Throws errors.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>            <span class="nx">tokens</span> <span class="o">=</span> <span class="nx">handleAlias</span><span class="p">(</span><span class="nx">that</span><span class="p">,</span> <span class="nx">stage</span><span class="p">,</span> <span class="nx">method</span><span class="p">);</span>
            <span class="nx">alias</span> <span class="o">=</span> <span class="nx">tokens</span><span class="p">.</span><span class="nx">alias</span><span class="p">;</span>
            <span class="nx">id</span> <span class="o">=</span> <span class="nx">tokens</span><span class="p">.</span><span class="nx">id</span><span class="p">;</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-165" id="section-165">&#182;</a>
</div>
<p>Alias must reference an existing stage (checked before).</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>            <span class="k">if</span> <span class="p">(</span><span class="nx">alias</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">that</span><span class="p">.</span><span class="nx">stages</span><span class="p">[</span><span class="nx">alias</span><span class="p">]</span> <span class="o">=</span> <span class="nx">that</span><span class="p">.</span><span class="nx">stages</span><span class="p">[</span><span class="nx">id</span><span class="p">];</span>
            <span class="p">}</span>
            <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">that</span><span class="p">.</span><span class="nx">stages</span><span class="p">[</span><span class="nx">id</span><span class="p">])</span> <span class="p">{</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-166" id="section-166">&#182;</a>
</div>
<p>Add the step if not existing and flag it as default.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>                <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">that</span><span class="p">.</span><span class="nx">steps</span><span class="p">[</span><span class="nx">id</span><span class="p">])</span> <span class="p">{</span>
                    <span class="nx">that</span><span class="p">.</span><span class="nx">addStep</span><span class="p">({</span>
                        <span class="nx">id</span><span class="o">:</span> <span class="nx">id</span><span class="p">,</span>
                        <span class="nx">cb</span><span class="o">:</span> <span class="nx">that</span><span class="p">.</span><span class="nx">getDefaultCallback</span><span class="p">(),</span>
                        <span class="nx">_defaultStep</span><span class="o">:</span> <span class="kc">true</span>
                    <span class="p">});</span>
                <span class="p">}</span>
                <span class="nx">that</span><span class="p">.</span><span class="nx">addStage</span><span class="p">({</span>
                    <span class="nx">id</span><span class="o">:</span> <span class="nx">id</span><span class="p">,</span>
                    <span class="nx">steps</span><span class="o">:</span> <span class="p">[</span> <span class="nx">id</span> <span class="p">]</span>
                <span class="p">});</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nx">alias</span> <span class="o">||</span> <span class="nx">id</span><span class="p">;</span>
    <span class="p">}</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="checkpositionsparameter">
  <h4>
    <a href="#checkpositionsparameter" class="pilcrow">&#182;</a>
    checkPositionsParameter
  </h4>
</div>

  </div>
  <div class="body"><p>Check validity of a positions parameter</p>

<p>Called by: <code>stage</code>, <code>repeat</code>, <code>doLoop</code>, 'loop`.</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">stage</span>
      <span class="dox_type">string</span>
      <span class="dox_type">number</span>
      <span>The positions parameter to validate</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">method</span>
      <span class="dox_type">string</span>
      <span>The name of the method calling the validation</span>
    </div>
    <div class="dox_tag_title">API</div>
    <div class="dox_tag_detail">
      <span class="dox_type">private
</span>
    </span>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>    <span class="kd">function</span> <span class="nx">checkPositionsParameter</span><span class="p">(</span><span class="nx">positions</span><span class="p">,</span> <span class="nx">method</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">err</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;undefined&#39;</span> <span class="o">===</span> <span class="k">typeof</span> <span class="nx">positions</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;number&#39;</span> <span class="o">===</span> <span class="k">typeof</span> <span class="nx">positions</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">isNaN</span><span class="p">(</span><span class="nx">positions</span><span class="p">)</span> <span class="o">||</span> <span class="nx">positions</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="nx">err</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
            <span class="k">else</span> <span class="nx">positions</span> <span class="o">+=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">err</span> <span class="o">||</span> <span class="s1">&#39;string&#39;</span> <span class="o">!==</span> <span class="k">typeof</span> <span class="nx">positions</span> <span class="o">||</span> <span class="nx">positions</span><span class="p">.</span><span class="nx">trim</span><span class="p">()</span> <span class="o">===</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nx">TypeError</span><span class="p">(</span><span class="s1">&#39;Stager.&#39;</span> <span class="o">+</span> <span class="nx">method</span> <span class="o">+</span> <span class="s1">&#39;: positions must &#39;</span> <span class="o">+</span>
                                <span class="s1">&#39;be a non-empty string, a positive number, &#39;</span> <span class="o">+</span>
                                <span class="s1">&#39;or undefined. Found: &#39;</span> <span class="o">+</span> <span class="nx">positions</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="nx">positions</span><span class="p">;</span>
    <span class="p">}</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="addstagetocurrentblock">
  <h4>
    <a href="#addstagetocurrentblock" class="pilcrow">&#182;</a>
    addStageToCurrentBlock
  </h4>
</div>

  </div>
  <div class="body"><p>Performs several meta operations necessary to add a stage block</p>

<p>Operations:</p>

<ul>
<li>Ends any unclosed blocks.</li>
<li>Begin a new enclosing block.</li>
<li>Adds a stage block.</li>
<li>Adds a steps block.</li>
</ul>
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">that</span>
      <span class="dox_type">Stager</span>
      <span>Stager object</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">stage</span>
      <span class="dox_type">object</span>
      <span>The stage to add containing its type</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">positions</span>
      <span class="dox_type">string</span>
      <span>Optional. The allowed positions for the stage</span>
    </div>
    <div class="dox_tag_title">API</div>
    <div class="dox_tag_detail">
      <span class="dox_type">private
</span>
    </span>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>    <span class="kd">function</span> <span class="nx">addStageToCurrentBlock</span><span class="p">(</span><span class="nx">that</span><span class="p">,</span> <span class="nx">stage</span><span class="p">,</span> <span class="nx">positions</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">name</span><span class="p">,</span> <span class="nx">curBlock</span><span class="p">,</span> <span class="nx">rndName</span><span class="p">;</span>
        <span class="nx">name</span> <span class="o">=</span> <span class="nx">stage</span><span class="p">.</span><span class="nx">id</span> <span class="o">||</span> <span class="nx">stage</span><span class="p">.</span><span class="nx">type</span><span class="p">;</span>

        <span class="nx">rndName</span> <span class="o">=</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="nx">J</span><span class="p">.</span><span class="nx">randomInt</span><span class="p">(</span><span class="mi">10000</span><span class="p">);</span>

        <span class="nx">that</span><span class="p">.</span><span class="nx">stageBlock</span><span class="p">(</span><span class="nx">positions</span><span class="p">,</span> <span class="p">{</span> <span class="nx">id</span><span class="o">:</span> <span class="nx">BLOCK_ENCLOSING</span> <span class="o">+</span> <span class="nx">name</span> <span class="o">+</span> <span class="nx">rndName</span> <span class="p">});</span>

        <span class="nx">curBlock</span> <span class="o">=</span> <span class="nx">that</span><span class="p">.</span><span class="nx">getCurrentBlock</span><span class="p">();</span>
        <span class="nx">curBlock</span><span class="p">.</span><span class="nx">add</span><span class="p">({</span>
            <span class="nx">type</span><span class="o">:</span> <span class="nx">BLOCK_STAGE</span><span class="p">,</span>
            <span class="nx">item</span><span class="o">:</span> <span class="nx">stage</span>
        <span class="p">});</span>

        <span class="nx">that</span><span class="p">.</span><span class="nx">currentType</span> <span class="o">=</span> <span class="nx">name</span><span class="p">;</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-169" id="section-169">&#182;</a>
</div>
<p>Add step block inside stage block.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>        <span class="nx">that</span><span class="p">.</span><span class="nx">stepBlock</span><span class="p">(</span><span class="s1">&#39;linear&#39;</span><span class="p">,</span> <span class="p">{</span> <span class="nx">id</span><span class="o">:</span> <span class="nx">BLOCK_ENCLOSING</span> <span class="o">+</span> <span class="nx">name</span> <span class="o">+</span> <span class="s1">&#39;_steps&#39;</span> <span class="o">+</span>
                                   <span class="nx">rndName</span> <span class="p">});</span>
    <span class="p">}</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="setskipstagestep">
  <h4>
    <a href="#setskipstagestep" class="pilcrow">&#182;</a>
    setSkipStageStep
  </h4>
</div>

  </div>
  <div class="body"><p>Sets/Gets the value for the flag <code>toSkip</code> for a stage or a step</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">that</span>
      <span class="dox_type">Stager</span>
      <span>Stager object</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">stageId</span>
      <span class="dox_type">string</span>
      <span>The id of the stage</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">stepId</span>
      <span class="dox_type">string</span>
      <span>Optional. The id of the step within the stage</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">value</span>
      <span class="dox_type">mixed</span>
      <span>If defined, is assigned to the stage or step</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">method</span>
      <span class="dox_type">string</span>
      <span>The name of the method calling the validation</span>
    </div>
    <div class="dox_tag_title">Returns</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name"></span>
      <span class="dox_type">boolean</span>
      <span class="dox_type">null</span>
      <span>The current value for the stage or step</span>
    </div>
    <div class="dox_tag_title">API</div>
    <div class="dox_tag_detail">
      <span class="dox_type">private
</span>
    </span>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>    <span class="kd">function</span> <span class="nx">setSkipStageStep</span><span class="p">(</span><span class="nx">that</span><span class="p">,</span> <span class="nx">stageId</span><span class="p">,</span> <span class="nx">stepId</span><span class="p">,</span> <span class="nx">value</span><span class="p">,</span> <span class="nx">method</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;string&#39;</span> <span class="o">!==</span> <span class="k">typeof</span> <span class="nx">stageId</span> <span class="o">||</span> <span class="nx">stageId</span><span class="p">.</span><span class="nx">trim</span><span class="p">()</span> <span class="o">===</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nx">TypeError</span><span class="p">(</span><span class="s1">&#39;Stager.&#39;</span> <span class="o">+</span> <span class="nx">method</span> <span class="o">+</span> <span class="s1">&#39;: stageId must &#39;</span> <span class="o">+</span>
                                <span class="s1">&#39;be a non-empty string.&#39;</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">stepId</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;string&#39;</span> <span class="o">!==</span> <span class="k">typeof</span> <span class="nx">stepId</span> <span class="o">||</span> <span class="nx">stepId</span><span class="p">.</span><span class="nx">trim</span><span class="p">()</span> <span class="o">===</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">throw</span> <span class="k">new</span> <span class="nx">TypeError</span><span class="p">(</span><span class="s1">&#39;Stager.&#39;</span> <span class="o">+</span> <span class="nx">method</span> <span class="o">+</span> <span class="s1">&#39;: stepId must &#39;</span> <span class="o">+</span>
                                    <span class="s1">&#39;be a non-empty string or undefined.&#39;</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;undefined&#39;</span> <span class="o">!==</span> <span class="k">typeof</span> <span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">that</span><span class="p">.</span><span class="nx">toSkip</span><span class="p">.</span><span class="nx">steps</span><span class="p">[</span><span class="nx">stageId</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="nx">stepId</span><span class="p">]</span> <span class="o">=</span> <span class="nx">value</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">return</span> <span class="nx">that</span><span class="p">.</span><span class="nx">toSkip</span><span class="p">.</span><span class="nx">steps</span><span class="p">[</span><span class="nx">stageId</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="nx">stepId</span><span class="p">];</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;undefined&#39;</span> <span class="o">!==</span> <span class="k">typeof</span> <span class="nx">value</span><span class="p">)</span> <span class="nx">that</span><span class="p">.</span><span class="nx">toSkip</span><span class="p">.</span><span class="nx">stages</span><span class="p">[</span><span class="nx">stageId</span><span class="p">]</span> <span class="o">=</span> <span class="nx">value</span><span class="p">;</span>
        <span class="k">return</span> <span class="nx">that</span><span class="p">.</span><span class="nx">toSkip</span><span class="p">.</span><span class="nx">stages</span><span class="p">[</span><span class="nx">stageId</span><span class="p">];</span>
    <span class="p">}</span>

<span class="p">})(</span>
    <span class="s1">&#39;undefined&#39;</span> <span class="o">!=</span> <span class="k">typeof</span> <span class="nx">node</span> <span class="o">?</span> <span class="nx">node</span> <span class="o">:</span> <span class="nx">module</span><span class="p">.</span><span class="nx">exports</span><span class="p">,</span>
    <span class="s1">&#39;undefined&#39;</span> <span class="o">!=</span> <span class="k">typeof</span> <span class="nx">node</span> <span class="o">?</span> <span class="nx">node</span> <span class="o">:</span> <span class="nx">module</span><span class="p">.</span><span class="nx">parent</span><span class="p">.</span><span class="nx">exports</span>
<span class="p">);</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-171" id="section-171">&#182;</a>
</div>
<p>NOT USED.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-172" id="section-172">&#182;</a>
</div>
<div class="dox">
  <div class="summary"><p>extendStageStep</p>
  </div>
  <div class="body"><p>Extends the properties of a stage step with those from an update object</p>

<p>Properties of the extended stage/step are overwritten with the
corresponding properties of the update object. However if the
property of the update object is a function, it is wrapped in
another function that passes the old value of property of the
extended step/stage object as the first parameter to the
extending function. Any other parameters will be passed
along in 2nd, 3rd, etc. position.</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">that</span>
      <span class="dox_type">Stager</span>
      <span>Stager object</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">original</span>
      <span class="dox_type">object</span>
      <span>The original object</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">update</span>
      <span class="dox_type">object</span>
      <span>The update object</span>
    </div>
  </div>
</div>


<div class="highlight"><pre><code><span class="n">function</span> <span class="n">extendStageStep</span><span class="p">(</span><span class="n">original</span><span class="p">,</span> <span class="n">update</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">var</span> <span class="n">property</span><span class="p">;</span>

    <span class="k">for</span> <span class="p">(</span><span class="n">property</span> <span class="n">in</span> <span class="n">update</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">update</span><span class="o">.</span><span class="n">hasOwnProperty</span><span class="p">(</span><span class="n">property</span><span class="p">))</span> <span class="p">{</span>
            <span class="sr">//</span> <span class="n">Extend</span> <span class="n">function</span> <span class="n">with</span> <span class="n">wrapping</span> <span class="n">function</span><span class="o">.</span>
            <span class="k">if</span> <span class="p">(</span><span class="s">&#39;function&#39;</span> <span class="o">===</span> <span class="n">typeof</span> <span class="n">update</span><span class="p">[</span><span class="n">property</span><span class="p">])</span> <span class="p">{</span>

                <span class="sr">//</span> <span class="n">Saving</span> <span class="n">a</span> <span class="n">copy</span> <span class="n">of</span> <span class="n">original</span> <span class="n">property</span><span class="o">.</span>
                <span class="n">saveExtendedProperty</span><span class="p">(</span><span class="n">original</span><span class="p">,</span> <span class="n">property</span><span class="p">);</span>

                <span class="p">(</span><span class="n">function</span><span class="p">(</span><span class="n">oldCb</span><span class="p">,</span> <span class="n">newCb</span><span class="p">)</span> <span class="p">{</span>

                    <span class="n">original</span><span class="p">[</span><span class="n">property</span><span class="p">]</span> <span class="o">=</span> <span class="n">function</span><span class="p">()</span> <span class="p">{</span>
                        <span class="n">var</span> <span class="n">args</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">len</span><span class="p">,</span> <span class="n">extCopyName</span><span class="p">;</span>



                        <span class="n">len</span> <span class="o">=</span> <span class="n">arguments</span><span class="o">.</span><span class="nb">length</span><span class="p">;</span>
                        <span class="n">args</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Array</span><span class="p">(</span><span class="n">len</span><span class="o">+</span><span class="mi">1</span><span class="p">);</span>
                        <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">original</span><span class="o">.</span><span class="n">__extended</span><span class="p">[</span><span class="n">extCopy</span><span class="p">]</span>
                        <span class="n">switch</span><span class="p">(</span><span class="n">len</span><span class="p">)</span> <span class="p">{</span>
                        <span class="k">case</span> <span class="mi">1</span><span class="p">:</span>
                            <span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">arguments</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span> <span class="n">break</span><span class="p">;</span>
                        <span class="k">case</span> <span class="mi">2</span><span class="p">:</span>
                            <span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">arguments</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
                            <span class="n">args</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">arguments</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span> <span class="n">break</span><span class="p">;</span>
                        <span class="k">case</span> <span class="mi">3</span><span class="p">:</span>
                            <span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">arguments</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
                            <span class="n">args</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">arguments</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
                            <span class="n">args</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">arguments</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span> <span class="n">break</span><span class="p">;</span>
                        <span class="n">default:</span>
                            <span class="n">i</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
                            <span class="k">for</span> <span class="p">(</span> <span class="p">;</span> <span class="o">++</span><span class="n">i</span> <span class="o">&lt;</span> <span class="n">len</span> <span class="p">;</span> <span class="p">)</span> <span class="p">{</span>
                                <span class="n">args</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">arguments</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
                            <span class="p">}</span>
                        <span class="p">}</span>
                        <span class="n">newCb</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">this</span><span class="p">,</span> <span class="n">args</span><span class="p">);</span>
                    <span class="p">};</span>
                <span class="p">})(</span><span class="n">original</span><span class="p">[</span><span class="n">property</span><span class="p">],</span> <span class="n">update</span><span class="p">[</span><span class="n">property</span><span class="p">]);</span>
            <span class="p">}</span>
            <span class="sr">//</span> <span class="n">Otherwise</span> <span class="n">overwrite</span><span class="o">.</span>
            <span class="k">else</span> <span class="p">{</span>
                <span class="n">original</span><span class="p">[</span><span class="n">property</span><span class="p">]</span> <span class="o">=</span> <span class="n">update</span><span class="p">[</span><span class="n">property</span><span class="p">];</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>


        </td>
        <td class="code highlight"><div class="highlight"><pre></pre></div>
        </td>
      </tr>
  </tbody>
</table>
  </div>
</body>
</html>
