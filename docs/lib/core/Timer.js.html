<!DOCTYPE html>
<html>
<head>
  <title>Timer.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="../../doc-style.css" />
  <script src="../../doc-filelist.js"></script>
  <script>
    var relativeDir = '../../', thisFile = 'lib/core/Timer.js', defaultSidebar = true;
  </script>
  <script src="../../doc-script.js"></script>
</head>
<body>
  <div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">
      <div class="heading h1">
        <a href="#timer">Timer</a>
      </div>
      <div class="heading h2">
        <a href="#global-scope">Global scope</a>
      </div>
      <div class="heading h2">
        <a href="#timer-constructor">Timer constructor</a>
      </div>
      <div class="heading h3">
        <a href="#timer.timers">Timer.timers</a>
      </div>
      <div class="heading h3">
        <a href="#timer.timestamps">Timer.timestamps</a>
      </div>
      <div class="heading h2">
        <a href="#timer-methods">Timer methods</a>
      </div>
      <div class="heading h3">
        <a href="#timer.createtimer">Timer.createTimer</a>
      </div>
      <div class="heading h3">
        <a href="#timer.destroytimer">Timer.destroyTimer</a>
      </div>
      <div class="heading h3">
        <a href="#timer.destroyalltimers">Timer.destroyAllTimers</a>
      </div>
      <div class="heading h3">
        <a href="#timer.settimestamp">Timer.setTimestamp</a>
      </div>
      <div class="heading h3">
        <a href="#timer.gettimestamp">Timer.getTimestamp</a>
      </div>
      <div class="heading h3">
        <a href="#timer.getalltimestamps">Timer.getAllTimestamps</a>
      </div>
      <div class="heading h3">
        <a href="#timer.gettimesince">Timer.getTimeSince</a>
      </div>
      <div class="heading h3">
        <a href="#timer.gettimediff">Timer.getTimeDiff</a>
      </div>
      <div class="heading h3">
        <a href="#timer.gettimer">Timer.getTimer</a>
      </div>
      <div class="heading h3">
        <a href="#timer.randomemit">Timer.randomEmit</a>
      </div>
      <div class="heading h3">
        <a href="#timer.randomexec">Timer.randomExec</a>
      </div>
      <div class="heading h1">
        <a href="#gametimer">GameTimer</a>
      </div>
      <div class="heading h3">
        <a href="#gametimer-status-levels">GameTimer status levels</a>
      </div>
      <div class="heading h2">
        <a href="#gametimer-constructor">GameTimer constructor</a>
      </div>
      <div class="heading h2">
        <a href="#public-properties">Public properties</a>
      </div>
      <div class="heading h3">
        <a href="#node">node</a>
      </div>
      <div class="heading h3">
        <a href="#name">name</a>
      </div>
      <div class="heading h3">
        <a href="#gametimer.status">GameTimer.status</a>
      </div>
      <div class="heading h3">
        <a href="#gametimer.options">GameTimer.options</a>
      </div>
      <div class="heading h3">
        <a href="#gametimer.timerid">GameTimer.timerId</a>
      </div>
      <div class="heading h3">
        <a href="#gametimer.timeleft">GameTimer.timeLeft</a>
      </div>
      <div class="heading h3">
        <a href="#gametimer.timepassed">GameTimer.timePassed</a>
      </div>
      <div class="heading h3">
        <a href="#gametimer.update">GameTimer.update</a>
      </div>
      <div class="heading h3">
        <a href="#gametimer.updateremaining">GameTimer.updateRemaining</a>
      </div>
      <div class="heading h3">
        <a href="#gametimer.updatestart">GameTimer.updateStart</a>
      </div>
      <div class="heading h3">
        <a href="#gametimer.startpaused">GameTimer.startPaused</a>
      </div>
      <div class="heading h3">
        <a href="#gametimer.timeup">GameTimer.timeup</a>
      </div>
      <div class="heading h3">
        <a href="#gametimer.hooks">GameTimer.hooks</a>
      </div>
      <div class="heading h3">
        <a href="#gametimer.hooknames">GameTimer.hookNames</a>
      </div>
      <div class="heading h2">
        <a href="#gametimer-methods">GameTimer methods</a>
      </div>
      <div class="heading h3">
        <a href="#gametimer.init">GameTimer.init</a>
      </div>
      <div class="heading h3">
        <a href="#gametimer.fire">GameTimer.fire</a>
      </div>
      <div class="heading h3">
        <a href="#gametimer.start">GameTimer.start</a>
      </div>
      <div class="heading h3">
        <a href="#gametimer.addhook">GameTimer.addHook</a>
      </div>
      <div class="heading h3">
        <a href="#gametimer.removehook">GameTimer.removeHook</a>
      </div>
      <div class="heading h3">
        <a href="#gametimer.pause">GameTimer.pause</a>
      </div>
      <div class="heading h3">
        <a href="#gametimer.resume">GameTimer.resume</a>
      </div>
      <div class="heading h3">
        <a href="#gametimer.stop">GameTimer.stop</a>
      </div>
      <div class="heading h3">
        <a href="#gametimer.restart">GameTimer.restart</a>
      </div>
      <div class="heading h3">
        <a href="#gametimer.isrunning">GameTimer.isRunning</a>
      </div>
      <div class="heading h3">
        <a href="#gametimer.isstopped">GameTimer.isStopped</a>
      </div>
      <div class="heading h3">
        <a href="#gametimer.ispaused">GameTimer.isPaused</a>
      </div>
      <div class="heading h2">
        <a href="#closure">Closure</a>
      </div>
    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container"><div class="background highlight"></div>
<table cellpadding="0" cellspacing="0">
  <tbody>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="timer">
  <h1>
    <a href="#timer" class="pilcrow">&#182;</a>
    Timer
  </h1>
</div>


<p>Copyright(c) 2014 Stefano Balietti
MIT Licensed</p>
  </div>
  <div class="body"><p>Timing-related utility functions</p>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">exports</span><span class="p">,</span> <span class="nx">parent</span><span class="p">)</span> <span class="p">{</span>

    <span class="s2">&quot;use strict&quot;</span><span class="p">;</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="global-scope">
  <h2>
    <a href="#global-scope" class="pilcrow">&#182;</a>
    Global scope
  </h2>
</div>

        </td>
        <td class="code highlight"><div class="highlight"><pre>    <span class="kd">var</span> <span class="nx">J</span> <span class="o">=</span> <span class="nx">parent</span><span class="p">.</span><span class="nx">JSUS</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">constants</span> <span class="o">=</span> <span class="nx">parent</span><span class="p">.</span><span class="nx">constants</span><span class="p">;</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-3" id="section-3">&#182;</a>
</div>
<p>Exposing Timer constructor</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>    <span class="nx">exports</span><span class="p">.</span><span class="nx">Timer</span> <span class="o">=</span> <span class="nx">Timer</span><span class="p">;</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="timer-constructor">
  <h2>
    <a href="#timer-constructor" class="pilcrow">&#182;</a>
    Timer constructor
  </h2>
</div>

  </div>
  <div class="body"><p>Creates a new instance of Timer</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">node.</span>
      <span class="dox_type">NodeGameClient</span>
      <span>A valid NodeGameClient object</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">settings</span>
      <span class="dox_type">object</span>
      <span>Optional. A configuration object</span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>    <span class="kd">function</span> <span class="nx">Timer</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">settings</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">node</span> <span class="o">=</span> <span class="nx">node</span><span class="p">;</span>

        <span class="k">this</span><span class="p">.</span><span class="nx">settings</span> <span class="o">=</span> <span class="nx">settings</span> <span class="o">||</span> <span class="p">{};</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="timer.timers">
  <h3>
    <a href="#timer.timers" class="pilcrow">&#182;</a>
    Timer.timers
  </h3>
</div>

  </div>
  <div class="body"><p>Collection of currently active timers created by <code>Timer.createTimer</code></p>
  </div>
  <div class="details">
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">Timer.createTimer
  </span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>        <span class="k">this</span><span class="p">.</span><span class="nx">timers</span> <span class="o">=</span> <span class="p">{};</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="timer.timestamps">
  <h3>
    <a href="#timer.timestamps" class="pilcrow">&#182;</a>
    Timer.timestamps
  </h3>
</div>

  </div>
  <div class="body"><p>Named timestamp collection</p>

<p>Maps names to numbers (milliseconds since epoch)</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">Timer.setTimestamp</span>
    </div>
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">Timer.getTimestamp</span>
    </div>
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">Timer.getTimeSince
  </span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>        <span class="k">this</span><span class="p">.</span><span class="nx">timestamps</span> <span class="o">=</span> <span class="p">{};</span>
    <span class="p">}</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="timer-methods">
  <h2>
    <a href="#timer-methods" class="pilcrow">&#182;</a>
    Timer methods
  </h2>
</div>

        </td>
        <td class="code highlight"><div class="highlight"><pre></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="timer.createtimer">
  <h3>
    <a href="#timer.createtimer" class="pilcrow">&#182;</a>
    Timer.createTimer
  </h3>
</div>

  </div>
  <div class="body"><p>Returns a new GameTimer</p>

<p>The GameTimer instance is automatically paused and resumed on
the respective events.</p>

<p>Timer creation is flexible, and input parameter can be a full
configuration object, the number of millieconds or nothing. In the
latter case, the new timer will need to be configured manually. If
only the number of milliseconds is passed the timer will fire a 'TIMEUP'
event once the time expires.</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">options</span>
      <span class="dox_type">mixed</span>
      <span>The configuration object passed to the GameTimer
  constructor. Alternatively, it is possble to pass directly the number
  of milliseconds and the remaining settings will be added, or to leave
  it undefined.</span>
    </div>
    <div class="dox_tag_title">Returns</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name"></span>
      <span class="dox_type">GameTimer</span>
      <span>timer The requested timer</span>
    </div>
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">GameTimer
  </span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>    <span class="nx">Timer</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">createTimer</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">gameTimer</span><span class="p">,</span> <span class="nx">pausedCb</span><span class="p">,</span> <span class="nx">resumedCb</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">options</span> <span class="o">&amp;&amp;</span>
            <span class="p">(</span><span class="s1">&#39;object&#39;</span> <span class="o">!==</span> <span class="k">typeof</span> <span class="nx">options</span> <span class="o">&amp;&amp;</span> <span class="s1">&#39;number&#39;</span> <span class="o">!==</span> <span class="k">typeof</span> <span class="nx">options</span><span class="p">))</span> <span class="p">{</span>

            <span class="k">throw</span> <span class="k">new</span> <span class="nx">TypeError</span><span class="p">(</span><span class="s1">&#39;Timer.createTimer: options must be &#39;</span> <span class="o">+</span>
                                <span class="s1">&#39;undefined, object or number.&#39;</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;number&#39;</span> <span class="o">===</span> <span class="k">typeof</span> <span class="nx">options</span><span class="p">)</span> <span class="nx">options</span> <span class="o">=</span> <span class="p">{</span> <span class="nx">milliseconds</span><span class="o">:</span> <span class="nx">options</span> <span class="p">};</span>
        <span class="nx">options</span> <span class="o">=</span> <span class="nx">options</span> <span class="o">||</span> <span class="p">{};</span>

        <span class="nx">options</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">name</span> <span class="o">||</span>
            <span class="nx">J</span><span class="p">.</span><span class="nx">uniqueKey</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">timers</span><span class="p">,</span> <span class="s1">&#39;timer_&#39;</span> <span class="o">+</span> <span class="nx">J</span><span class="p">.</span><span class="nx">randomInt</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10000000</span><span class="p">));</span>

        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">timers</span><span class="p">[</span><span class="nx">options</span><span class="p">.</span><span class="nx">name</span><span class="p">])</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">&#39;Timer.createTimer: timer &#39;</span> <span class="o">+</span> <span class="nx">options</span><span class="p">.</span><span class="nx">name</span> <span class="o">+</span>
                            <span class="s1">&#39; already existing.&#39;</span><span class="p">);</span>
        <span class="p">}</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-9" id="section-9">&#182;</a>
</div>
<p>If game is paused add options startPaused, unless user
specified a value in the options object.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">node</span><span class="p">.</span><span class="nx">game</span><span class="p">.</span><span class="nx">paused</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;undefined&#39;</span> <span class="o">===</span> <span class="k">typeof</span> <span class="nx">options</span><span class="p">.</span><span class="nx">startPaused</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">options</span><span class="p">.</span><span class="nx">startPaused</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-10" id="section-10">&#182;</a>
</div>
<p>Create the GameTimer:</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>        <span class="nx">gameTimer</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">GameTimer</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">node</span><span class="p">,</span> <span class="nx">options</span><span class="p">);</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-11" id="section-11">&#182;</a>
</div>
<p>Attach pause / resume listeners:</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>        <span class="nx">pausedCb</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">gameTimer</span><span class="p">.</span><span class="nx">isPaused</span><span class="p">())</span> <span class="p">{</span>
                <span class="nx">gameTimer</span><span class="p">.</span><span class="nx">pause</span><span class="p">();</span>
            <span class="p">}</span>
        <span class="p">};</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">node</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;PAUSED&#39;</span><span class="p">,</span> <span class="nx">pausedCb</span><span class="p">);</span>

        <span class="nx">resumedCb</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-12" id="section-12">&#182;</a>
</div>
<p>startPaused=true also counts as a "paused" state:</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>            <span class="k">if</span> <span class="p">(</span><span class="nx">gameTimer</span><span class="p">.</span><span class="nx">isPaused</span><span class="p">()</span> <span class="o">||</span> <span class="nx">gameTimer</span><span class="p">.</span><span class="nx">startPaused</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">gameTimer</span><span class="p">.</span><span class="nx">resume</span><span class="p">();</span>
            <span class="p">}</span>
        <span class="p">};</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">node</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;RESUMED&#39;</span><span class="p">,</span> <span class="nx">resumedCb</span><span class="p">);</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-13" id="section-13">&#182;</a>
</div>
<p>Attach listener handlers to GameTimer object so they can be
unregistered later:</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>        <span class="nx">gameTimer</span><span class="p">.</span><span class="nx">timerPausedCallback</span> <span class="o">=</span> <span class="nx">pausedCb</span><span class="p">;</span>
        <span class="nx">gameTimer</span><span class="p">.</span><span class="nx">timerResumedCallback</span> <span class="o">=</span> <span class="nx">resumedCb</span><span class="p">;</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-14" id="section-14">&#182;</a>
</div>
<p>Add a reference into this.timers.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>        <span class="k">this</span><span class="p">.</span><span class="nx">timers</span><span class="p">[</span><span class="nx">gameTimer</span><span class="p">.</span><span class="nx">name</span><span class="p">]</span> <span class="o">=</span> <span class="nx">gameTimer</span><span class="p">;</span>

        <span class="k">return</span> <span class="nx">gameTimer</span><span class="p">;</span>
    <span class="p">};</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="timer.destroytimer">
  <h3>
    <a href="#timer.destroytimer" class="pilcrow">&#182;</a>
    Timer.destroyTimer
  </h3>
</div>

  </div>
  <div class="body"><p>Stops and removes a GameTimer</p>

<p>The event handlers listening on PAUSED/RESUMED that are attached to
the given GameTimer object are removed.</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">gameTimer</span>
      <span class="dox_type">object</span>
      <span class="dox_type">string</span>
      <span>The gameTimer object or the name of
  the gameTimer created with Timer.createTimer</span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>    <span class="nx">Timer</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">destroyTimer</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">gameTimer</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;string&#39;</span> <span class="o">===</span> <span class="k">typeof</span> <span class="nx">gameTimer</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">timers</span><span class="p">[</span><span class="nx">gameTimer</span><span class="p">])</span> <span class="p">{</span>
                <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">&#39;node.timer.destroyTimer: gameTimer not &#39;</span> <span class="o">+</span>
                                <span class="s1">&#39;found: &#39;</span> <span class="o">+</span> <span class="nx">gameTimer</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="nx">gameTimer</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">timers</span><span class="p">[</span><span class="nx">gameTimer</span><span class="p">];</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;object&#39;</span> <span class="o">!==</span> <span class="k">typeof</span> <span class="nx">gameTimer</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">&#39;node.timer.destroyTimer: gameTimer must be &#39;</span> <span class="o">+</span>
                            <span class="s1">&#39;string or object.&#39;</span><span class="p">);</span>
        <span class="p">}</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-16" id="section-16">&#182;</a>
</div>
<p>Stop timer:</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">gameTimer</span><span class="p">.</span><span class="nx">isStopped</span><span class="p">())</span> <span class="p">{</span>
            <span class="nx">gameTimer</span><span class="p">.</span><span class="nx">stop</span><span class="p">();</span>
        <span class="p">}</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-17" id="section-17">&#182;</a>
</div>
<p>Detach listeners:</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>        <span class="k">this</span><span class="p">.</span><span class="nx">node</span><span class="p">.</span><span class="nx">off</span><span class="p">(</span><span class="s1">&#39;PAUSED&#39;</span><span class="p">,</span> <span class="nx">gameTimer</span><span class="p">.</span><span class="nx">timerPausedCallback</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">node</span><span class="p">.</span><span class="nx">off</span><span class="p">(</span><span class="s1">&#39;RESUMED&#39;</span><span class="p">,</span> <span class="nx">gameTimer</span><span class="p">.</span><span class="nx">timerResumedCallback</span><span class="p">);</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-18" id="section-18">&#182;</a>
</div>
<p>Delete reference in this.timers.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>        <span class="k">delete</span> <span class="k">this</span><span class="p">.</span><span class="nx">timers</span><span class="p">[</span><span class="nx">gameTimer</span><span class="p">.</span><span class="nx">name</span><span class="p">];</span>
    <span class="p">};</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="timer.destroyalltimers">
  <h3>
    <a href="#timer.destroyalltimers" class="pilcrow">&#182;</a>
    Timer.destroyAllTimers
  </h3>
</div>

  </div>
  <div class="body"><p>Stops and removes all registered GameTimers</p>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>    <span class="nx">Timer</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">destroyAllTimers</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">confirm</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">confirm</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">node</span><span class="p">.</span><span class="nx">warn</span><span class="p">(</span><span class="s1">&#39;Timer.destroyAllTimers: confirm must be true to &#39;</span> <span class="o">+</span>
                      <span class="s1">&#39;proceed. No timer destroyed.&#39;</span><span class="p">);</span>
            <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="k">in</span> <span class="k">this</span><span class="p">.</span><span class="nx">timers</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">destroyTimer</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">timers</span><span class="p">[</span><span class="nx">i</span><span class="p">]);</span>
        <span class="p">}</span>
    <span class="p">};</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-20" id="section-20">&#182;</a>
</div>
<p>Common handler for randomEmit and randomExec</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>    <span class="kd">function</span> <span class="nx">randomFire</span><span class="p">(</span><span class="nx">hook</span><span class="p">,</span> <span class="nx">maxWait</span><span class="p">,</span> <span class="nx">emit</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">that</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
        <span class="kd">var</span> <span class="nx">waitTime</span><span class="p">;</span>
        <span class="kd">var</span> <span class="nx">callback</span><span class="p">;</span>
        <span class="kd">var</span> <span class="nx">timerObj</span><span class="p">;</span>
        <span class="kd">var</span> <span class="nx">tentativeName</span><span class="p">;</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-21" id="section-21">&#182;</a>
</div>
<p>Get time to wait:</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>        <span class="nx">maxWait</span> <span class="o">=</span> <span class="nx">maxWait</span> <span class="o">||</span> <span class="mi">6000</span><span class="p">;</span>
        <span class="nx">waitTime</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span> <span class="o">*</span> <span class="nx">maxWait</span><span class="p">;</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-22" id="section-22">&#182;</a>
</div>
<p>Define timeup callback:</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>        <span class="k">if</span> <span class="p">(</span><span class="nx">emit</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">callback</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
                <span class="nx">that</span><span class="p">.</span><span class="nx">destroyTimer</span><span class="p">(</span><span class="nx">timerObj</span><span class="p">);</span>
                <span class="nx">that</span><span class="p">.</span><span class="nx">node</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="nx">hook</span><span class="p">);</span>
            <span class="p">};</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="p">{</span>
            <span class="nx">callback</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
                <span class="nx">that</span><span class="p">.</span><span class="nx">destroyTimer</span><span class="p">(</span><span class="nx">timerObj</span><span class="p">);</span>
                <span class="nx">hook</span><span class="p">.</span><span class="nx">call</span><span class="p">();</span>
            <span class="p">};</span>
        <span class="p">}</span>

        <span class="nx">tentativeName</span> <span class="o">=</span> <span class="nx">emit</span>
            <span class="o">?</span> <span class="s1">&#39;rndEmit_&#39;</span> <span class="o">+</span> <span class="nx">hook</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="nx">J</span><span class="p">.</span><span class="nx">randomInt</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1000000</span><span class="p">)</span>
            <span class="o">:</span> <span class="s1">&#39;rndExec_&#39;</span> <span class="o">+</span> <span class="nx">J</span><span class="p">.</span><span class="nx">randomInt</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1000000</span><span class="p">);</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-23" id="section-23">&#182;</a>
</div>
<p>Create and run timer:</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>        <span class="nx">timerObj</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">createTimer</span><span class="p">({</span>
            <span class="nx">milliseconds</span><span class="o">:</span> <span class="nx">waitTime</span><span class="p">,</span>
            <span class="nx">timeup</span><span class="o">:</span> <span class="nx">callback</span><span class="p">,</span>
            <span class="nx">name</span><span class="o">:</span> <span class="nx">J</span><span class="p">.</span><span class="nx">uniqueKey</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">timers</span><span class="p">,</span> <span class="nx">tentativeName</span><span class="p">)</span>
        <span class="p">});</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-24" id="section-24">&#182;</a>
</div>
<p>TODO: check if this condition is ok.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">node</span><span class="p">.</span><span class="nx">game</span><span class="p">.</span><span class="nx">isReady</span><span class="p">())</span> <span class="p">{</span>
            <span class="nx">timerObj</span><span class="p">.</span><span class="nx">start</span><span class="p">();</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="p">{</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-25" id="section-25">&#182;</a>
</div>
<p>TODO: this is not enough. Does not cover all use cases.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>            <span class="k">this</span><span class="p">.</span><span class="nx">node</span><span class="p">.</span><span class="nx">once</span><span class="p">(</span><span class="s1">&#39;PLAYING&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
                <span class="nx">timerObj</span><span class="p">.</span><span class="nx">start</span><span class="p">();</span>
            <span class="p">});</span>
        <span class="p">}</span>
    <span class="p">}</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="timer.settimestamp">
  <h3>
    <a href="#timer.settimestamp" class="pilcrow">&#182;</a>
    Timer.setTimestamp
  </h3>
</div>

  </div>
  <div class="body"><p>Adds or changes a named timestamp</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">name</span>
      <span class="dox_type">string</span>
      <span>The name of the timestamp</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">time</span>
      <span class="dox_type">number</span>
      <span class="dox_type">undefined</span>
      <span>Optional. The time in ms as returned by
  Date.getTime(). Default: Current time.</span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>    <span class="nx">Timer</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">setTimestamp</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">time</span><span class="p">)</span> <span class="p">{</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-27" id="section-27">&#182;</a>
</div>
<p>Default time: Current time</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>        <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;undefined&#39;</span> <span class="o">===</span> <span class="k">typeof</span> <span class="nx">time</span><span class="p">)</span> <span class="nx">time</span> <span class="o">=</span> <span class="p">(</span><span class="k">new</span> <span class="nb">Date</span><span class="p">()).</span><span class="nx">getTime</span><span class="p">();</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-28" id="section-28">&#182;</a>
</div>
<p>Check inputs:</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>        <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;string&#39;</span> <span class="o">!==</span> <span class="k">typeof</span> <span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">&#39;Timer.setTimestamp: name must be a string&#39;</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;number&#39;</span> <span class="o">!==</span> <span class="k">typeof</span> <span class="nx">time</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">&#39;Timer.setTimestamp: time must be a number or &#39;</span> <span class="o">+</span>
                            <span class="s1">&#39;undefined&#39;</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">this</span><span class="p">.</span><span class="nx">timestamps</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span> <span class="o">=</span> <span class="nx">time</span><span class="p">;</span>
    <span class="p">};</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="timer.gettimestamp">
  <h3>
    <a href="#timer.gettimestamp" class="pilcrow">&#182;</a>
    Timer.getTimestamp
  </h3>
</div>

  </div>
  <div class="body"><p>Retrieves a named timestamp</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">name</span>
      <span class="dox_type">string</span>
      <span>The name of the timestamp</span>
    </div>
    <div class="dox_tag_title">Returns</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name"></span>
      <span class="dox_type">number</span>
      <span class="dox_type">null</span>
      <span>The time associated with the timestamp,
  NULL if it doesn't exist</span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>    <span class="nx">Timer</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">getTimestamp</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-30" id="section-30">&#182;</a>
</div>
<p>Check input:</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>        <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;string&#39;</span> <span class="o">!==</span> <span class="k">typeof</span> <span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">&#39;Timer.getTimestamp: name must be a string&#39;</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">timestamps</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">name</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">timestamps</span><span class="p">[</span><span class="nx">name</span><span class="p">];</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="p">{</span>
            <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">};</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="timer.getalltimestamps">
  <h3>
    <a href="#timer.getalltimestamps" class="pilcrow">&#182;</a>
    Timer.getAllTimestamps
  </h3>
</div>

  </div>
  <div class="body"><p>Returns the map with all timestamps</p>

<p>Do not change the returned object.</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">Returns</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name"></span>
      <span class="dox_type">object</span>
      <span>The timestamp map</span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>    <span class="nx">Timer</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">getAllTimestamps</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">timestamps</span><span class="p">;</span>
    <span class="p">};</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="timer.gettimesince">
  <h3>
    <a href="#timer.gettimesince" class="pilcrow">&#182;</a>
    Timer.getTimeSince
  </h3>
</div>

  </div>
  <div class="body"><p>Gets the time in ms since a timestamp</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">name</span>
      <span class="dox_type">string</span>
      <span>The name of the timestamp</span>
    </div>
    <div class="dox_tag_title">Returns</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name"></span>
      <span class="dox_type">number</span>
      <span class="dox_type">null</span>
      <span>The time since the timestamp in ms,
  NULL if it doesn't exist</span>
    </div>
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">Timer.getTimeDiff
  </span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>    <span class="nx">Timer</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">getTimeSince</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">currentTime</span><span class="p">;</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-33" id="section-33">&#182;</a>
</div>
<p>Get current time:</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>        <span class="nx">currentTime</span> <span class="o">=</span> <span class="p">(</span><span class="k">new</span> <span class="nb">Date</span><span class="p">()).</span><span class="nx">getTime</span><span class="p">();</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-34" id="section-34">&#182;</a>
</div>
<p>Check input:</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>        <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;string&#39;</span> <span class="o">!==</span> <span class="k">typeof</span> <span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nx">TypeError</span><span class="p">(</span><span class="s1">&#39;Timer.getTimeSince: name must be string.&#39;</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">timestamps</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">name</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">currentTime</span> <span class="o">-</span> <span class="k">this</span><span class="p">.</span><span class="nx">timestamps</span><span class="p">[</span><span class="nx">name</span><span class="p">];</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="p">{</span>
            <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">};</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="timer.gettimediff">
  <h3>
    <a href="#timer.gettimediff" class="pilcrow">&#182;</a>
    Timer.getTimeDiff
  </h3>
</div>

  </div>
  <div class="body"><p>Returns the time difference between two registered timestamps</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">nameFrom</span>
      <span class="dox_type">string</span>
      <span>The name of the first timestamp</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">nameTo</span>
      <span class="dox_type">string</span>
      <span>The name of the second timestamp</span>
    </div>
    <div class="dox_tag_title">Returns</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name"></span>
      <span class="dox_type">number</span>
      <span>The time difference between the timestamps</span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>    <span class="nx">Timer</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">getTimeDiff</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">nameFrom</span><span class="p">,</span> <span class="nx">nameTo</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">timeFrom</span><span class="p">,</span> <span class="nx">timeTo</span><span class="p">;</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-36" id="section-36">&#182;</a>
</div>
<p>Check input:</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>        <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;string&#39;</span> <span class="o">!==</span> <span class="k">typeof</span> <span class="nx">nameFrom</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nx">TypeError</span><span class="p">(</span><span class="s1">&#39;Timer.getTimeDiff: nameFrom must be string.&#39;</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;string&#39;</span> <span class="o">!==</span> <span class="k">typeof</span> <span class="nx">nameTo</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nx">TypeError</span><span class="p">(</span><span class="s1">&#39;Timer.getTimeDiff: nameTo must be string.&#39;</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="nx">timeFrom</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">timestamps</span><span class="p">[</span><span class="nx">nameFrom</span><span class="p">];</span>

        <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;undefined&#39;</span> <span class="o">===</span> <span class="k">typeof</span> <span class="nx">timeFrom</span> <span class="o">||</span> <span class="nx">timeFrom</span> <span class="o">===</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">&#39;Timer.getTimeDiff: nameFrom does not resolve to &#39;</span> <span class="o">+</span>
                            <span class="s1">&#39;a valid timestamp.&#39;</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="nx">timeTo</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">timestamps</span><span class="p">[</span><span class="nx">nameTo</span><span class="p">];</span>

        <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;undefined&#39;</span> <span class="o">===</span> <span class="k">typeof</span> <span class="nx">timeTo</span> <span class="o">||</span> <span class="nx">timeTo</span> <span class="o">===</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">&#39;Timer.getTimeDiff: nameTo does not resolve to &#39;</span> <span class="o">+</span>
                            <span class="s1">&#39;a valid timestamp.&#39;</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nx">timeTo</span> <span class="o">-</span> <span class="nx">timeFrom</span><span class="p">;</span>
    <span class="p">};</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="timer.gettimer">
  <h3>
    <a href="#timer.gettimer" class="pilcrow">&#182;</a>
    Timer.getTimer
  </h3>
</div>

  </div>
  <div class="body"><p>Returns a reference to a previosly registered game timer.</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">name</span>
      <span class="dox_type">string</span>
      <span>The name of the timer</span>
    </div>
    <div class="dox_tag_title">Returns</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name"></span>
      <span class="dox_type">GameTimer</span>
      <span class="dox_type">null</span>
      <span>The game timer with the given name, or
  null if none is found</span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>    <span class="nx">Timer</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">getTimer</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;string&#39;</span> <span class="o">!==</span> <span class="k">typeof</span> <span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nx">TypeError</span><span class="p">(</span><span class="s1">&#39;Timer.getTimer: name must be string.&#39;</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">timers</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span> <span class="o">||</span> <span class="kc">null</span><span class="p">;</span>
    <span class="p">};</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="timer.randomemit">
  <h3>
    <a href="#timer.randomemit" class="pilcrow">&#182;</a>
    Timer.randomEmit
  </h3>
</div>

  </div>
  <div class="body"><p>Emits an event after a random time interval between 0 and maxWait</p>

<p>Respects pausing / resuming.</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">event</span>
      <span class="dox_type">string</span>
      <span>The name of the event</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">maxWait</span>
      <span class="dox_type">number</span>
      <span>Optional. The maximum time (in milliseconds)
  to wait before emitting the event. Default: 6000</span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>    <span class="nx">Timer</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">randomEmit</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">,</span> <span class="nx">maxWait</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">randomFire</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">event</span><span class="p">,</span> <span class="nx">maxWait</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
    <span class="p">};</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="timer.randomexec">
  <h3>
    <a href="#timer.randomexec" class="pilcrow">&#182;</a>
    Timer.randomExec
  </h3>
</div>

  </div>
  <div class="body"><p>Executes a callback function after a random time interval</p>

<p>Respects pausing / resuming.</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">func</span>
      <span class="dox_type">function</span>
      <span>The callback function to execute</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">maxWait</span>
      <span class="dox_type">number</span>
      <span>Optional. The maximum time (in milliseconds)
  to wait before executing the callback. Default: 6000</span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>    <span class="nx">Timer</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">randomExec</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">func</span><span class="p">,</span> <span class="nx">maxWait</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">randomFire</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">func</span><span class="p">,</span> <span class="nx">maxWait</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
    <span class="p">};</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="gametimer">
  <h1>
    <a href="#gametimer" class="pilcrow">&#182;</a>
    GameTimer
  </h1>
</div>

  </div>
  <div class="body"><p>Copyright(c) 2014 Stefano Balietti
MIT Licensed</p>

<p>Creates a controllable timer object for nodeGame.</p>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>    <span class="nx">exports</span><span class="p">.</span><span class="nx">GameTimer</span> <span class="o">=</span> <span class="nx">GameTimer</span><span class="p">;</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="gametimer-status-levels">
  <h3>
    <a href="#gametimer-status-levels" class="pilcrow">&#182;</a>
    GameTimer status levels
  </h3>
</div>


<p>Numerical levels representing the state of the GameTimer</p>
  </div>
  <div class="body">
  </div>
  <div class="details">
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">GameTimer.status
  </span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>    <span class="nx">GameTimer</span><span class="p">.</span><span class="nx">STOPPED</span> <span class="o">=</span> <span class="o">-</span><span class="mi">5</span><span class="p">;</span>
    <span class="nx">GameTimer</span><span class="p">.</span><span class="nx">PAUSED</span> <span class="o">=</span> <span class="o">-</span><span class="mi">3</span><span class="p">;</span>
    <span class="nx">GameTimer</span><span class="p">.</span><span class="nx">UNINITIALIZED</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="nx">GameTimer</span><span class="p">.</span><span class="nx">INITIALIZED</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="nx">GameTimer</span><span class="p">.</span><span class="nx">LOADING</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
    <span class="nx">GameTimer</span><span class="p">.</span><span class="nx">RUNNING</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="gametimer-constructor">
  <h2>
    <a href="#gametimer-constructor" class="pilcrow">&#182;</a>
    GameTimer constructor
  </h2>
</div>

  </div>
  <div class="body"><p>Creates an instance of GameTimer</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">options.</span>
      <span class="dox_type">object</span>
      <span>Optional. A configuration object</span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>    <span class="kd">function</span> <span class="nx">GameTimer</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">options</span> <span class="o">=</span> <span class="nx">options</span> <span class="o">||</span> <span class="p">{};</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="public-properties">
  <h2>
    <a href="#public-properties" class="pilcrow">&#182;</a>
    Public properties
  </h2>
</div>

        </td>
        <td class="code highlight"><div class="highlight"><pre></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="node">
  <h3>
    <a href="#node" class="pilcrow">&#182;</a>
    node
  </h3>
</div>

  </div>
  <div class="body"><p>Internal reference to node.</p>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>        <span class="k">this</span><span class="p">.</span><span class="nx">node</span> <span class="o">=</span> <span class="nx">node</span><span class="p">;</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="name">
  <h3>
    <a href="#name" class="pilcrow">&#182;</a>
    name
  </h3>
</div>

  </div>
  <div class="body"><p>Internal name of the timer.</p>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>        <span class="k">this</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">name</span> <span class="o">||</span> <span class="s1">&#39;timer_&#39;</span> <span class="o">+</span> <span class="nx">J</span><span class="p">.</span><span class="nx">randomInt</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1000000</span><span class="p">);</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="gametimer.status">
  <h3>
    <a href="#gametimer.status" class="pilcrow">&#182;</a>
    GameTimer.status
  </h3>
</div>

  </div>
  <div class="body"><p>Numerical index keeping the current the state of the GameTimer obj.</p>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>        <span class="k">this</span><span class="p">.</span><span class="nx">status</span> <span class="o">=</span> <span class="nx">GameTimer</span><span class="p">.</span><span class="nx">UNINITIALIZED</span><span class="p">;</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="gametimer.options">
  <h3>
    <a href="#gametimer.options" class="pilcrow">&#182;</a>
    GameTimer.options
  </h3>
</div>

  </div>
  <div class="body"><p>The current settings for the GameTimer.</p>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>        <span class="k">this</span><span class="p">.</span><span class="nx">options</span> <span class="o">=</span> <span class="nx">options</span><span class="p">;</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="gametimer.timerid">
  <h3>
    <a href="#gametimer.timerid" class="pilcrow">&#182;</a>
    GameTimer.timerId
  </h3>
</div>

  </div>
  <div class="body"><p>The ID of the javascript interval.</p>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>        <span class="k">this</span><span class="p">.</span><span class="nx">timerId</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="gametimer.timeleft">
  <h3>
    <a href="#gametimer.timeleft" class="pilcrow">&#182;</a>
    GameTimer.timeLeft
  </h3>
</div>

  </div>
  <div class="body"><p>Milliseconds left before time is up.</p>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>        <span class="k">this</span><span class="p">.</span><span class="nx">timeLeft</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="gametimer.timepassed">
  <h3>
    <a href="#gametimer.timepassed" class="pilcrow">&#182;</a>
    GameTimer.timePassed
  </h3>
</div>

  </div>
  <div class="body"><p>Milliseconds already passed from the start of the timer.</p>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>        <span class="k">this</span><span class="p">.</span><span class="nx">timePassed</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="gametimer.update">
  <h3>
    <a href="#gametimer.update" class="pilcrow">&#182;</a>
    GameTimer.update
  </h3>
</div>

  </div>
  <div class="body"><p>The frequency of update for the timer (in milliseconds).</p>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>        <span class="k">this</span><span class="p">.</span><span class="nx">update</span> <span class="o">=</span> <span class="kc">undefined</span><span class="p">;</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="gametimer.updateremaining">
  <h3>
    <a href="#gametimer.updateremaining" class="pilcrow">&#182;</a>
    GameTimer.updateRemaining
  </h3>
</div>

  </div>
  <div class="body"><p>Milliseconds remaining for current update.</p>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>        <span class="k">this</span><span class="p">.</span><span class="nx">updateRemaining</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="gametimer.updatestart">
  <h3>
    <a href="#gametimer.updatestart" class="pilcrow">&#182;</a>
    GameTimer.updateStart
  </h3>
</div>

  </div>
  <div class="body"><p>Timestamp of the start of the last update</p>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>        <span class="k">this</span><span class="p">.</span><span class="nx">updateStart</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="gametimer.startpaused">
  <h3>
    <a href="#gametimer.startpaused" class="pilcrow">&#182;</a>
    GameTimer.startPaused
  </h3>
</div>

  </div>
  <div class="body"><p>Whether to enter the pause state when starting</p>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>        <span class="k">this</span><span class="p">.</span><span class="nx">startPaused</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="gametimer.timeup">
  <h3>
    <a href="#gametimer.timeup" class="pilcrow">&#182;</a>
    GameTimer.timeup
  </h3>
</div>

  </div>
  <div class="body"><p>Event string or function to fire when the time is up</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">GameTimer.fire
  </span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>        <span class="k">this</span><span class="p">.</span><span class="nx">timeup</span> <span class="o">=</span> <span class="s1">&#39;TIMEUP&#39;</span><span class="p">;</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="gametimer.hooks">
  <h3>
    <a href="#gametimer.hooks" class="pilcrow">&#182;</a>
    GameTimer.hooks
  </h3>
</div>

  </div>
  <div class="body"><p>Array of hook functions to fire at every update</p>

<p>The array works as a LIFO queue</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">GameTimer.fire
  </span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>        <span class="k">this</span><span class="p">.</span><span class="nx">hooks</span> <span class="o">=</span> <span class="p">[];</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="gametimer.hooknames">
  <h3>
    <a href="#gametimer.hooknames" class="pilcrow">&#182;</a>
    GameTimer.hookNames
  </h3>
</div>

  </div>
  <div class="body"><p>Object containing all names used for the hooks</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">GameTimer.hooks
  </span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>        <span class="k">this</span><span class="p">.</span><span class="nx">hookNames</span> <span class="o">=</span> <span class="p">{};</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-58" id="section-58">&#182;</a>
</div>
<p>Init!</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>        <span class="k">this</span><span class="p">.</span><span class="nx">init</span><span class="p">();</span>
    <span class="p">}</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="gametimer-methods">
  <h2>
    <a href="#gametimer-methods" class="pilcrow">&#182;</a>
    GameTimer methods
  </h2>
</div>

        </td>
        <td class="code highlight"><div class="highlight"><pre></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="gametimer.init">
  <h3>
    <a href="#gametimer.init" class="pilcrow">&#182;</a>
    GameTimer.init
  </h3>
</div>

  </div>
  <div class="body"><p>Inits the GameTimer</p>

<p>Takes the configuration as an input parameter or
recycles the settings in <code>this.options</code>.</p>

<p>The configuration object is of the type</p>

<p>var options = {
     // The length of the interval.
     milliseconds: 4000,
     // How often to update the time counter. Default: milliseconds
     update: 1000,
     // An event or function to fire when the timer expires.
     timeup: 'MY_EVENT',
     hooks: [
             // Array of functions or events to fire at every update.
             myFunc,
             'MY_EVENT_UPDATE',
             { hook: myFunc2,
               ctx: that, },
             ],
 }
 // Units are in milliseconds.</p>

<p>Note: if <code>milliseconds</code> is a negative number the timer fire
immediately.</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">options</span>
      <span class="dox_type">object</span>
      <span>Optional. Configuration object</span>
    </div>
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">GameTimer.addHook
  </span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>    <span class="nx">GameTimer</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">init</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">len</span><span class="p">;</span>
        <span class="nx">options</span> <span class="o">=</span> <span class="nx">options</span> <span class="o">||</span> <span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">;</span>

        <span class="k">this</span><span class="p">.</span><span class="nx">status</span> <span class="o">=</span> <span class="nx">GameTimer</span><span class="p">.</span><span class="nx">UNINITIALIZED</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">timerId</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">clearInterval</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">timerId</span><span class="p">);</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">timerId</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">milliseconds</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">milliseconds</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">update</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">update</span> <span class="o">||</span> <span class="k">this</span><span class="p">.</span><span class="nx">update</span> <span class="o">||</span> <span class="k">this</span><span class="p">.</span><span class="nx">milliseconds</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">timeLeft</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">milliseconds</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">timePassed</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">updateStart</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">updateRemaining</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-61" id="section-61">&#182;</a>
</div>
<p>Event to be fired when timer expires.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>        <span class="k">this</span><span class="p">.</span><span class="nx">timeup</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">timeup</span> <span class="o">||</span> <span class="s1">&#39;TIMEUP&#39;</span><span class="p">;</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-62" id="section-62">&#182;</a>
</div>
<p>TODO: update and milliseconds must be multiple now</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>        <span class="k">if</span> <span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">hooks</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">len</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">hooks</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
            <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">len</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">addHook</span><span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">hooks</span><span class="p">[</span><span class="nx">i</span><span class="p">]);</span>
            <span class="p">}</span>
        <span class="p">}</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-63" id="section-63">&#182;</a>
</div>
<p>Set startPaused option. if specified. Default: FALSE</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>        <span class="k">this</span><span class="p">.</span><span class="nx">startPaused</span> <span class="o">=</span> <span class="s1">&#39;undefined&#39;</span> <span class="o">!==</span> <span class="nx">options</span><span class="p">.</span><span class="nx">startPaused</span> <span class="o">?</span>
            <span class="nx">options</span><span class="p">.</span><span class="nx">startPaused</span> <span class="o">:</span> <span class="kc">false</span><span class="p">;</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-64" id="section-64">&#182;</a>
</div>
<p>Only set status to INITIALIZED if all of the state is valid and
ready to be used by this.start etc.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>        <span class="k">if</span> <span class="p">(</span><span class="nx">checkInitialized</span><span class="p">(</span><span class="k">this</span><span class="p">)</span> <span class="o">===</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">status</span> <span class="o">=</span> <span class="nx">GameTimer</span><span class="p">.</span><span class="nx">INITIALIZED</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">};</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="gametimer.fire">
  <h3>
    <a href="#gametimer.fire" class="pilcrow">&#182;</a>
    GameTimer.fire
  </h3>
</div>

  </div>
  <div class="body"><p>Fires a registered hook</p>

<p>If it is a string it is emitted as an event,
otherwise it called as a function.</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">h</span>
      <span class="dox_type">mixed</span>
      <span>The hook to fire</span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>    <span class="nx">GameTimer</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">fire</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">h</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">hook</span><span class="p">,</span> <span class="nx">ctx</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">h</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">&#39;GameTimer.fire: missing argument&#39;</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="nx">hook</span> <span class="o">=</span> <span class="nx">h</span><span class="p">.</span><span class="nx">hook</span> <span class="o">||</span> <span class="nx">h</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;function&#39;</span> <span class="o">===</span> <span class="k">typeof</span> <span class="nx">hook</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">ctx</span> <span class="o">=</span> <span class="nx">h</span><span class="p">.</span><span class="nx">ctx</span> <span class="o">||</span> <span class="k">this</span><span class="p">.</span><span class="nx">node</span><span class="p">.</span><span class="nx">game</span><span class="p">;</span>
            <span class="nx">hook</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">ctx</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">node</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="nx">hook</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">};</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="gametimer.start">
  <h3>
    <a href="#gametimer.start" class="pilcrow">&#182;</a>
    GameTimer.start
  </h3>
</div>

  </div>
  <div class="body"><p>Starts the timer</p>

<p>Updates the status of the timer and calls <code>setInterval</code>
At every update all the registered hooks are fired, and
time left is checked.</p>

<p>When the timer expires the timeup event is fired, and the
timer is stopped</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">GameTimer.status</span>
    </div>
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">GameTimer.timeup</span>
    </div>
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">GameTimer.fire
  </span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>    <span class="nx">GameTimer</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">start</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">error</span><span class="p">,</span> <span class="nx">that</span><span class="p">;</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-67" id="section-67">&#182;</a>
</div>
<p>Check validity of state</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>        <span class="nx">error</span> <span class="o">=</span> <span class="nx">checkInitialized</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">error</span> <span class="o">!==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">&#39;GameTimer.start: &#39;</span> <span class="o">+</span> <span class="nx">error</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">isRunning</span><span class="p">())</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">&#39;GameTimer.start: timer is already running.&#39;</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">this</span><span class="p">.</span><span class="nx">status</span> <span class="o">=</span> <span class="nx">GameTimer</span><span class="p">.</span><span class="nx">LOADING</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">startPaused</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">pause</span><span class="p">();</span>
            <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-68" id="section-68">&#182;</a>
</div>
<p>Remember time of start (used by this.pause to compute remaining time)</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>        <span class="k">this</span><span class="p">.</span><span class="nx">updateStart</span> <span class="o">=</span> <span class="p">(</span><span class="k">new</span> <span class="nb">Date</span><span class="p">()).</span><span class="nx">getTime</span><span class="p">();</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-69" id="section-69">&#182;</a>
</div>
<p>Fires the event immediately if time is zero.
Double check necessary in strict mode.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>        <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;undefined&#39;</span> <span class="o">!==</span> <span class="k">typeof</span> <span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">milliseconds</span> <span class="o">&amp;&amp;</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">milliseconds</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">stop</span><span class="p">();</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">fire</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">timeup</span><span class="p">);</span>
            <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">this</span><span class="p">.</span><span class="nx">updateRemaining</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">update</span><span class="p">;</span>

        <span class="nx">that</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-70" id="section-70">&#182;</a>
</div>
<p>It is not possible to pass extra parameters to updateCallback,
by adding them after <em>this.update</em>. In IE does not work.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>        <span class="k">this</span><span class="p">.</span><span class="nx">timerId</span> <span class="o">=</span> <span class="nx">setInterval</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="nx">updateCallback</span><span class="p">(</span><span class="nx">that</span><span class="p">);</span>
        <span class="p">},</span> <span class="k">this</span><span class="p">.</span><span class="nx">update</span><span class="p">);</span>
    <span class="p">};</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="gametimer.addhook">
  <h3>
    <a href="#gametimer.addhook" class="pilcrow">&#182;</a>
    GameTimer.addHook
  </h3>
</div>

  </div>
  <div class="body"><p>Add an hook to the hook list after performing conformity checks.
The first parameter hook can be a string, a function, or an object
containing an hook property.</p>
  </div>
  <div class="details">
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>    <span class="nx">GameTimer</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">addHook</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">hook</span><span class="p">,</span> <span class="nx">ctx</span><span class="p">,</span> <span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">i</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">hook</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">&#39;GameTimer.addHook: missing argument&#39;</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="nx">ctx</span> <span class="o">=</span> <span class="nx">ctx</span> <span class="o">||</span> <span class="k">this</span><span class="p">.</span><span class="nx">node</span><span class="p">.</span><span class="nx">game</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">hook</span><span class="p">.</span><span class="nx">hook</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">ctx</span> <span class="o">=</span> <span class="nx">hook</span><span class="p">.</span><span class="nx">ctx</span> <span class="o">||</span> <span class="nx">ctx</span><span class="p">;</span>
            <span class="k">if</span><span class="p">(</span><span class="nx">hook</span><span class="p">.</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">name</span> <span class="o">=</span> <span class="nx">hook</span><span class="p">.</span><span class="nx">name</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="nx">hook</span> <span class="o">=</span> <span class="nx">hook</span><span class="p">.</span><span class="nx">hook</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">name</span> <span class="o">=</span> <span class="nx">JSUS</span><span class="p">.</span><span class="nx">uniqueKey</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">hookNames</span><span class="p">,</span><span class="s1">&#39;timerHook&#39;</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">hooks</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">hooks</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">name</span> <span class="o">===</span> <span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">hookNames</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">hooks</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span><span class="nx">hook</span><span class="o">:</span> <span class="nx">hook</span><span class="p">,</span> <span class="nx">ctx</span><span class="o">:</span> <span class="nx">ctx</span><span class="p">,</span> <span class="nx">name</span><span class="o">:</span> <span class="nx">name</span><span class="p">});</span>
        <span class="k">return</span> <span class="nx">name</span><span class="p">;</span>
    <span class="p">};</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="gametimer.removehook">
  <h3>
    <a href="#gametimer.removehook" class="pilcrow">&#182;</a>
    GameTimer.removeHook
  </h3>
</div>

  </div>
  <div class="body"><p>Removes a hook given its' name</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">name</span>
      <span class="dox_type">string</span>
      <span>Name of the hook to be removed</span>
    </div>
    <div class="dox_tag_title">Returns</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name"></span>
      <span class="dox_type">mixed</span>
      <span>the hook if it was removed; false otherwise.</span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>    <span class="nx">GameTimer</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">removeHook</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">i</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">hookNames</span><span class="p">[</span><span class="nx">name</span><span class="p">])</span> <span class="p">{</span>
            <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">hooks</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">hooks</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">name</span> <span class="o">===</span> <span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">delete</span> <span class="k">this</span><span class="p">.</span><span class="nx">hookNames</span><span class="p">[</span><span class="nx">name</span><span class="p">];</span>
                    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">hooks</span><span class="p">.</span><span class="nx">splice</span><span class="p">(</span><span class="nx">i</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
    <span class="p">};</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="gametimer.pause">
  <h3>
    <a href="#gametimer.pause" class="pilcrow">&#182;</a>
    GameTimer.pause
  </h3>
</div>

  </div>
  <div class="body"><p>Pauses the timer</p>

<p>If the timer was running, clear the interval and sets the
status property to <code>GameTimer.PAUSED</code>.</p>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>    <span class="nx">GameTimer</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">pause</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">timestamp</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">isRunning</span><span class="p">())</span> <span class="p">{</span>
            <span class="nx">clearInterval</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">timerId</span><span class="p">);</span>
            <span class="nx">clearTimeout</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">timerId</span><span class="p">);</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">timerId</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>

            <span class="k">this</span><span class="p">.</span><span class="nx">status</span> <span class="o">=</span> <span class="nx">GameTimer</span><span class="p">.</span><span class="nx">PAUSED</span><span class="p">;</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-74" id="section-74">&#182;</a>
</div>
<p>Save time of pausing.
If start was never called, or called with startPaused on.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>            <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">updateStart</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">updateRemaining</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">update</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">else</span> <span class="p">{</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-75" id="section-75">&#182;</a>
</div>
<p>Save the difference of time left.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>                <span class="nx">timestamp</span> <span class="o">=</span> <span class="p">(</span><span class="k">new</span> <span class="nb">Date</span><span class="p">()).</span><span class="nx">getTime</span><span class="p">();</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">updateRemaining</span> <span class="o">=</span>
                    <span class="k">this</span><span class="p">.</span><span class="nx">update</span> <span class="o">-</span> <span class="p">(</span><span class="nx">timestamp</span> <span class="o">-</span> <span class="k">this</span><span class="p">.</span><span class="nx">updateStart</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">status</span> <span class="o">===</span> <span class="nx">GameTimer</span><span class="p">.</span><span class="nx">STOPPED</span><span class="p">)</span> <span class="p">{</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-76" id="section-76">&#182;</a>
</div>
<p>If the timer was explicitly stopped, we ignore the pause:</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>            <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">isPaused</span><span class="p">())</span> <span class="p">{</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-77" id="section-77">&#182;</a>
</div>
<p>pause() was called before start(); remember it:</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>            <span class="k">this</span><span class="p">.</span><span class="nx">startPaused</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">&#39;GameTimer.pause: timer was already paused&#39;</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">};</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="gametimer.resume">
  <h3>
    <a href="#gametimer.resume" class="pilcrow">&#182;</a>
    GameTimer.resume
  </h3>
</div>

  </div>
  <div class="body"><p>Resumes a paused timer</p>

<p>If the timer was paused, restarts it with the current configuration</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">GameTimer.restart
  </span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>    <span class="nx">GameTimer</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">resume</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">that</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-79" id="section-79">&#182;</a>
</div>
<p>Don't start if the initialization is incomplete (invalid state):</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">status</span> <span class="o">===</span> <span class="nx">GameTimer</span><span class="p">.</span><span class="nx">UNINITIALIZED</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">startPaused</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
            <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">isPaused</span><span class="p">()</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">startPaused</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">&#39;GameTimer.resume: timer was not paused&#39;</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">this</span><span class="p">.</span><span class="nx">status</span> <span class="o">=</span> <span class="nx">GameTimer</span><span class="p">.</span><span class="nx">LOADING</span><span class="p">;</span>

        <span class="k">this</span><span class="p">.</span><span class="nx">startPaused</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>

        <span class="k">this</span><span class="p">.</span><span class="nx">updateStart</span> <span class="o">=</span> <span class="p">(</span><span class="k">new</span> <span class="nb">Date</span><span class="p">()).</span><span class="nx">getTime</span><span class="p">();</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-80" id="section-80">&#182;</a>
</div>
<p>Run rest of this "update" interval:</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>        <span class="k">this</span><span class="p">.</span><span class="nx">timerId</span> <span class="o">=</span> <span class="nx">setTimeout</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">updateCallback</span><span class="p">(</span><span class="nx">that</span><span class="p">))</span> <span class="p">{</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-81" id="section-81">&#182;</a>
</div>
<p>start() needs the timer to not be running.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>                <span class="nx">that</span><span class="p">.</span><span class="nx">status</span> <span class="o">=</span> <span class="nx">GameTimer</span><span class="p">.</span><span class="nx">INITIALIZED</span><span class="p">;</span>

                <span class="nx">that</span><span class="p">.</span><span class="nx">start</span><span class="p">();</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-82" id="section-82">&#182;</a>
</div>
<p>start() sets status to LOADING, so change it back to RUNNING.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>                <span class="nx">that</span><span class="p">.</span><span class="nx">status</span> <span class="o">=</span> <span class="nx">GameTimer</span><span class="p">.</span><span class="nx">RUNNING</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">},</span> <span class="k">this</span><span class="p">.</span><span class="nx">updateRemaining</span><span class="p">);</span>
    <span class="p">};</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="gametimer.stop">
  <h3>
    <a href="#gametimer.stop" class="pilcrow">&#182;</a>
    GameTimer.stop
  </h3>
</div>

  </div>
  <div class="body"><p>Stops the timer</p>

<p>If the timer was paused or running, clear the interval, sets the
status property to <code>GameTimer.STOPPED</code>, and reset the time passed
and time left properties</p>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>    <span class="nx">GameTimer</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">stop</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">isStopped</span><span class="p">())</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">&#39;GameTimer.stop: timer was not running&#39;</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">this</span><span class="p">.</span><span class="nx">status</span> <span class="o">=</span> <span class="nx">GameTimer</span><span class="p">.</span><span class="nx">STOPPED</span><span class="p">;</span>
        <span class="nx">clearInterval</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">timerId</span><span class="p">);</span>
        <span class="nx">clearTimeout</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">timerId</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">timerId</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">timePassed</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">timeLeft</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
    <span class="p">};</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="gametimer.restart">
  <h3>
    <a href="#gametimer.restart" class="pilcrow">&#182;</a>
    GameTimer.restart
  </h3>
</div>

  </div>
  <div class="body"><p>Restarts the timer</p>

<p>Uses the input parameter as configuration object,
or the current settings, if undefined</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">options</span>
      <span class="dox_type">object</span>
      <span>Optional. A configuration object</span>
    </div>
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">GameTimer.init
  </span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>    <span class="nx">GameTimer</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">restart</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">isStopped</span><span class="p">())</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">stop</span><span class="p">();</span>
        <span class="p">}</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">init</span><span class="p">(</span><span class="nx">options</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">start</span><span class="p">();</span>
    <span class="p">};</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="gametimer.isrunning">
  <h3>
    <a href="#gametimer.isrunning" class="pilcrow">&#182;</a>
    GameTimer.isRunning
  </h3>
</div>

  </div>
  <div class="body"><p>Returns whether timer is running</p>

<p>Running means either LOADING or RUNNING.</p>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>    <span class="nx">GameTimer</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">isRunning</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">status</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">);</span>
    <span class="p">};</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="gametimer.isstopped">
  <h3>
    <a href="#gametimer.isstopped" class="pilcrow">&#182;</a>
    GameTimer.isStopped
  </h3>
</div>

  </div>
  <div class="body"><p>Returns whether timer is stopped</p>

<p>Stopped means either UNINITIALIZED, INITIALIZED or STOPPED.</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">GameTimer.isPaused
  </span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>    <span class="nx">GameTimer</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">isStopped</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">status</span> <span class="o">===</span> <span class="nx">GameTimer</span><span class="p">.</span><span class="nx">UNINITIALIZED</span> <span class="o">||</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">status</span> <span class="o">===</span> <span class="nx">GameTimer</span><span class="p">.</span><span class="nx">INITIALIZED</span> <span class="o">||</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">status</span> <span class="o">===</span> <span class="nx">GameTimer</span><span class="p">.</span><span class="nx">STOPPED</span><span class="p">)</span> <span class="p">{</span>

            <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="p">{</span>
            <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">};</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="gametimer.ispaused">
  <h3>
    <a href="#gametimer.ispaused" class="pilcrow">&#182;</a>
    GameTimer.isPaused
  </h3>
</div>

  </div>
  <div class="body"><p>Returns whether timer is paused</p>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>    <span class="nx">GameTimer</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">isPaused</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">status</span> <span class="o">===</span> <span class="nx">GameTimer</span><span class="p">.</span><span class="nx">PAUSED</span><span class="p">;</span>
    <span class="p">};</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-88" id="section-88">&#182;</a>
</div>
<p>Do a timer update.
Return false if timer ran out, true otherwise.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>    <span class="kd">function</span> <span class="nx">updateCallback</span><span class="p">(</span><span class="nx">that</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">that</span><span class="p">.</span><span class="nx">status</span> <span class="o">=</span> <span class="nx">GameTimer</span><span class="p">.</span><span class="nx">RUNNING</span><span class="p">;</span>
        <span class="nx">that</span><span class="p">.</span><span class="nx">timePassed</span> <span class="o">+=</span> <span class="nx">that</span><span class="p">.</span><span class="nx">update</span><span class="p">;</span>
        <span class="nx">that</span><span class="p">.</span><span class="nx">timeLeft</span> <span class="o">-=</span> <span class="nx">that</span><span class="p">.</span><span class="nx">update</span><span class="p">;</span>
        <span class="nx">that</span><span class="p">.</span><span class="nx">updateStart</span> <span class="o">=</span> <span class="p">(</span><span class="k">new</span> <span class="nb">Date</span><span class="p">()).</span><span class="nx">getTime</span><span class="p">();</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-89" id="section-89">&#182;</a>
</div>
<p>Fire custom hooks from the latest to the first if any</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>        <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="nx">that</span><span class="p">.</span><span class="nx">hooks</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span><span class="o">--</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">that</span><span class="p">.</span><span class="nx">fire</span><span class="p">(</span><span class="nx">that</span><span class="p">.</span><span class="nx">hooks</span><span class="p">[(</span><span class="nx">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)]);</span>
        <span class="p">}</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-90" id="section-90">&#182;</a>
</div>
<p>Fire Timeup Event</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>        <span class="k">if</span> <span class="p">(</span><span class="nx">that</span><span class="p">.</span><span class="nx">timeLeft</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-91" id="section-91">&#182;</a>
</div>
<p>First stop the timer and then call the timeup</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>            <span class="nx">that</span><span class="p">.</span><span class="nx">stop</span><span class="p">();</span>
            <span class="nx">that</span><span class="p">.</span><span class="nx">fire</span><span class="p">(</span><span class="nx">that</span><span class="p">.</span><span class="nx">timeup</span><span class="p">);</span>
            <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="p">{</span>
            <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-92" id="section-92">&#182;</a>
</div>
<p>Check whether the timer has a valid initialized state.
Returns null if true, an error string otherwise.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>    <span class="kd">function</span> <span class="nx">checkInitialized</span><span class="p">(</span><span class="nx">that</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;number&#39;</span> <span class="o">!==</span> <span class="k">typeof</span> <span class="nx">that</span><span class="p">.</span><span class="nx">milliseconds</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="s1">&#39;this.milliseconds must be a number&#39;</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">that</span><span class="p">.</span><span class="nx">update</span> <span class="o">&gt;</span> <span class="nx">that</span><span class="p">.</span><span class="nx">milliseconds</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="s1">&#39;this.update must not be greater than this.milliseconds&#39;</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
    <span class="p">}</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="closure">
  <h2>
    <a href="#closure" class="pilcrow">&#182;</a>
    Closure
  </h2>
</div>

        </td>
        <td class="code highlight"><div class="highlight"><pre><span class="p">})(</span>
    <span class="s1">&#39;undefined&#39;</span> <span class="o">!=</span> <span class="k">typeof</span> <span class="nx">node</span> <span class="o">?</span> <span class="nx">node</span> <span class="o">:</span> <span class="nx">module</span><span class="p">.</span><span class="nx">exports</span><span class="p">,</span>
    <span class="s1">&#39;undefined&#39;</span> <span class="o">!=</span> <span class="k">typeof</span> <span class="nx">node</span> <span class="o">?</span> <span class="nx">node</span> <span class="o">:</span> <span class="nx">module</span><span class="p">.</span><span class="nx">parent</span><span class="p">.</span><span class="nx">exports</span>
<span class="p">);</span>
</pre></div>
        </td>
      </tr>
  </tbody>
</table>
  </div>
</body>
</html>
