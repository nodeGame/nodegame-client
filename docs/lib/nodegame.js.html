<!DOCTYPE html>
<html>
<head>
  <title>nodegame.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="../doc-style.css" />
  <script src="../doc-filelist.js"></script>
  <script>
    var relativeDir = '../', thisFile = 'lib/nodegame.js', defaultSidebar = true;
  </script>
  <script src="../doc-script.js"></script>
</head>
<body>
  <div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">
      <div class="heading h1">
        <a href="#nodegame">nodeGame</a>
      </div>
      <div class="heading h2">
        <a href="#methods">Methods</a>
      </div>
      <div class="heading h3">
        <a href="#nove.env">nove.env</a>
      </div>
      <div class="heading h3">
        <a href="#node.createplayer">node.createPlayer</a>
      </div>
      <div class="heading h3">
        <a href="#node.connect">node.connect</a>
      </div>
      <div class="heading h3">
        <a href="#node.play">node.play</a>
      </div>
      <div class="heading h3">
        <a href="#node.replay">node.replay</a>
      </div>
      <div class="heading h3">
        <a href="#node.emit">node.emit</a>
      </div>
      <div class="heading h3">
        <a href="#node.say">node.say</a>
      </div>
      <div class="heading h3">
        <a href="#node.set">node.set</a>
      </div>
      <div class="heading h3">
        <a href="#node.get">node.get</a>
      </div>
      <div class="heading h3">
        <a href="#node.on">node.on</a>
      </div>
      <div class="heading h3">
        <a href="#node.once">node.once</a>
      </div>
      <div class="heading h3">
        <a href="#node.off">node.off</a>
      </div>
      <div class="heading h3">
        <a href="#node.redirect">node.redirect</a>
      </div>
    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container"><div class="background highlight"></div>
<table cellpadding="0" cellspacing="0">
  <tbody>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="nodegame">
  <h1>
    <a href="#nodegame" class="pilcrow">&#182;</a>
    nodeGame
  </h1>
</div>

  </div>
  <div class="body"><p>Social Experiments in the Browser</p>

<p>Copyright(c) 2012 Stefano Balietti MIT Licensed</p>

<p><em>nodeGame</em> is a free, open source, event-driven javascript framework for on
line, multiplayer games in the browser.</p>

<hr />
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">exports</span><span class="p">,</span> <span class="nx">node</span><span class="p">)</span> <span class="p">{</span>
    
  <span class="kd">var</span> <span class="nx">EventEmitter</span> <span class="o">=</span> <span class="nx">node</span><span class="p">.</span><span class="nx">EventEmitter</span><span class="p">,</span>
    <span class="nx">Socket</span> <span class="o">=</span> <span class="nx">node</span><span class="p">.</span><span class="nx">Socket</span><span class="p">,</span>
    <span class="nx">GameState</span> <span class="o">=</span> <span class="nx">node</span><span class="p">.</span><span class="nx">GameState</span><span class="p">,</span>
    <span class="nx">GameMsg</span> <span class="o">=</span> <span class="nx">node</span><span class="p">.</span><span class="nx">GameMsg</span><span class="p">,</span>
    <span class="nx">Game</span> <span class="o">=</span> <span class="nx">node</span><span class="p">.</span><span class="nx">Game</span><span class="p">,</span>
    <span class="nx">Player</span> <span class="o">=</span> <span class="nx">node</span><span class="p">.</span><span class="nx">Player</span><span class="p">,</span>
    <span class="nx">GameSession</span> <span class="o">=</span> <span class="nx">node</span><span class="p">.</span><span class="nx">GameSession</span><span class="p">,</span>
    <span class="nx">J</span> <span class="o">=</span> <span class="nx">node</span><span class="p">.</span><span class="nx">JSUS</span><span class="p">;</span>  </pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-2" id="section-2">&#182;</a>
</div>
<!-- object commented in index.js -->
        </td>
        <td class="code highlight"><div class="highlight"><pre>  <span class="nx">node</span><span class="p">.</span><span class="nx">events</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">EventEmitter</span><span class="p">();</span>

  <span class="nx">node</span><span class="p">.</span><span class="nx">msg</span>  <span class="o">=</span> <span class="nx">node</span><span class="p">.</span><span class="nx">GameMsgGenerator</span><span class="p">;</span>  
  
  <span class="nx">node</span><span class="p">.</span><span class="nx">session</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">GameSession</span><span class="p">();</span>
  
  <span class="nx">node</span><span class="p">.</span><span class="nx">socket</span> <span class="o">=</span> <span class="nx">node</span><span class="p">.</span><span class="nx">gsc</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Socket</span><span class="p">();</span>
  
  </pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="methods">
  <h2>
    <a href="#methods" class="pilcrow">&#182;</a>
    Methods
  </h2>
</div>

        </td>
        <td class="code highlight"><div class="highlight"><pre>  
  </pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="nove.env">
  <h3>
    <a href="#nove.env" class="pilcrow">&#182;</a>
    nove.env
  </h3>
</div>

  </div>
  <div class="body"><p>Executes a block of code conditionally to nodeGame environment variables  </p>
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span>{string}</span>
      <span class="dox_type">env</span>
      <span>The name of the environment</span>
    </div>
    <div class="dox_tag_detail">
      <span>{function}</span>
      <span class="dox_type">func</span>
      <span>The callback function to execute</span>
    </div>
    <div class="dox_tag_detail">
      <span>{object}</span>
      <span class="dox_type">ctx</span>
      <span>Optional. The context of execution</span>
    </div>
    <div class="dox_tag_detail">
      <span>{array}</span>
      <span class="dox_type">params</span>
      <span>Optional. An array of additional parameters for the callback</span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>  <span class="nx">node</span><span class="p">.</span><span class="nx">env</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">env</span><span class="p">,</span> <span class="nx">func</span><span class="p">,</span> <span class="nx">ctx</span><span class="p">,</span> <span class="nx">params</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">env</span> <span class="o">||</span> <span class="o">!</span><span class="nx">func</span> <span class="o">||</span> <span class="o">!</span><span class="nx">node</span><span class="p">.</span><span class="nx">env</span><span class="p">[</span><span class="nx">env</span><span class="p">])</span> <span class="k">return</span><span class="p">;</span>
    <span class="nx">ctx</span> <span class="o">=</span> <span class="nx">ctx</span> <span class="o">||</span> <span class="nx">node</span><span class="p">;</span>
    <span class="nx">params</span> <span class="o">=</span> <span class="nx">params</span> <span class="o">||</span> <span class="p">[];</span>
    <span class="nx">func</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span> <span class="nx">params</span><span class="p">);</span>
  <span class="p">};</span>
  
    </pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="node.createplayer">
  <h3>
    <a href="#node.createplayer" class="pilcrow">&#182;</a>
    node.createPlayer
  </h3>
</div>

  </div>
  <div class="body"><p>Mixes in default properties for the player object and
additional configuration variables from node.conf.player</p>

<p>Writes the node.player object</p>

<p>Properties: <code>id</code>, <code>sid</code>, <code>ip</code> can never be overwritten.</p>

<p>Properties added as local configuration cannot be further
modified during the game. </p>

<p>Only the property <code>name</code>, can be changed.</p>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>  <span class="nx">node</span><span class="p">.</span><span class="nx">createPlayer</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">player</span><span class="p">)</span> <span class="p">{</span>
    
    <span class="nx">player</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Player</span><span class="p">(</span><span class="nx">player</span><span class="p">);</span>
    
    <span class="k">if</span> <span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">conf</span> <span class="o">&amp;&amp;</span> <span class="nx">node</span><span class="p">.</span><span class="nx">conf</span><span class="p">.</span><span class="nx">player</span><span class="p">)</span> <span class="p">{</span>      
      <span class="kd">var</span> <span class="nx">pconf</span> <span class="o">=</span> <span class="nx">node</span><span class="p">.</span><span class="nx">conf</span><span class="p">.</span><span class="nx">player</span><span class="p">;</span>
      <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">key</span> <span class="k">in</span> <span class="nx">pconf</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">pconf</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">key</span><span class="p">))</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">JSUS</span><span class="p">.</span><span class="nx">in_array</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;sid&#39;</span><span class="p">,</span> <span class="s1">&#39;ip&#39;</span><span class="p">]))</span> <span class="p">{</span>
            <span class="k">continue</span><span class="p">;</span>
          <span class="p">}</span> 
          </pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-6" id="section-6">&#182;</a>
</div>
<p>Cannot be overwritten properties previously 
set in other sessions (recovery)
                    if (player.hasOwnProperty(key)) {
                        continue;
                    }</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>          <span class="k">if</span> <span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">support</span><span class="p">.</span><span class="nx">defineProperty</span><span class="p">)</span> <span class="p">{</span>
            <span class="nb">Object</span><span class="p">.</span><span class="nx">defineProperty</span><span class="p">(</span><span class="nx">player</span><span class="p">,</span> <span class="nx">key</span><span class="p">,</span> <span class="p">{</span>
                <span class="nx">value</span><span class="o">:</span> <span class="nx">pconf</span><span class="p">[</span><span class="nx">key</span><span class="p">],</span>
                <span class="nx">enumerable</span><span class="o">:</span> <span class="kc">true</span>
            <span class="p">});</span>
          <span class="p">}</span>
          <span class="k">else</span> <span class="p">{</span>
            <span class="nx">player</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="nx">pconf</span><span class="p">[</span><span class="nx">key</span><span class="p">];</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}</span>
    
    
    <span class="k">if</span> <span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">support</span><span class="p">.</span><span class="nx">defineProperty</span><span class="p">)</span> <span class="p">{</span>
      <span class="nb">Object</span><span class="p">.</span><span class="nx">defineProperty</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="s1">&#39;player&#39;</span><span class="p">,</span> <span class="p">{</span>
          <span class="nx">value</span><span class="o">:</span> <span class="nx">player</span><span class="p">,</span>
          <span class="nx">enumerable</span><span class="o">:</span> <span class="kc">true</span>
      <span class="p">});</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="p">{</span>
      <span class="nx">node</span><span class="p">.</span><span class="nx">player</span> <span class="o">=</span> <span class="nx">player</span><span class="p">;</span>
    <span class="p">}</span>
    
    <span class="nx">node</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="s1">&#39;PLAYER_CREATED&#39;</span><span class="p">,</span> <span class="nx">player</span><span class="p">);</span>
    
    <span class="k">return</span> <span class="nx">player</span><span class="p">;</span>
  <span class="p">};</span>  
  </pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="node.connect">
  <h3>
    <a href="#node.connect" class="pilcrow">&#182;</a>
    node.connect
  </h3>
</div>

  </div>
  <div class="body"><p>Establishes a connection with a nodeGame server</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span>conf</span>
      <span class="dox_type">object</span>
      <span>A configuration object</span>
    </div>
    <div class="dox_tag_detail">
      <span>game</span>
      <span class="dox_type">object</span>
      <span>The game object</span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>  <span class="nx">node</span><span class="p">.</span><span class="nx">connect</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">url</span><span class="p">)</span> <span class="p">{</span> 
    <span class="nx">node</span><span class="p">.</span><span class="nx">socket</span><span class="p">.</span><span class="nx">connect</span><span class="p">(</span><span class="nx">url</span><span class="p">);</span>
    <span class="nx">node</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="s1">&#39;NODEGAME_CONNECTED&#39;</span><span class="p">);</span>
  <span class="p">};</span>  

  </pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="node.play">
  <h3>
    <a href="#node.play" class="pilcrow">&#182;</a>
    node.play
  </h3>
</div>

  </div>
  <div class="body"><p>Starts a game</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span>conf</span>
      <span class="dox_type">object</span>
      <span>A configuration object</span>
    </div>
    <div class="dox_tag_detail">
      <span>game</span>
      <span class="dox_type">object</span>
      <span>The game object</span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>  <span class="nx">node</span><span class="p">.</span><span class="nx">play</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">game</span><span class="p">)</span> <span class="p">{</span>  
    
    <span class="nx">node</span><span class="p">.</span><span class="nx">setup</span><span class="p">.</span><span class="nx">game</span><span class="p">(</span><span class="nx">game</span><span class="p">);</span>
    </pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-9" id="section-9">&#182;</a>
</div>
<p>INIT the game</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>    <span class="nx">node</span><span class="p">.</span><span class="nx">game</span><span class="p">.</span><span class="nx">init</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">game</span><span class="p">);</span>
    
    <span class="nx">node</span><span class="p">.</span><span class="nx">game</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">is</span> <span class="o">=</span> <span class="nx">node</span><span class="p">.</span><span class="nx">is</span><span class="p">.</span><span class="nx">LOADED</span><span class="p">;</span>
    <span class="nx">node</span><span class="p">.</span><span class="nx">socket</span><span class="p">.</span><span class="nx">sendSTATE</span><span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">action</span><span class="p">.</span><span class="nx">SAY</span><span class="p">,</span> <span class="nx">node</span><span class="p">.</span><span class="nx">game</span><span class="p">.</span><span class="nx">state</span><span class="p">);</span>
    
    <span class="nx">node</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;game loaded...&#39;</span><span class="p">);</span>
    <span class="nx">node</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;ready.&#39;</span><span class="p">);</span>
  <span class="p">};</span>
  </pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="node.replay">
  <h3>
    <a href="#node.replay" class="pilcrow">&#182;</a>
    node.replay
  </h3>
</div>

  </div>
  <div class="body"><p>Moves the game state to 1.1.1</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span>rest</span>
      <span class="dox_type">boolean</span>
      <span>TRUE, to erase the game memory before update the game state</span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>  <span class="nx">node</span><span class="p">.</span><span class="nx">replay</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">reset</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">reset</span><span class="p">)</span> <span class="nx">node</span><span class="p">.</span><span class="nx">game</span><span class="p">.</span><span class="nx">memory</span><span class="p">.</span><span class="nx">clear</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
    <span class="nx">node</span><span class="p">.</span><span class="kr">goto</span><span class="p">(</span><span class="k">new</span> <span class="nx">GameState</span><span class="p">({</span><span class="nx">state</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">step</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">round</span><span class="o">:</span> <span class="mi">1</span><span class="p">}));</span>
  <span class="p">};</span>  
  
  </pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="node.emit">
  <h3>
    <a href="#node.emit" class="pilcrow">&#182;</a>
    node.emit
  </h3>
</div>

  </div>
  <div class="body"><p>Emits an event locally</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span>event</span>
      <span class="dox_type">string</span>
      <span>The name of the event to emit</span>
    </div>
    <div class="dox_tag_detail">
      <span>p1</span>
      <span class="dox_type">object</span>
      <span>Optional. A parameter to be passed to the listener</span>
    </div>
    <div class="dox_tag_detail">
      <span>p2</span>
      <span class="dox_type">object</span>
      <span>Optional. A parameter to be passed to the listener</span>
    </div>
    <div class="dox_tag_detail">
      <span>p3</span>
      <span class="dox_type">object</span>
      <span>Optional. A parameter to be passed to the listener</span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>  <span class="nx">node</span><span class="p">.</span><span class="nx">emit</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">event</span><span class="p">,</span> <span class="nx">p1</span><span class="p">,</span> <span class="nx">p2</span><span class="p">,</span> <span class="nx">p3</span><span class="p">)</span> <span class="p">{</span>  
    <span class="nx">node</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="nx">event</span><span class="p">,</span> <span class="nx">p1</span><span class="p">,</span> <span class="nx">p2</span><span class="p">,</span> <span class="nx">p3</span><span class="p">);</span>
  <span class="p">};</span>  
  </pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="node.say">
  <h3>
    <a href="#node.say" class="pilcrow">&#182;</a>
    node.say
  </h3>
</div>

  </div>
  <div class="body"><p>Sends a DATA message to a specified recipient</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span>data</span>
      <span class="dox_type">mixed</span>
      <span>The content of the DATA message</span>
    </div>
    <div class="dox_tag_detail">
      <span>what</span>
      <span class="dox_type">string</span>
      <span>The label associated to the message</span>
    </div>
    <div class="dox_tag_detail">
      <span>whom</span>
      <span class="dox_type">string</span>
      <span>Optional. The recipient of the message</span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>  <span class="nx">node</span><span class="p">.</span><span class="nx">say</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">data</span><span class="p">,</span> <span class="nx">what</span><span class="p">,</span> <span class="nx">whom</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">node</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="s1">&#39;out.say.DATA&#39;</span><span class="p">,</span> <span class="nx">data</span><span class="p">,</span> <span class="nx">whom</span><span class="p">,</span> <span class="nx">what</span><span class="p">);</span>
  <span class="p">};</span>
  </pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="node.set">
  <h3>
    <a href="#node.set" class="pilcrow">&#182;</a>
    node.set
  </h3>
</div>

  </div>
  <div class="body"><p>Stores a key-value pair in the server memory</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span>key</span>
      <span class="dox_type">string</span>
      <span>An alphanumeric (must not be unique)</span>
    </div>
    <div class="dox_tag_detail">
      <span>The</span>
      <span class="dox_type">mixed</span>
      <span>value to store (can be of any type)</span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>  <span class="nx">node</span><span class="p">.</span><span class="nx">set</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span> <span class="p">{</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-14" id="section-14">&#182;</a>
</div>
<p>TODO: parameter to say who will get the msg</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>    <span class="nx">node</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="s1">&#39;out.set.DATA&#39;</span><span class="p">,</span> <span class="nx">value</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="nx">key</span><span class="p">);</span>
  <span class="p">};</span>
  </pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="node.get">
  <h3>
    <a href="#node.get" class="pilcrow">&#182;</a>
    node.get
  </h3>
</div>

  </div>
  <div class="body"><p>Sends a GET message to a recipient and listen to the reply </p>
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span>key</span>
      <span class="dox_type">string</span>
      <span>The label of the GET message</span>
    </div>
    <div class="dox_tag_detail">
      <span>func</span>
      <span class="dox_type">function</span>
      <span>The callback function to handle the return message</span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>  <span class="nx">node</span><span class="p">.</span><span class="nx">get</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">func</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">key</span> <span class="o">||</span> <span class="o">!</span><span class="nx">func</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
    
    <span class="nx">node</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="s1">&#39;out.get.DATA&#39;</span><span class="p">,</span> <span class="nx">key</span><span class="p">);</span>
    
    <span class="kd">var</span> <span class="nx">listener</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">msg</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">msg</span><span class="p">.</span><span class="nx">text</span> <span class="o">===</span> <span class="nx">key</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">func</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">game</span><span class="p">,</span> <span class="nx">msg</span><span class="p">.</span><span class="nx">data</span><span class="p">);</span>
        <span class="nx">node</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">remove</span><span class="p">(</span><span class="s1">&#39;in.say.DATA&#39;</span><span class="p">,</span> <span class="nx">listener</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">};</span>
    
    <span class="nx">node</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;in.say.DATA&#39;</span><span class="p">,</span> <span class="nx">listener</span><span class="p">);</span>
  <span class="p">};</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="node.on">
  <h3>
    <a href="#node.on" class="pilcrow">&#182;</a>
    node.on
  </h3>
</div>

  </div>
  <div class="body"><p>Registers an event listener</p>

<p>Listeners registered before a game is started, e.g. in
the init function of the game object, will stay valid 
throughout the game. Listeners registered after the game 
is started will be removed after the game has advanced
to its next stage. </p>
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span>event</span>
      <span class="dox_type">string</span>
      <span>The name of the event</span>
    </div>
    <div class="dox_tag_detail">
      <span>listener</span>
      <span class="dox_type">function</span>
      <span>The callback function</span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>  <span class="nx">node</span><span class="p">.</span><span class="nx">on</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">event</span><span class="p">,</span> <span class="nx">listener</span><span class="p">)</span> <span class="p">{</span>
    
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span> 
      <span class="nx">node</span><span class="p">.</span><span class="nx">err</span><span class="p">(</span><span class="s1">&#39;undefined event&#39;</span><span class="p">);</span> 
      <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;function&#39;</span> <span class="o">!==</span> <span class="k">typeof</span> <span class="nx">listener</span><span class="p">)</span> <span class="p">{</span> 
      <span class="nx">node</span><span class="p">.</span><span class="nx">err</span><span class="p">(</span><span class="s1">&#39;callback must be of time function&#39;</span><span class="p">);</span> 
      <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>
    </pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-17" id="section-17">&#182;</a>
</div>
<p>It is in the init function;</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">node</span><span class="p">.</span><span class="nx">game</span> <span class="o">||</span> <span class="o">!</span><span class="nx">node</span><span class="p">.</span><span class="nx">game</span><span class="p">.</span><span class="nx">state</span> <span class="o">||</span> <span class="p">(</span><span class="nx">GameState</span><span class="p">.</span><span class="nx">compare</span><span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">game</span><span class="p">.</span><span class="nx">state</span><span class="p">,</span> <span class="k">new</span> <span class="nx">GameState</span><span class="p">(),</span> <span class="kc">true</span><span class="p">)</span> <span class="o">===</span> <span class="mi">0</span> <span class="p">))</span> <span class="p">{</span>
      <span class="nx">node</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">event</span><span class="p">,</span> <span class="nx">listener</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="p">{</span>
      <span class="nx">node</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">addLocal</span><span class="p">(</span><span class="nx">event</span><span class="p">,</span> <span class="nx">listener</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">};</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="node.once">
  <h3>
    <a href="#node.once" class="pilcrow">&#182;</a>
    node.once
  </h3>
</div>

  </div>
  <div class="body"><p>Registers an event listener that will be removed 
after its first invocation</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span>event</span>
      <span class="dox_type">string</span>
      <span>The name of the event</span>
    </div>
    <div class="dox_tag_detail">
      <span>listener</span>
      <span class="dox_type">function</span>
      <span>The callback function</span>
    </div>
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">node.on</span>
    </div>
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">node.off</span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>  <span class="nx">node</span><span class="p">.</span><span class="nx">once</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">event</span><span class="p">,</span> <span class="nx">listener</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">event</span> <span class="o">||</span> <span class="o">!</span><span class="nx">listener</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
    <span class="nx">node</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="nx">event</span><span class="p">,</span> <span class="nx">listener</span><span class="p">);</span>
    <span class="nx">node</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="nx">event</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">,</span> <span class="nx">listener</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">node</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">remove</span><span class="p">(</span><span class="nx">event</span><span class="p">,</span> <span class="nx">listener</span><span class="p">);</span>
    <span class="p">});</span>
  <span class="p">};</span>
  </pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="node.off">
  <h3>
    <a href="#node.off" class="pilcrow">&#182;</a>
    node.off
  </h3>
</div>

  </div>
  <div class="body"><p>Deregisters one or multiple event listeners</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span>event</span>
      <span class="dox_type">string</span>
      <span>The name of the event</span>
    </div>
    <div class="dox_tag_detail">
      <span>listener</span>
      <span class="dox_type">function</span>
      <span>The callback function</span>
    </div>
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">node.on</span>
    </div>
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">node.EventEmitter.remove</span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>  <span class="nx">node</span><span class="p">.</span><span class="nx">off</span> <span class="o">=</span> <span class="nx">node</span><span class="p">.</span><span class="nx">removeListener</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">event</span><span class="p">,</span> <span class="nx">func</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">node</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">remove</span><span class="p">(</span><span class="nx">event</span><span class="p">,</span> <span class="nx">func</span><span class="p">);</span>
  <span class="p">};</span>

  
  </pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="node.redirect">
  <h3>
    <a href="#node.redirect" class="pilcrow">&#182;</a>
    node.redirect
  </h3>
</div>

  </div>
  <div class="body"><p>Redirects a player to the specified url</p>

<p>Works only if it is a monitor client to send
the message, i.e. players cannot redirect each 
other.</p>

<p>Examples</p>


<div class="highlight"><pre><code><span class="sr">//</span> <span class="n">Redirect</span> <span class="n">to</span> <span class="n">http:</span><span class="sr">//m</span><span class="n">ydomain</span><span class="sr">/mygame/missi</span><span class="n">ng_auth</span>
<span class="n">node</span><span class="o">.</span><span class="n">redirect</span><span class="p">(</span><span class="s">&#39;missing_auth&#39;</span><span class="p">,</span> <span class="s">&#39;xxx&#39;</span><span class="p">);</span> 
</code></pre></div>



<p>// Redirect to external urls
 node.redirect('<a href='http://www.google.com'>http://www.google.com</a>');</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span>url</span>
      <span class="dox_type">string</span>
      <span>the url of the redirection</span>
    </div>
    <div class="dox_tag_detail">
      <span>who</span>
      <span class="dox_type">string</span>
      <span>A player id or 'ALL'</span>
    </div>
    <div class="dox_tag_title">Returns</div>
    <div class="dox_tag_detail">
      <span></span>
      <span class="dox_type">boolean</span>
      <span>TRUE, if the redirect message is sent</span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>  <span class="nx">node</span><span class="p">.</span><span class="nx">redirect</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">url</span><span class="p">,</span> <span class="nx">who</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">url</span> <span class="o">||</span> <span class="o">!</span><span class="nx">who</span><span class="p">)</span> <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
    
    <span class="kd">var</span> <span class="nx">msg</span> <span class="o">=</span> <span class="nx">node</span><span class="p">.</span><span class="nx">msg</span><span class="p">.</span><span class="nx">create</span><span class="p">({</span>
      <span class="nx">target</span><span class="o">:</span> <span class="nx">node</span><span class="p">.</span><span class="nx">targets</span><span class="p">.</span><span class="nx">REDIRECT</span><span class="p">,</span>
      <span class="nx">data</span><span class="o">:</span> <span class="nx">url</span><span class="p">,</span>
      <span class="nx">to</span><span class="o">:</span> <span class="nx">who</span>
    <span class="p">});</span>
    <span class="nx">node</span><span class="p">.</span><span class="nx">socket</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">msg</span><span class="p">);</span>
    <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
  <span class="p">};</span>
  
  <span class="nx">node</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">version</span> <span class="o">+</span> <span class="s1">&#39; loaded&#39;</span><span class="p">,</span> <span class="s1">&#39;ALWAYS&#39;</span><span class="p">);</span>
  
<span class="p">})(</span>
    <span class="k">this</span>
  <span class="p">,</span>   <span class="s1">&#39;undefined&#39;</span> <span class="o">!=</span> <span class="k">typeof</span> <span class="nx">node</span> <span class="o">?</span> <span class="nx">node</span> <span class="o">:</span> <span class="nx">module</span><span class="p">.</span><span class="nx">parent</span><span class="p">.</span><span class="nx">exports</span>
<span class="p">);</span>
</pre></div>
        </td>
      </tr>
  </tbody>
</table>
  </div>
</body>
</html>
