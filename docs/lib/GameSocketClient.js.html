<!DOCTYPE html>
<html>
<head>
  <title>GameSocketClient.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="../doc-style.css" />
  <script src="../doc-filelist.js"></script>
  <script>
    var relativeDir = '../', thisFile = 'lib/GameSocketClient.js', defaultSidebar = true;
  </script>
  <script src="../doc-script.js"></script>
</head>
<body>
  <div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">
      <div class="heading h1">
        <a href="#gamesocketclient">GameSocketClient</a>
      </div>
      <div class="heading h2">
        <a href="#global-scope">Global scope</a>
      </div>
      <div class="heading h2">
        <a href="#gamesocketclient-constructor">GameSocketClient constructor</a>
      </div>
      <div class="heading h2">
        <a href="#private-properties">Private properties</a>
      </div>
      <div class="heading h3">
        <a href="#gamesocketclient.buffer">GameSocketClient.buffer</a>
      </div>
      <div class="heading h3">
        <a href="#gamesocketclient.session">GameSocketClient.session</a>
      </div>
      <div class="heading h2">
        <a href="#public-properties">Public properties</a>
      </div>
      <div class="heading h3">
        <a href="#gamesocketclient.io">GameSocketClient.io</a>
      </div>
      <div class="heading h3">
        <a href="#gamesocketclient.url">GameSocketClient.url</a>
      </div>
      <div class="heading h3">
        <a href="#gamesocketclient.servername">GameSocketClient.servername</a>
      </div>
      <div class="heading h2">
        <a href="#gamesocketclient-methods">GameSocketClient methods</a>
      </div>
      <div class="heading h3">
        <a href="#gamesocketclient.getsession">GameSocketClient.getSession</a>
      </div>
      <div class="heading h3">
        <a href="#gamesocketclient.startsession">GameSocketClient.startSession</a>
      </div>
      <div class="heading h3">
        <a href="#gamesocketclient.restoresession">GameSocketClient.restoreSession</a>
      </div>
      <div class="heading h3">
        <a href="#gamesocketclient.createplayer">GameSocketClient.createPlayer</a>
      </div>
      <div class="heading h3">
        <a href="#gamesocketclient.connect">GameSocketClient.connect</a>
      </div>
      <div class="heading h2">
        <a href="#i-o-functions">I/O Functions</a>
      </div>
      <div class="heading h3">
        <a href="#gamesocketclient.secureparse">GameSocketClient.secureParse</a>
      </div>
      <div class="heading h3">
        <a href="#gamesocketclient.clearbuffer">GameSocketClient.clearBuffer</a>
      </div>
      <div class="heading h3">
        <a href="#gamesocketclient.attachfirstlisteners">GameSocketClient.attachFirstListeners</a>
      </div>
      <div class="heading h3">
        <a href="#gamesocketclient.attachmsglisteners">GameSocketClient.attachMsgListeners</a>
      </div>
      <div class="heading h2">
        <a href="#send-methods">SEND methods</a>
      </div>
      <div class="heading h3">
        <a href="#gamesocketclient.sendhi">GameSocketClient.sendHI</a>
      </div>
      <div class="heading h3">
        <a href="#gamesocketclient.sendstate">GameSocketClient.sendSTATE</a>
      </div>
      <div class="heading h3">
        <a href="#gamesocketclient.sendtxt">GameSocketClient.sendTXT</a>
      </div>
      <div class="heading h3">
        <a href="#gamesocketclient.senddata">GameSocketClient.sendDATA</a>
      </div>
      <div class="heading h3">
        <a href="#gamesocketclient.send">GameSocketClient.send</a>
      </div>
    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container"><div class="background highlight"></div>
<table cellpadding="0" cellspacing="0">
  <tbody>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="gamesocketclient">
  <h1>
    <a href="#gamesocketclient" class="pilcrow">&#182;</a>
    GameSocketClient
  </h1>
</div>

  </div>
  <div class="body"><p>Copyright(c) 2012 Stefano Balietti
MIT Licensed </p>

<p><code>nodeGame</code> component rensponsible for dispatching events and messages </p>

<hr />
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">exports</span><span class="p">,</span> <span class="nx">node</span><span class="p">,</span> <span class="nx">io</span><span class="p">)</span> <span class="p">{</span>
  </pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="global-scope">
  <h2>
    <a href="#global-scope" class="pilcrow">&#182;</a>
    Global scope
  </h2>
</div>

        </td>
        <td class="code highlight"><div class="highlight"><pre>  
<span class="kd">var</span> <span class="nx">GameMsg</span> <span class="o">=</span> <span class="nx">node</span><span class="p">.</span><span class="nx">GameMsg</span><span class="p">,</span>
  <span class="nx">GameState</span> <span class="o">=</span> <span class="nx">node</span><span class="p">.</span><span class="nx">GameState</span><span class="p">,</span>
  <span class="nx">Player</span> <span class="o">=</span> <span class="nx">node</span><span class="p">.</span><span class="nx">Player</span><span class="p">,</span>
  <span class="nx">GameMsgGenerator</span> <span class="o">=</span> <span class="nx">node</span><span class="p">.</span><span class="nx">GameMsgGenerator</span><span class="p">;</span>

<span class="kd">var</span> <span class="nx">buffer</span><span class="p">,</span>
  <span class="nx">session</span><span class="p">;</span>
  

<span class="nx">exports</span><span class="p">.</span><span class="nx">GameSocketClient</span> <span class="o">=</span> <span class="nx">GameSocketClient</span><span class="p">;</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="gamesocketclient-constructor">
  <h2>
    <a href="#gamesocketclient-constructor" class="pilcrow">&#182;</a>
    GameSocketClient constructor
  </h2>
</div>

  </div>
  <div class="body"><p>Creates a new instance of GameSocketClient</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">options</span>
      <span class="dox_type">object</span>
      <span>Optional. A configuration object</span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre><span class="kd">function</span> <span class="nx">GameSocketClient</span> <span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">options</span> <span class="o">=</span> <span class="nx">options</span> <span class="o">||</span> <span class="p">{};</span>
  </pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="private-properties">
  <h2>
    <a href="#private-properties" class="pilcrow">&#182;</a>
    Private properties
  </h2>
</div>

        </td>
        <td class="code highlight"><div class="highlight"><pre>  </pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="gamesocketclient.buffer">
  <h3>
    <a href="#gamesocketclient.buffer" class="pilcrow">&#182;</a>
    GameSocketClient.buffer
  </h3>
</div>

  </div>
  <div class="body"><p>Buffer of queued messages </p>
  </div>
  <div class="details">
    <div class="dox_tag_title">API</div>
    <div class="dox_tag_detail">
      <span class="dox_type">private
</span>
    </span>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>  <span class="nx">buffer</span> <span class="o">=</span> <span class="p">[];</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">support</span><span class="p">.</span><span class="nx">defineProperty</span><span class="p">)</span> <span class="p">{</span>
    <span class="nb">Object</span><span class="p">.</span><span class="nx">defineProperty</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="s1">&#39;buffer&#39;</span><span class="p">,</span> <span class="p">{</span>
      <span class="nx">value</span><span class="o">:</span> <span class="nx">buffer</span><span class="p">,</span>
      <span class="nx">enumerable</span><span class="o">:</span> <span class="kc">true</span>
    <span class="p">});</span>
  <span class="p">}</span>
  <span class="k">else</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">buffer</span> <span class="o">=</span> <span class="nx">buffer</span><span class="p">;</span>
  <span class="p">}</span>
  </pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="gamesocketclient.session">
  <h3>
    <a href="#gamesocketclient.session" class="pilcrow">&#182;</a>
    GameSocketClient.session
  </h3>
</div>

  </div>
  <div class="body"><p>The session id shared with the server</p>

<p>This property is initialized only when a game starts</p>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>  <span class="nx">session</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">support</span><span class="p">.</span><span class="nx">defineProperty</span><span class="p">)</span> <span class="p">{</span>
    <span class="nb">Object</span><span class="p">.</span><span class="nx">defineProperty</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="s1">&#39;session&#39;</span><span class="p">,</span> <span class="p">{</span>
      <span class="nx">value</span><span class="o">:</span> <span class="nx">session</span><span class="p">,</span>
      <span class="nx">enumerable</span><span class="o">:</span> <span class="kc">true</span>
    <span class="p">});</span>
  <span class="p">}</span>
  <span class="k">else</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">session</span> <span class="o">=</span> <span class="nx">session</span><span class="p">;</span>
  <span class="p">}</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="public-properties">
  <h2>
    <a href="#public-properties" class="pilcrow">&#182;</a>
    Public properties
  </h2>
</div>

        </td>
        <td class="code highlight"><div class="highlight"><pre>  </pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="gamesocketclient.io">
  <h3>
    <a href="#gamesocketclient.io" class="pilcrow">&#182;</a>
    GameSocketClient.io
  </h3>
</div>

  </div>
  <div class="body">
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>  <span class="k">this</span><span class="p">.</span><span class="nx">io</span>     <span class="o">=</span> <span class="kc">null</span><span class="p">;</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="gamesocketclient.url">
  <h3>
    <a href="#gamesocketclient.url" class="pilcrow">&#182;</a>
    GameSocketClient.url
  </h3>
</div>

  </div>
  <div class="body">
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>  <span class="k">this</span><span class="p">.</span><span class="nx">url</span>    <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
  </pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="gamesocketclient.servername">
  <h3>
    <a href="#gamesocketclient.servername" class="pilcrow">&#182;</a>
    GameSocketClient.servername
  </h3>
</div>

  </div>
  <div class="body">
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>  <span class="k">this</span><span class="p">.</span><span class="nx">servername</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>

<span class="p">}</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="gamesocketclient-methods">
  <h2>
    <a href="#gamesocketclient-methods" class="pilcrow">&#182;</a>
    GameSocketClient methods
  </h2>
</div>

        </td>
        <td class="code highlight"><div class="highlight"><pre></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="gamesocketclient.getsession">
  <h3>
    <a href="#gamesocketclient.getsession" class="pilcrow">&#182;</a>
    GameSocketClient.getSession
  </h3>
</div>

  </div>
  <div class="body"><p>Searches the node.session object for a saved session matching the passed 
game-message</p>

<p>If found, the session object will have the following a structure</p>

<p>var session = {
    id:   node.gsc.session,
    player: node.player,
    memory: node.game.memory,
    state:   node.game.state,
    game:   node.game.name,
    history: undefined,
  };  </p>
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">msg</span>
      <span class="dox_type">GameMsg</span>
      <span>A game-msg</span>
    </div>
    <div class="dox_tag_title">Returns</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name"></span>
      <span class="dox_type">object</span>
      <span class="dox_type">boolean</span>
      <span>A session object, or FALSE if not was not found

@see node.session</span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre><span class="nx">GameSocketClient</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">getSession</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">msg</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">msg</span><span class="p">)</span> <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
  
  <span class="kd">var</span> <span class="nx">session</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;function&#39;</span> <span class="o">===</span> <span class="k">typeof</span> <span class="nx">node</span><span class="p">.</span><span class="nx">session</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">session</span> <span class="o">=</span> <span class="nx">node</span><span class="p">.</span><span class="nx">session</span><span class="p">(</span><span class="nx">msg</span><span class="p">.</span><span class="nx">session</span><span class="p">);</span>
  <span class="p">}</span>
  </pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-13" id="section-13">&#182;</a>
</div>
<p>TODO: check if session is still valid</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>  <span class="k">return</span> <span class="p">(</span><span class="nx">session</span><span class="p">)</span> <span class="o">?</span> <span class="nx">session</span> <span class="o">:</span> <span class="kc">false</span><span class="p">;</span>
<span class="p">};</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="gamesocketclient.startsession">
  <h3>
    <a href="#gamesocketclient.startsession" class="pilcrow">&#182;</a>
    GameSocketClient.startSession
  </h3>
</div>

  </div>
  <div class="body"><p>Initializes a nodeGame session</p>

<p>Creates a the player and saves it in node.player, and stores the session ids
in the session object (GameSocketClient.session)</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">msg</span>
      <span class="dox_type">GameMsg</span>
      <span>A game-msg</span>
    </div>
    <div class="dox_tag_title">Returns</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name"></span>
      <span class="dox_type">boolean</span>
      <span>TRUE, if session was correctly initialized

@see GameSocketClient.createPlayer</span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre><span class="nx">GameSocketClient</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">startSession</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">msg</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">player</span> <span class="o">=</span> <span class="p">{</span>
      <span class="nx">id</span><span class="o">:</span>   <span class="nx">msg</span><span class="p">.</span><span class="nx">data</span><span class="p">,</span> 
      <span class="nx">sid</span><span class="o">:</span>  <span class="nx">msg</span><span class="p">.</span><span class="nx">data</span>
  <span class="p">};</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">createPlayer</span><span class="p">(</span><span class="nx">player</span><span class="p">);</span>
  <span class="nx">session</span> <span class="o">=</span> <span class="nx">msg</span><span class="p">.</span><span class="nx">session</span><span class="p">;</span>
  <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
<span class="p">};</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="gamesocketclient.restoresession">
  <h3>
    <a href="#gamesocketclient.restoresession" class="pilcrow">&#182;</a>
    GameSocketClient.restoreSession
  </h3>
</div>

  </div>
  <div class="body"><p>Restores a session object</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">session</span>
      <span class="dox_type">object</span>
      <span>A session object as loaded by GameSocketClient.getSession

@emit NODEGAME_RECOVERY
  @emit LOADED

@see GameSocketClient.createPlayer
  @see node.session</span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre><span class="nx">GameSocketClient</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">restoreSession</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">sessionObj</span><span class="p">,</span> <span class="nx">sid</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">sessionObj</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
  
  <span class="kd">var</span> <span class="nx">log_prefix</span> <span class="o">=</span> <span class="s1">&#39;nodeGame session recovery: &#39;</span><span class="p">;</span>
  
  <span class="nx">node</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Starting session recovery &#39;</span> <span class="o">+</span> <span class="nx">sid</span><span class="p">,</span> <span class="s1">&#39;INFO&#39;</span><span class="p">,</span> <span class="nx">log_prefix</span><span class="p">);</span>
  <span class="nx">node</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="s1">&#39;NODEGAME_RECOVERY&#39;</span><span class="p">,</span> <span class="nx">sid</span><span class="p">);</span>
  
  <span class="nx">sid</span> <span class="o">=</span> <span class="nx">sid</span> <span class="o">||</span> <span class="nx">sessionObj</span><span class="p">.</span><span class="nx">player</span><span class="p">.</span><span class="nx">sid</span><span class="p">;</span>
  
  <span class="k">this</span><span class="p">.</span><span class="nx">session</span> <span class="o">=</span> <span class="nx">sessionObj</span><span class="p">.</span><span class="nx">id</span><span class="p">;</span>
  </pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-16" id="section-16">&#182;</a>
</div>
<p>Important! The new socket.io ID</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>  <span class="nx">session</span><span class="p">.</span><span class="nx">player</span><span class="p">.</span><span class="nx">sid</span> <span class="o">=</span> <span class="nx">sid</span><span class="p">;</span>

  <span class="k">this</span><span class="p">.</span><span class="nx">createPlayer</span><span class="p">(</span><span class="nx">session</span><span class="p">.</span><span class="nx">player</span><span class="p">);</span>
  <span class="nx">node</span><span class="p">.</span><span class="nx">game</span><span class="p">.</span><span class="nx">memory</span> <span class="o">=</span> <span class="nx">session</span><span class="p">.</span><span class="nx">memory</span><span class="p">;</span>
  <span class="nx">node</span><span class="p">.</span><span class="kr">goto</span><span class="p">(</span><span class="nx">session</span><span class="p">.</span><span class="nx">state</span><span class="p">);</span>
  
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">sessionObj</span><span class="p">.</span><span class="nx">history</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">node</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;No event history was found to recover&#39;</span><span class="p">,</span> <span class="s1">&#39;WARN&#39;</span><span class="p">,</span> <span class="nx">log_prefix</span><span class="p">);</span>
    <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
  <span class="p">}</span>
  
  <span class="nx">node</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Recovering &#39;</span> <span class="o">+</span> <span class="nx">session</span><span class="p">.</span><span class="nx">history</span><span class="p">.</span><span class="nx">length</span> <span class="o">+</span> <span class="s1">&#39; events&#39;</span><span class="p">,</span> <span class="s1">&#39;DEBUG&#39;</span><span class="p">,</span> <span class="nx">log_prefix</span><span class="p">);</span>
  
  <span class="nx">node</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">history</span><span class="p">.</span><span class="nx">importDB</span><span class="p">(</span><span class="nx">session</span><span class="p">.</span><span class="nx">history</span><span class="p">);</span>
  <span class="kd">var</span> <span class="nx">hash</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">GameState</span><span class="p">(</span><span class="nx">session</span><span class="p">.</span><span class="nx">state</span><span class="p">).</span><span class="nx">toHash</span><span class="p">(</span><span class="s1">&#39;S.s.r&#39;</span><span class="p">);</span> 
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">node</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">history</span><span class="p">.</span><span class="nx">state</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">node</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;No old events to re-emit were found during session recovery&#39;</span><span class="p">,</span> <span class="s1">&#39;DEBUG&#39;</span><span class="p">,</span> <span class="nx">log_prefix</span><span class="p">);</span>
    <span class="k">return</span> <span class="kc">true</span><span class="p">;</span> 
  <span class="p">}</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">node</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">history</span><span class="p">.</span><span class="nx">state</span><span class="p">[</span><span class="nx">hash</span><span class="p">]){</span>
    <span class="nx">node</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;The current state &#39;</span> <span class="o">+</span> <span class="nx">hash</span> <span class="o">+</span> <span class="s1">&#39; has no events to re-emit&#39;</span><span class="p">,</span> <span class="s1">&#39;DEBUG&#39;</span><span class="p">,</span> <span class="nx">log_prefix</span><span class="p">);</span>
    <span class="k">return</span> <span class="kc">true</span><span class="p">;</span> 
  <span class="p">}</span>
  
  <span class="kd">var</span> <span class="nx">discard</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;LOG&#39;</span><span class="p">,</span> 
                 <span class="s1">&#39;STATECHANGE&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;WINDOW_LOADED&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;BEFORE_LOADING&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;LOADED&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;in.say.STATE&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;UPDATED_PLIST&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;NODEGAME_READY&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;out.say.STATE&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;out.set.STATE&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;in.say.PLIST&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;STATEDONE&#39;</span><span class="p">,</span> <span class="c1">// maybe not here</span>
                 <span class="s1">&#39;out.say.HI&#39;</span>
                   
  <span class="p">];</span>
  
  <span class="kd">var</span> <span class="nx">to_remit</span> <span class="o">=</span> <span class="nx">node</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">history</span><span class="p">.</span><span class="nx">state</span><span class="p">[</span><span class="nx">hash</span><span class="p">];</span>
  <span class="nx">to_remit</span><span class="p">.</span><span class="nx">select</span><span class="p">(</span><span class="s1">&#39;event&#39;</span><span class="p">,</span> <span class="s1">&#39;in&#39;</span><span class="p">,</span> <span class="nx">discard</span><span class="p">).</span><span class="nx">remove</span><span class="p">();</span>
  
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">to_remit</span><span class="p">.</span><span class="nx">length</span><span class="p">){</span>
    <span class="nx">node</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;The current state &#39;</span> <span class="o">+</span> <span class="nx">hash</span> <span class="o">+</span> <span class="s1">&#39; has no valid events to re-emit&#39;</span><span class="p">,</span> <span class="s1">&#39;DEBUG&#39;</span><span class="p">,</span> <span class="nx">log_prefix</span><span class="p">);</span>
    <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
  <span class="p">}</span>
  
  <span class="kd">var</span> <span class="nx">remit</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">node</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Re-emitting &#39;</span> <span class="o">+</span> <span class="nx">to_remit</span><span class="p">.</span><span class="nx">length</span> <span class="o">+</span> <span class="s1">&#39; events&#39;</span><span class="p">,</span> <span class="s1">&#39;DEBUG&#39;</span><span class="p">,</span> <span class="nx">log_prefix</span><span class="p">);</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-17" id="section-17">&#182;</a>
</div>
<p>We have events that were fired at the state when 
disconnection happened. Let's fire them again </p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>    <span class="nx">to_remit</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-18" id="section-18">&#182;</a>
</div>
<p>Falsy, should already been discarded</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">JSUS</span><span class="p">.</span><span class="nx">in_array</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">event</span><span class="p">,</span> <span class="nx">discard</span><span class="p">))</span> <span class="p">{</span>
        <span class="nx">node</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">event</span><span class="p">,</span> <span class="nx">e</span><span class="p">.</span><span class="nx">p1</span><span class="p">,</span> <span class="nx">e</span><span class="p">.</span><span class="nx">p2</span><span class="p">,</span> <span class="nx">e</span><span class="p">.</span><span class="nx">p3</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">});</span>
  <span class="p">};</span>
  
  <span class="k">if</span> <span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">game</span><span class="p">.</span><span class="nx">isReady</span><span class="p">())</span> <span class="p">{</span>
    <span class="nx">remit</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">game</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">else</span> <span class="p">{</span>
    <span class="nx">node</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;LOADED&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(){</span>
      <span class="nx">remit</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">game</span><span class="p">);</span>
    <span class="p">});</span>
  <span class="p">}</span>
  
  <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
<span class="p">};</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="gamesocketclient.createplayer">
  <h3>
    <a href="#gamesocketclient.createplayer" class="pilcrow">&#182;</a>
    GameSocketClient.createPlayer
  </h3>
</div>

  </div>
  <div class="body"><p>Mixes in default properties for the player object and
additional configuration variables from node.conf.player</p>

<p>Writes the node.player object</p>

<p>Properties: <code>id</code>, <code>sid</code>, <code>ip</code> can never be overwritten.</p>

<p>Properties added as local configuration cannot be further
modified during the game. </p>

<p>Only the property <code>name</code>, can be changed.</p>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre><span class="nx">GameSocketClient</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">createPlayer</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">player</span><span class="p">)</span> <span class="p">{</span> 
  <span class="nx">player</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Player</span><span class="p">(</span><span class="nx">player</span><span class="p">);</span>
  
  <span class="k">if</span> <span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">conf</span> <span class="o">&amp;&amp;</span> <span class="nx">node</span><span class="p">.</span><span class="nx">conf</span><span class="p">.</span><span class="nx">player</span><span class="p">)</span> <span class="p">{</span>      
    <span class="kd">var</span> <span class="nx">pconf</span> <span class="o">=</span> <span class="nx">node</span><span class="p">.</span><span class="nx">conf</span><span class="p">.</span><span class="nx">player</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">key</span> <span class="k">in</span> <span class="nx">pconf</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">pconf</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">key</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">JSUS</span><span class="p">.</span><span class="nx">in_array</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;sid&#39;</span><span class="p">,</span> <span class="s1">&#39;ip&#39;</span><span class="p">]))</span> <span class="p">{</span>
          <span class="k">continue</span><span class="p">;</span>
        <span class="p">}</span> 
        </pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-20" id="section-20">&#182;</a>
</div>
<p>Cannot be overwritten properties previously 
set in other sessions (recovery)
            if (player.hasOwnProperty(key)) {
                continue;
            }</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>        <span class="k">if</span> <span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">support</span><span class="p">.</span><span class="nx">defineProperty</span><span class="p">)</span> <span class="p">{</span>
          <span class="nb">Object</span><span class="p">.</span><span class="nx">defineProperty</span><span class="p">(</span><span class="nx">player</span><span class="p">,</span> <span class="nx">key</span><span class="p">,</span> <span class="p">{</span>
              <span class="nx">value</span><span class="o">:</span> <span class="nx">pconf</span><span class="p">[</span><span class="nx">key</span><span class="p">],</span>
              <span class="nx">enumerable</span><span class="o">:</span> <span class="kc">true</span>
          <span class="p">});</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="p">{</span>
          <span class="nx">player</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="nx">pconf</span><span class="p">[</span><span class="nx">key</span><span class="p">];</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">support</span><span class="p">.</span><span class="nx">defineProperty</span><span class="p">)</span> <span class="p">{</span>
    <span class="nb">Object</span><span class="p">.</span><span class="nx">defineProperty</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="s1">&#39;player&#39;</span><span class="p">,</span> <span class="p">{</span>
        <span class="nx">value</span><span class="o">:</span> <span class="nx">player</span><span class="p">,</span>
        <span class="nx">enumerable</span><span class="o">:</span> <span class="kc">true</span>
    <span class="p">});</span>
  <span class="p">}</span>
  <span class="k">else</span> <span class="p">{</span>
    <span class="nx">node</span><span class="p">.</span><span class="nx">player</span> <span class="o">=</span> <span class="nx">player</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="nx">player</span><span class="p">;</span>
<span class="p">};</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="gamesocketclient.connect">
  <h3>
    <a href="#gamesocketclient.connect" class="pilcrow">&#182;</a>
    GameSocketClient.connect
  </h3>
</div>

  </div>
  <div class="body"><p>Initializes the connection to a nodeGame server</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">conf</span>
      <span class="dox_type">object</span>
      <span>A configuration object</span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre><span class="nx">GameSocketClient</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">connect</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">conf</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">conf</span> <span class="o">=</span> <span class="nx">conf</span> <span class="o">||</span> <span class="p">{};</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">conf</span><span class="p">.</span><span class="nx">url</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">node</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;cannot connect to empty url.&#39;</span><span class="p">,</span> <span class="s1">&#39;ERR&#39;</span><span class="p">);</span>
    <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
  <span class="p">}</span>
  
  <span class="k">this</span><span class="p">.</span><span class="nx">url</span> <span class="o">=</span> <span class="nx">conf</span><span class="p">.</span><span class="nx">url</span><span class="p">;</span>
  
  <span class="nx">node</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;connecting to &#39;</span> <span class="o">+</span> <span class="nx">conf</span><span class="p">.</span><span class="nx">url</span><span class="p">);</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">io</span> <span class="o">=</span> <span class="nx">io</span><span class="p">.</span><span class="nx">connect</span><span class="p">(</span><span class="nx">conf</span><span class="p">.</span><span class="nx">url</span><span class="p">,</span> <span class="nx">conf</span><span class="p">.</span><span class="nx">io</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">attachFirstListeners</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">io</span><span class="p">);</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">io</span><span class="p">;</span>
<span class="p">};</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="i-o-functions">
  <h2>
    <a href="#i-o-functions" class="pilcrow">&#182;</a>
    I/O Functions
  </h2>
</div>

        </td>
        <td class="code highlight"><div class="highlight"><pre><span class="kd">var</span> <span class="nx">logSecureParseError</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">text</span><span class="p">,</span> <span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">text</span> <span class="o">=</span> <span class="nx">text</span> <span class="o">||</span> <span class="s1">&#39;Generic error while parsing a game message&#39;</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">error</span> <span class="o">=</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="o">?</span> <span class="nx">text</span> <span class="o">+</span> <span class="s2">&quot;: &quot;</span> <span class="o">+</span> <span class="nx">e</span> <span class="o">:</span> <span class="nx">text</span><span class="p">;</span>
  <span class="nx">node</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="s1">&#39;ERR&#39;</span><span class="p">);</span>
  <span class="nx">node</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="s1">&#39;LOG&#39;</span><span class="p">,</span> <span class="s1">&#39;E: &#39;</span> <span class="o">+</span> <span class="nx">error</span><span class="p">);</span>
  <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
<span class="p">}</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="gamesocketclient.secureparse">
  <h3>
    <a href="#gamesocketclient.secureparse" class="pilcrow">&#182;</a>
    GameSocketClient.secureParse
  </h3>
</div>

  </div>
  <div class="body"><p>Parse the message received in the Socket</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">msg</span>
      <span class="dox_type">object</span>
      <span class="dox_type">GameMsg</span>
      <span>The game-message to parse</span>
    </div>
    <div class="dox_tag_title">Returns</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name"></span>
      <span class="dox_type">GameMsg</span>
      <span class="dox_type">boolean</span>
      <span>The parsed GameMsg object, or FALSE if an error occurred</span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre><span class="nx">GameSocketClient</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">secureParse</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">msg</span><span class="p">)</span> <span class="p">{</span>
  
  <span class="kd">var</span> <span class="nx">gameMsg</span><span class="p">;</span>
  <span class="k">try</span> <span class="p">{</span>
    <span class="nx">gameMsg</span> <span class="o">=</span> <span class="nx">GameMsg</span><span class="p">.</span><span class="nx">clone</span><span class="p">(</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">msg</span><span class="p">));</span>
    <span class="nx">node</span><span class="p">.</span><span class="nx">info</span><span class="p">(</span><span class="nx">gameMsg</span><span class="p">,</span> <span class="s1">&#39;R: &#39;</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">catch</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">logSecureParseError</span><span class="p">(</span><span class="s1">&#39;Malformed msg received&#39;</span><span class="p">,</span>  <span class="nx">e</span><span class="p">);</span>
  <span class="p">}</span>
  
  <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">session</span> <span class="o">&amp;&amp;</span> <span class="nx">gameMsg</span><span class="p">.</span><span class="nx">session</span> <span class="o">!==</span> <span class="k">this</span><span class="p">.</span><span class="nx">session</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">logSecureParseError</span><span class="p">(</span><span class="s1">&#39;Local session id does not match incoming message session id&#39;</span><span class="p">);</span>
  <span class="p">}</span>
  
  <span class="k">return</span> <span class="nx">gameMsg</span><span class="p">;</span>
<span class="p">};</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="gamesocketclient.clearbuffer">
  <h3>
    <a href="#gamesocketclient.clearbuffer" class="pilcrow">&#182;</a>
    GameSocketClient.clearBuffer
  </h3>
</div>

  </div>
  <div class="body"><p>Emits and removes all the events in the message buffer</p>

<p>@see node.emit</p>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre><span class="nx">GameSocketClient</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">clearBuffer</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">nelem</span> <span class="o">=</span> <span class="nx">buffer</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
  <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">nelem</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">msg</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">buffer</span><span class="p">.</span><span class="nx">shift</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">msg</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">node</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="nx">msg</span><span class="p">.</span><span class="nx">toInEvent</span><span class="p">(),</span> <span class="nx">msg</span><span class="p">);</span>
      <span class="nx">node</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Debuffered &#39;</span> <span class="o">+</span> <span class="nx">msg</span><span class="p">,</span> <span class="s1">&#39;DEBUG&#39;</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">};</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="gamesocketclient.attachfirstlisteners">
  <h3>
    <a href="#gamesocketclient.attachfirstlisteners" class="pilcrow">&#182;</a>
    GameSocketClient.attachFirstListeners
  </h3>
</div>

  </div>
  <div class="body"><p>Initializes the socket to wait for a HI message from the server</p>

<p>Nothing is done until the SERVER send an HI msg. All the others msgs will
be ignored otherwise.</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">socket</span>
      <span class="dox_type">object</span>
      <span>The socket.io socket</span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre><span class="nx">GameSocketClient</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">attachFirstListeners</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">socket</span><span class="p">)</span> <span class="p">{</span>
  
  <span class="kd">var</span> <span class="nx">that</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
  
  <span class="nx">socket</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;connect&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">msg</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">connString</span> <span class="o">=</span> <span class="s1">&#39;nodeGame: connection open&#39;</span><span class="p">;</span>
      <span class="nx">node</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">connString</span><span class="p">);</span> 
      
      <span class="nx">socket</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">msg</span><span class="p">)</span> <span class="p">{</span> 
        
        <span class="kd">var</span> <span class="nx">msg</span> <span class="o">=</span> <span class="nx">that</span><span class="p">.</span><span class="nx">secureParse</span><span class="p">(</span><span class="nx">msg</span><span class="p">);</span>
        
        <span class="k">if</span> <span class="p">(</span><span class="nx">msg</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// Parsing successful</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">msg</span><span class="p">.</span><span class="nx">target</span> <span class="o">===</span> <span class="s1">&#39;HI&#39;</span><span class="p">)</span> <span class="p">{</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-26" id="section-26">&#182;</a>
</div>
<p>Setting global info</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>          <span class="nx">that</span><span class="p">.</span><span class="nx">servername</span> <span class="o">=</span> <span class="nx">msg</span><span class="p">.</span><span class="nx">from</span><span class="p">;</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-27" id="section-27">&#182;</a>
</div>
<p>Keep serverid = msg.from for now</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>          <span class="nx">that</span><span class="p">.</span><span class="nx">serverid</span> <span class="o">=</span> <span class="nx">msg</span><span class="p">.</span><span class="nx">from</span><span class="p">;</span>
          
          <span class="kd">var</span> <span class="nx">sessionObj</span> <span class="o">=</span> <span class="nx">that</span><span class="p">.</span><span class="nx">getSession</span><span class="p">(</span><span class="nx">msg</span><span class="p">);</span>
          
          <span class="k">if</span> <span class="p">(</span><span class="nx">sessionObj</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">that</span><span class="p">.</span><span class="nx">restoreSession</span><span class="p">(</span><span class="nx">sessionObj</span><span class="p">,</span> <span class="nx">socket</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>
            </pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-28" id="section-28">&#182;</a>
</div>
<p>Get Ready to play</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>            <span class="nx">that</span><span class="p">.</span><span class="nx">attachMsgListeners</span><span class="p">(</span><span class="nx">socket</span><span class="p">,</span> <span class="nx">msg</span><span class="p">.</span><span class="nx">session</span><span class="p">);</span>
            
            <span class="kd">var</span> <span class="nx">msg</span> <span class="o">=</span> <span class="nx">node</span><span class="p">.</span><span class="nx">msg</span><span class="p">.</span><span class="nx">create</span><span class="p">({</span>
              <span class="nx">action</span><span class="o">:</span> <span class="nx">GameMsg</span><span class="p">.</span><span class="nx">actions</span><span class="p">.</span><span class="nx">SAY</span><span class="p">,</span>
              <span class="nx">target</span><span class="o">:</span> <span class="s1">&#39;HI_AGAIN&#39;</span><span class="p">,</span>
              <span class="nx">data</span><span class="o">:</span> <span class="nx">node</span><span class="p">.</span><span class="nx">player</span>
            <span class="p">});</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-29" id="section-29">&#182;</a>
</div>

<div class="highlight"><pre><code>                    <span class="n">console</span><span class="o">.</span><span class="nb">log</span><span class="p">(</span><span class="s">&#39;HI_AGAIN MSG!!&#39;</span><span class="p">);</span>
                    <span class="n">console</span><span class="o">.</span><span class="nb">log</span><span class="p">(</span><span class="n">msg</span><span class="p">);</span>
</code></pre></div>


        </td>
        <td class="code highlight"><div class="highlight"><pre>            <span class="nx">that</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">msg</span><span class="p">);</span>
            
          <span class="p">}</span>
          <span class="k">else</span> <span class="p">{</span>
            <span class="nx">that</span><span class="p">.</span><span class="nx">startSession</span><span class="p">(</span><span class="nx">msg</span><span class="p">);</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-30" id="section-30">&#182;</a>
</div>
<p>Get Ready to play</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>            <span class="nx">that</span><span class="p">.</span><span class="nx">attachMsgListeners</span><span class="p">(</span><span class="nx">socket</span><span class="p">,</span> <span class="nx">msg</span><span class="p">.</span><span class="nx">session</span><span class="p">);</span>
            </pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-31" id="section-31">&#182;</a>
</div>
<p>Send own name to SERVER</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>            <span class="nx">that</span><span class="p">.</span><span class="nx">sendHI</span><span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">player</span><span class="p">,</span> <span class="s1">&#39;ALL&#39;</span><span class="p">);</span>
          <span class="p">}</span>
          </pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-32" id="section-32">&#182;</a>
</div>
<p>Ready to play</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>          <span class="nx">node</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="s1">&#39;out.say.HI&#39;</span><span class="p">);</span>
           <span class="p">}</span> 
        <span class="p">}</span>
      <span class="p">});</span>
      
  <span class="p">});</span>
  
    <span class="nx">socket</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;disconnect&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-33" id="section-33">&#182;</a>
</div>
<p>Save the current state of the game</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>      <span class="nx">node</span><span class="p">.</span><span class="nx">session</span><span class="p">.</span><span class="nx">store</span><span class="p">();</span>
      <span class="nx">node</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;closed&#39;</span><span class="p">);</span>
    <span class="p">});</span>
<span class="p">};</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="gamesocketclient.attachmsglisteners">
  <h3>
    <a href="#gamesocketclient.attachmsglisteners" class="pilcrow">&#182;</a>
    GameSocketClient.attachMsgListeners
  </h3>
</div>

  </div>
  <div class="body"><p>Attaches standard message listeners</p>

<p>This method is called after the client has received a valid HI message from
the server, and a session number has been issued</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">socket</span>
      <span class="dox_type">object</span>
      <span>The socket.io socket</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">session</span>
      <span class="dox_type">number</span>
      <span>The session id issued by the server</span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre><span class="nx">GameSocketClient</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">attachMsgListeners</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">socket</span><span class="p">,</span> <span class="nx">session</span><span class="p">)</span> <span class="p">{</span>   
  <span class="kd">var</span> <span class="nx">that</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
  
  <span class="nx">node</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Attaching FULL listeners&#39;</span><span class="p">);</span>
  <span class="nx">socket</span><span class="p">.</span><span class="nx">removeAllListeners</span><span class="p">(</span><span class="s1">&#39;message&#39;</span><span class="p">);</span>
    
  <span class="nx">socket</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;message&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">msg</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">msg</span> <span class="o">=</span> <span class="nx">that</span><span class="p">.</span><span class="nx">secureParse</span><span class="p">(</span><span class="nx">msg</span><span class="p">);</span>
    
    <span class="k">if</span> <span class="p">(</span><span class="nx">msg</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// Parsing successful</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-35" id="section-35">&#182;</a>
</div>
<p>Wait to fire the msgs if the game state is loading</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>      <span class="k">if</span> <span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">game</span> <span class="o">&amp;&amp;</span> <span class="nx">node</span><span class="p">.</span><span class="nx">game</span><span class="p">.</span><span class="nx">isReady</span><span class="p">())</span> <span class="p">{</span> 
        <span class="nx">node</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="nx">msg</span><span class="p">.</span><span class="nx">toInEvent</span><span class="p">(),</span> <span class="nx">msg</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="k">else</span> <span class="p">{</span>
        <span class="nx">node</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Buffering: &#39;</span> <span class="o">+</span> <span class="nx">msg</span><span class="p">,</span> <span class="s1">&#39;DEBUG&#39;</span><span class="p">);</span>
        <span class="nx">buffer</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">msg</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">});</span>
  
  <span class="nx">node</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="s1">&#39;NODEGAME_READY&#39;</span><span class="p">);</span>
<span class="p">};</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="send-methods">
  <h2>
    <a href="#send-methods" class="pilcrow">&#182;</a>
    SEND methods
  </h2>
</div>

        </td>
        <td class="code highlight"><div class="highlight"><pre></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="gamesocketclient.sendhi">
  <h3>
    <a href="#gamesocketclient.sendhi" class="pilcrow">&#182;</a>
    GameSocketClient.sendHI
  </h3>
</div>

  </div>
  <div class="body"><p>Creates a HI message and pushes it into the socket</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">from</span>
      <span class="dox_type">string</span>
      <span>Optional. The message sender. Defaults node.player</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">to</span>
      <span class="dox_type">string</span>
      <span>Optional. The recipient of the message. Defaults 'SERVER'</span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre><span class="nx">GameSocketClient</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">sendHI</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">from</span><span class="p">,</span> <span class="nx">to</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">from</span> <span class="o">=</span> <span class="nx">from</span> <span class="o">||</span> <span class="nx">node</span><span class="p">.</span><span class="nx">player</span><span class="p">;</span>
  <span class="nx">to</span> <span class="o">=</span> <span class="nx">to</span> <span class="o">||</span> <span class="s1">&#39;SERVER&#39;</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">msg</span> <span class="o">=</span> <span class="nx">node</span><span class="p">.</span><span class="nx">msg</span><span class="p">.</span><span class="nx">createHI</span><span class="p">(</span><span class="nx">from</span><span class="p">,</span> <span class="nx">to</span><span class="p">);</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">msg</span><span class="p">);</span>
<span class="p">};</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="gamesocketclient.sendstate">
  <h3>
    <a href="#gamesocketclient.sendstate" class="pilcrow">&#182;</a>
    GameSocketClient.sendSTATE
  </h3>
</div>

  </div>
  <div class="body"><p>Creates a STATE message and pushes it into the socket</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">action</span>
      <span class="dox_type">string</span>
      <span>A nodeGame action (e.g. 'get' or 'set')</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">state</span>
      <span class="dox_type">GameState</span>
      <span>The GameState object to send</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">to</span>
      <span class="dox_type">string</span>
      <span>Optional. The recipient of the message.

@see GameMsg.actions</span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre><span class="nx">GameSocketClient</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">sendSTATE</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">action</span><span class="p">,</span> <span class="nx">state</span><span class="p">,</span> <span class="nx">to</span><span class="p">)</span> <span class="p">{</span> 
  <span class="kd">var</span> <span class="nx">msg</span> <span class="o">=</span> <span class="nx">node</span><span class="p">.</span><span class="nx">msg</span><span class="p">.</span><span class="nx">createSTATE</span><span class="p">(</span><span class="nx">action</span><span class="p">,</span> <span class="nx">state</span><span class="p">,</span> <span class="nx">to</span><span class="p">);</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">msg</span><span class="p">);</span>
<span class="p">};</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="gamesocketclient.sendtxt">
  <h3>
    <a href="#gamesocketclient.sendtxt" class="pilcrow">&#182;</a>
    GameSocketClient.sendTXT
  </h3>
</div>

  </div>
  <div class="body"><p>Creates a TXT message and pushes it into the socket</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">text</span>
      <span class="dox_type">string</span>
      <span>Text to send</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">to</span>
      <span class="dox_type">string</span>
      <span>Optional. The recipient of the message</span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre><span class="nx">GameSocketClient</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">sendTXT</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">text</span><span class="p">,</span> <span class="nx">to</span><span class="p">)</span> <span class="p">{</span> 
  <span class="kd">var</span> <span class="nx">msg</span> <span class="o">=</span> <span class="nx">node</span><span class="p">.</span><span class="nx">msg</span><span class="p">.</span><span class="nx">createTXT</span><span class="p">(</span><span class="nx">text</span><span class="p">,</span><span class="nx">to</span><span class="p">);</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">msg</span><span class="p">);</span>
<span class="p">};</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="gamesocketclient.senddata">
  <h3>
    <a href="#gamesocketclient.senddata" class="pilcrow">&#182;</a>
    GameSocketClient.sendDATA
  </h3>
</div>

  </div>
  <div class="body"><p>Creates a DATA message and pushes it into the socket</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">action</span>
      <span class="dox_type">string</span>
      <span>Optional. A nodeGame action (e.g. 'get' or 'set'). Defaults 'say'</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">data</span>
      <span class="dox_type">object</span>
      <span>An object to exchange</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">to</span>
      <span class="dox_type">string</span>
      <span>Optional. The recipient of the message. Defaults 'SERVER'</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">text</span>
      <span class="dox_type">string</span>
      <span>Optional. A descriptive text associated to the message.

@see GameMsg.actions</span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre><span class="nx">GameSocketClient</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">sendDATA</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">action</span><span class="p">,</span> <span class="nx">data</span><span class="p">,</span> <span class="nx">to</span><span class="p">,</span> <span class="nx">text</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">action</span> <span class="o">=</span> <span class="nx">action</span> <span class="o">||</span> <span class="nx">GameMsg</span><span class="p">.</span><span class="nx">say</span><span class="p">;</span>
  <span class="nx">to</span> <span class="o">=</span> <span class="nx">to</span> <span class="o">||</span> <span class="s1">&#39;SERVER&#39;</span><span class="p">;</span>
  <span class="nx">text</span> <span class="o">=</span> <span class="nx">text</span> <span class="o">||</span> <span class="s1">&#39;DATA&#39;</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">msg</span> <span class="o">=</span> <span class="nx">node</span><span class="p">.</span><span class="nx">msg</span><span class="p">.</span><span class="nx">createDATA</span><span class="p">(</span><span class="nx">action</span><span class="p">,</span> <span class="nx">data</span><span class="p">,</span> <span class="nx">to</span><span class="p">,</span> <span class="nx">text</span><span class="p">);</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">msg</span><span class="p">);</span>
<span class="p">};</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="gamesocketclient.send">
  <h3>
    <a href="#gamesocketclient.send" class="pilcrow">&#182;</a>
    GameSocketClient.send
  </h3>
</div>

  </div>
  <div class="body"><p>Pushes a message into the socket.</p>

<p>The msg is actually received by the client itself as well.</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">The</span>
      <span class="dox_type">GameMsg</span>
      <span>game message to send

@see GameMsg</span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre><span class="nx">GameSocketClient</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">send</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">msg</span><span class="p">)</span> <span class="p">{</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-42" id="section-42">&#182;</a>
</div>
<p>if (msg.reliable) {</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>    <span class="k">this</span><span class="p">.</span><span class="nx">io</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">msg</span><span class="p">.</span><span class="nx">stringify</span><span class="p">());</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-43" id="section-43">&#182;</a>
</div>
<p>}
else {
this.io.volatile.send(msg.stringify());
}</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>  <span class="nx">node</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;S: &#39;</span> <span class="o">+</span> <span class="nx">msg</span><span class="p">);</span>
  <span class="nx">node</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="s1">&#39;LOG&#39;</span><span class="p">,</span> <span class="s1">&#39;S: &#39;</span> <span class="o">+</span> <span class="nx">msg</span><span class="p">.</span><span class="nx">toSMS</span><span class="p">());</span>
<span class="p">};</span>

<span class="p">})(</span>
  <span class="s1">&#39;undefined&#39;</span> <span class="o">!=</span> <span class="k">typeof</span> <span class="nx">node</span> <span class="o">?</span> <span class="nx">node</span> <span class="o">:</span> <span class="nx">module</span><span class="p">.</span><span class="nx">exports</span>
  <span class="p">,</span> <span class="s1">&#39;undefined&#39;</span> <span class="o">!=</span> <span class="k">typeof</span> <span class="nx">node</span> <span class="o">?</span> <span class="nx">node</span> <span class="o">:</span> <span class="nx">module</span><span class="p">.</span><span class="nx">parent</span><span class="p">.</span><span class="nx">exports</span>
  <span class="p">,</span> <span class="s1">&#39;undefined&#39;</span> <span class="o">!=</span> <span class="k">typeof</span> <span class="nx">io</span> <span class="o">?</span> <span class="nx">io</span> <span class="o">:</span> <span class="nx">module</span><span class="p">.</span><span class="nx">parent</span><span class="p">.</span><span class="nx">exports</span><span class="p">.</span><span class="nx">io</span>
<span class="p">);</span>
</pre></div>
        </td>
      </tr>
  </tbody>
</table>
  </div>
</body>
</html>
